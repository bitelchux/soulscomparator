var e=0;var t="";function a(e){return d(u(p(e)))}function r(e){return h(u(p(e)))}function s(e,t){return m(u(p(e)),t)}function i(e,t){return d(c(p(e),p(t)))}function n(e,t){return h(c(p(e),p(t)))}function o(e,t,a){return m(c(p(e),p(t)),a)}function l(){return a("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function u(e){return b(y(v(e),e.length*8))}function c(e,t){var a=v(e);if(a.length>16)a=y(a,e.length*8);var r=Array(16),s=Array(16);for(var i=0;i<16;i++){r[i]=a[i]^909522486;s[i]=a[i]^1549556828}var n=y(r.concat(v(t)),512+t.length*8);return b(y(s.concat(n),512+128))}function d(t){try{e}catch(a){e=0}var r=e?"0123456789ABCDEF":"0123456789abcdef";var s="";var i;for(var n=0;n<t.length;n++){i=t.charCodeAt(n);s+=r.charAt(i>>>4&15)+r.charAt(i&15)}return s}function h(e){try{t}catch(a){t=""}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var s="";var i=e.length;for(var n=0;n<i;n+=3){var o=e.charCodeAt(n)<<16|(n+1<i?e.charCodeAt(n+1)<<8:0)|(n+2<i?e.charCodeAt(n+2):0);for(var l=0;l<4;l++){if(n*8+l*6>e.length*8)s+=t;else s+=r.charAt(o>>>6*(3-l)&63)}}return s}function m(e,t){var a=t.length;var r,s,i,n,o;var l=Array(Math.ceil(e.length/2));for(r=0;r<l.length;r++){l[r]=e.charCodeAt(r*2)<<8|e.charCodeAt(r*2+1)}var u=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));var c=Array(u);for(s=0;s<u;s++){o=Array();n=0;for(r=0;r<l.length;r++){n=(n<<16)+l[r];i=Math.floor(n/a);n-=i*a;if(o.length>0||i>0)o[o.length]=i}c[s]=n;l=o}var d="";for(r=c.length-1;r>=0;r--)d+=t.charAt(c[r]);return d}function p(e){var t="";var a=-1;var r,s;while(++a<e.length){r=e.charCodeAt(a);s=a+1<e.length?e.charCodeAt(a+1):0;if(55296<=r&&r<=56319&&56320<=s&&s<=57343){r=65536+((r&1023)<<10)+(s&1023);a++}if(r<=127)t+=String.fromCharCode(r);else if(r<=2047)t+=String.fromCharCode(192|r>>>6&31,128|r&63);else if(r<=65535)t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63);else if(r<=2097151)t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63)}return t}function f(e){var t="";for(var a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)&255,e.charCodeAt(a)>>>8&255);return t}function g(e){var t="";for(var a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)>>>8&255,e.charCodeAt(a)&255);return t}function v(e){var t=Array(e.length>>2);for(var a=0;a<t.length;a++)t[a]=0;for(var a=0;a<e.length*8;a+=8)t[a>>5]|=(e.charCodeAt(a/8)&255)<<a%32;return t}function b(e){var t="";for(var a=0;a<e.length*32;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function y(e,t){e[t>>5]|=128<<t%32;e[(t+64>>>9<<4)+14]=t;var a=1732584193;var r=-271733879;var s=-1732584194;var i=271733878;for(var n=0;n<e.length;n+=16){var o=a;var l=r;var u=s;var c=i;a=A(a,r,s,i,e[n+0],7,-680876936);i=A(i,a,r,s,e[n+1],12,-389564586);s=A(s,i,a,r,e[n+2],17,606105819);r=A(r,s,i,a,e[n+3],22,-1044525330);a=A(a,r,s,i,e[n+4],7,-176418897);i=A(i,a,r,s,e[n+5],12,1200080426);s=A(s,i,a,r,e[n+6],17,-1473231341);r=A(r,s,i,a,e[n+7],22,-45705983);a=A(a,r,s,i,e[n+8],7,1770035416);i=A(i,a,r,s,e[n+9],12,-1958414417);s=A(s,i,a,r,e[n+10],17,-42063);r=A(r,s,i,a,e[n+11],22,-1990404162);a=A(a,r,s,i,e[n+12],7,1804603682);i=A(i,a,r,s,e[n+13],12,-40341101);s=A(s,i,a,r,e[n+14],17,-1502002290);r=A(r,s,i,a,e[n+15],22,1236535329);a=V(a,r,s,i,e[n+1],5,-165796510);i=V(i,a,r,s,e[n+6],9,-1069501632);s=V(s,i,a,r,e[n+11],14,643717713);r=V(r,s,i,a,e[n+0],20,-373897302);a=V(a,r,s,i,e[n+5],5,-701558691);i=V(i,a,r,s,e[n+10],9,38016083);s=V(s,i,a,r,e[n+15],14,-660478335);r=V(r,s,i,a,e[n+4],20,-405537848);a=V(a,r,s,i,e[n+9],5,568446438);i=V(i,a,r,s,e[n+14],9,-1019803690);s=V(s,i,a,r,e[n+3],14,-187363961);r=V(r,s,i,a,e[n+8],20,1163531501);a=V(a,r,s,i,e[n+13],5,-1444681467);i=V(i,a,r,s,e[n+2],9,-51403784);s=V(s,i,a,r,e[n+7],14,1735328473);r=V(r,s,i,a,e[n+12],20,-1926607734);a=w(a,r,s,i,e[n+5],4,-378558);i=w(i,a,r,s,e[n+8],11,-2022574463);s=w(s,i,a,r,e[n+11],16,1839030562);r=w(r,s,i,a,e[n+14],23,-35309556);a=w(a,r,s,i,e[n+1],4,-1530992060);i=w(i,a,r,s,e[n+4],11,1272893353);s=w(s,i,a,r,e[n+7],16,-155497632);r=w(r,s,i,a,e[n+10],23,-1094730640);a=w(a,r,s,i,e[n+13],4,681279174);i=w(i,a,r,s,e[n+0],11,-358537222);s=w(s,i,a,r,e[n+3],16,-722521979);r=w(r,s,i,a,e[n+6],23,76029189);a=w(a,r,s,i,e[n+9],4,-640364487);i=w(i,a,r,s,e[n+12],11,-421815835);s=w(s,i,a,r,e[n+15],16,530742520);r=w(r,s,i,a,e[n+2],23,-995338651);a=x(a,r,s,i,e[n+0],6,-198630844);i=x(i,a,r,s,e[n+7],10,1126891415);s=x(s,i,a,r,e[n+14],15,-1416354905);r=x(r,s,i,a,e[n+5],21,-57434055);a=x(a,r,s,i,e[n+12],6,1700485571);i=x(i,a,r,s,e[n+3],10,-1894986606);s=x(s,i,a,r,e[n+10],15,-1051523);r=x(r,s,i,a,e[n+1],21,-2054922799);a=x(a,r,s,i,e[n+8],6,1873313359);i=x(i,a,r,s,e[n+15],10,-30611744);s=x(s,i,a,r,e[n+6],15,-1560198380);r=x(r,s,i,a,e[n+13],21,1309151649);a=x(a,r,s,i,e[n+4],6,-145523070);i=x(i,a,r,s,e[n+11],10,-1120210379);s=x(s,i,a,r,e[n+2],15,718787259);r=x(r,s,i,a,e[n+9],21,-343485551);a=S(a,o);r=S(r,l);s=S(s,u);i=S(i,c)}return Array(a,r,s,i)}function k(e,t,a,r,s,i){return S(C(S(S(t,e),S(r,i)),s),a)}function A(e,t,a,r,s,i,n){return k(t&a|~t&r,e,t,s,i,n)}function V(e,t,a,r,s,i,n){return k(t&r|a&~r,e,t,s,i,n)}function w(e,t,a,r,s,i,n){return k(t^a^r,e,t,s,i,n)}function x(e,t,a,r,s,i,n){return k(a^(t|~r),e,t,s,i,n)}function S(e,t){var a=(e&65535)+(t&65535);var r=(e>>16)+(t>>16)+(a>>16);return r<<16|a&65535}function C(e,t){return e<<t|e>>>32-t}var D={get:function(e){var t=document.cookie.match(new RegExp(e+"=[a-zA-Z0-9.()=|%/_]+($|;)","g"));if(!t||!t[0])return null;else return unescape(t[0].substring(e.length+1,t[0].length).replace(";",""))||null},set:function(e,t,a,r){var s=[e+"="+escape(t),"path="+(!a||a==""?"/":a),"domain="+(!r||r==""?window.location.host:r)];return document.cookie=s.join("; ")}};var R={parse:function(e){e=e.replace("?","");var t={};e.split("&").forEach(function(e){var a=e.split("=")[0];var r=e.split("=")[1];t[a]=r});return t}};var P={DkS1:"darksouls1",DkS2:"darksouls2"};var B=300;var F=["head","chest","hands","legs"];var E="0000000";var W=["weapons","armors","shields"];var T="This website uses cookies to collect statistical information in anonymous form on "+"usage of the website. We also use cookies to save your preferences and provide a better experience. "+"However, we do not register any information that can identify you personally.<br/><br/>A cookie is "+"a small text file saved to your computer and allows our website to follow your visit and to recognize "+"your computer when you visit our website again. A cookie is not a program and does not contain virus, "+"nor spreads malicious software.";var I={Armor:{View:{}}};var N={Armor:{View:{}}};String.prototype.capitalize=function(){return this,this.charAt(0).toUpperCase()+this.slice(1)};var M=function(e){this.ref=e};M.prototype.fetchByField=function(e,t,a,r){var s=this.ref;return new Promise(function(i,n){s.child(e+"/"+t).orderByChild(a).equalTo(r).once("value",function(e){var t=e.val();if(!t)n();i(t[Object.keys(t)[0]])})})};M.prototype.fetchWeaponEvolutionData=function(e,t,a,r){var s=this.ref;return new Promise(function(i,n){s.child(e+"/"+t).orderByChild(a).startAt(r).endAt(r+" +999").once("value",function(e){var t=e.val();if(!t)n();i({name:r,data:Object.keys(t).map(function(e){return t[e]})})})})};M.prototype.fetchArmorEvolutionData=function(e,t,a){var r=this;var s=a.pieces.filter(function(e){return e.name!=="Naked Head"&&e.name!=="Naked Chest"&&e.name!=="Naked Hands"&&e.name!=="Naked Legs"});return Promise.all(s.map(function(e){var a=e.name.split("+")[0].trim();return r.fetchWeaponEvolutionData(z,"armors",t,a)}))};M.prototype.fetchArmorPiece=function(e,t,a,r){var s=this.ref;return new Promise(function(i,n){if(r!=="naked"){s.child(e+"/armors").orderByChild(t).equalTo(r).once("value",function(e){var t=e.val(),r;if(t===null){r=new $e("Error fetching "+a.capitalize(),a)}else{r=t[Object.keys(t)[0]]}i(r)})}else{var o=new $e("Naked "+a.capitalize(),a);i(o)}})};var O=new Firebase("https://darksoulscomparator.firebaseIO.com");var j=new M(O);var q={armors:[],shields:[],weapons:[],pieces:{head:[],chest:[],hands:[],legs:[]}};var H=null;var L={1:null,2:null};var z=D.get("game")||P.DkS1;var U=null;var Z=null;var G=null;var J=Handlebars.compile($("#social-template").html());K();function K(){Se("Loading...",null,true);O.child(z+"/indexes").on("value",function(e){data=e.val();q.weapons=data.weapons[be(data.weapons)];q.armors=data.armors[be(data.armors)];q.shields=data.shields[be(data.shields)];q.pieces=data.pieces[be(data.pieces)];te();$("#type").removeAttr("disabled");$("#type").selectpicker("refresh");$("select.basic-comparator").on("change",function(e){var t=unescape($(this).val());var a=$(this).attr("data-item");var r=$("#type").val();var s=q[r].filter(function(e){return be(e)===t})[0][t];ae(a,s)});$("select.detailed-comparator").on("change",function(e){var t=unescape($(this).val());var a=$(this).attr("data-item");var r=$(this).attr("data-piece");var s=0;if(t!=="naked"&&t){s=q.pieces[r].filter(function(e){return be(e)===t})[0][t]}re(a,r,s)});Ce()})}function Q(){$("#comparison").html("");$("#by-widgets").hide();$("#by").selectpicker("val",null);$("#detailed-widgets").hide();$("#basic-widgets").hide();$(".basic-level").selectpicker("val",null);ve();_e();G.navigate("/")}var X=Backbone.Router.extend({});$(document).ready(function(){Backbone.history.start({pushState:true});G=new X;ve();$("#game").val(z);$("#game").on("change",function(e){z=$(this).val();Q();$("#type").attr("disabled","");$("#type").selectpicker("val",null);D.set("game",z);K()});$("#type").on("change",function(e){H=$(this).val();Q();if(H==="armors"){ee()}else{Y()}});$(".set-comparator").on("change",function(e){var t=$(this).val();var a=$(this).attr("data-item");if(t==="custom"){ge(a)}else{t=unescape(t);var r=q.armors.filter(function(e){return be(e)===t})[0][t];ve(a);se(a,r)}var s=unescape($('.set-comparator[data-item="1"]').selectpicker("val"));var i=unescape($('.set-comparator[data-item="2"]').selectpicker("val"));if(s==="custom"||i==="custom"){$("#detailed-widgets").show()}else{$("#detailed-widgets").hide()}});$("button#compare").on("click",function(e){fe();var t=unescape($(this).val());if(H==="armors"){var a=oe().then(function(e){if(z===P.DkS1){U=new I.Armor.View({el:"#comparison"})}else if(z===P.DkS2){U=new N.Armor.View({el:"#comparison"})}me(e[0],e[1],H).then(function(e){U.renderSetsEvolution(e[0],e[1])});U.render(e[0],e[1]);we(z,H,e[0],e[1]);pe()}).catch(function(e){De(e);pe()})}else{var r=H==="shields";var a=ie().then(function(e){if(z===P.DkS1){U=new Be({el:"#comparison"})}else if(z===P.DkS2){U=new Fe({el:"#comparison"})}he(e[0].name,e[1].name,H).then(function(t){if(H==="weapons"){U.renderWeaponsEvolution(t[0],t[1])}else{U.renderShieldsEvolution(t[0],t[1]);U.renderReductionsChart(e[0],e[1])}});U.render(e[0],e[1],r);we(z,H,e[0],e[1]);pe()}).catch(function(e){De(e);pe()})}});$("#cookies-policy").on("click",function(e){e.preventDefault();Se("Cookies Policy",T,null,true);return false});ke()});Handlebars.registerHelper("toTitleCase",function(e){return e.split("_").map(function(e){return e[0].toUpperCase()+e.slice(1,e.length)}).join(" ")});function Y(){var e="";q[H].map(function(e){return be(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});$("select.basic-comparator").html(e);$("select.basic-comparator").selectpicker("refresh");$("#basic-widgets").show()}function ee(){var e='<option value="custom">Custom</option>';e+='<optgroup label="Sets">';q[H].map(function(e){return be(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});e+="</optgroup>";$("select.set-comparator").html(e);$("select.set-comparator").selectpicker("refresh");$("#by-widgets").show()}function te(){Object.keys(q.pieces).forEach(function(e){var t='<option value="naked">Naked</option>';t+='<option data-divider="true"></option>';var a=q.pieces[e].map(function(e){return be(e)}).sort();a.forEach(function(e){t+='<option value="'+escape(e)+'">'+e+"</option>"});var r=$('select.detailed-comparator[data-piece="'+e+'"]');r.html(t);r.selectpicker("refresh")})}function ae(e,t){var a='<option value="0" selected>0</option>';for(var r=1;r<=t;r++){a+='<option value="'+r+'">+'+r+"</option>"}var s=$('select.basic-level[data-level="'+e+'"]');s.html(a);s.selectpicker("refresh")}function re(e,t,a){var r='<option value="0" selected>0</option>';for(var s=1;s<=a;s++){r+='<option value="'+s+'">+'+s+"</option>"}var i=$('select.detailed-level[data-level="'+e+'"][data-piece="'+t+'"]');i.html(r);i.selectpicker("refresh")}function se(e,t){var a='<option value="0" selected>0</option>';for(var r=1;r<=t;r++){a+='<option value="'+r+'">+'+r+"</option>"}var s=$('select.set-level[data-level="'+e+'"]');s.html(a);s.selectpicker("refresh")}function ie(){var e=unescape($('.basic-comparator[data-item="1"]').selectpicker("val"));var t=unescape($('.basic-comparator[data-item="2"]').selectpicker("val"));var a=unescape($('.basic-level[data-level="1"]').selectpicker("val"));var r=unescape($('.basic-level[data-level="2"]').selectpicker("val"));var s=a!=="0"?e+" +"+a:e;var i=r!=="0"?t+" +"+r:t;return Promise.all([j.fetchByField(z,H,"name",s),j.fetchByField(z,H,"name",i)])}function ne(e,t,a){return Promise.all([j.fetchByField(z,e,"sha",t),j.fetchByField(z,e,"sha",a)])}function oe(e,t,a,r){var e=e||unescape($('.set-comparator[data-item="1"]').selectpicker("val"));var t=t||unescape($('.set-comparator[data-item="2"]').selectpicker("val"));return new Promise(function(s,i){var n,o,l,u;if(e==="sha"){l=ce(a)}else if(e==="custom"){l=ue(de(1))}else{var c=$('select.set-level[data-level="1"]').selectpicker("val");a=c!=="0"?e+" +"+c:e;l=le(a)}l.then(function(e){n=e;if(n&&o)s([n,o])});if(t==="sha"){u=ce(r)}else if(t==="custom"){u=ue(de(2))}else{var c=$('select.set-level[data-level="2"]').selectpicker("val");r=c!=="0"?t+" +"+c:t;u=le(r)}u.then(function(e){o=e;if(n&&o)s([n,o])})})}function le(e){return new Promise(function(t,a){O.child(z+"/armors").orderByChild("set").equalTo(e).once("value",function(e){var r=e.val();if(!r)a();var s={pieces:[]};Object.keys(r).forEach(function(e){s.pieces.push(r[e])});t(s)})})}function ue(e){return new Promise(function(t,a){Promise.all(F.map(function(t){return e[t]?j.fetchArmorPiece(z,"name",t,unescape(e[t])):null})).then(function(e){t({pieces:_.compact(e)})})})}function ce(e){return new Promise(function(t,a){Promise.all(F.map(function(t){return e[t]?j.fetchArmorPiece(z,"sha",t,unescape(e[t])):null})).then(function(e){t({pieces:_.compact(e)})})})}function de(e){var t={};Object.keys(q.pieces).forEach(function(a){var r=$('select.detailed-comparator[data-item="'+e+'"][data-piece="'+a+'"]').selectpicker("val");var s=$('select.detailed-level[data-level="'+e+'"][data-piece="'+a+'"]').selectpicker("val");t[a]=s!=="0"?r+" +"+s:r});return t}function he(e,t,a){var r=e.split("+")[0].trim();var s=t.split("+")[0].trim();return Promise.all([j.fetchWeaponEvolutionData(z,a,"name",r),j.fetchWeaponEvolutionData(z,a,"name",s)])}function me(e,t){return Promise.all([j.fetchArmorEvolutionData(z,"name",e),j.fetchArmorEvolutionData(z,"name",t)])}function pe(){$("button#compare").removeAttr("disabled")}function fe(e){$("button#compare").attr("disabled","")}function ge(e){var t=e?'[data-item="'+e+'"]':"";var a=$("select.detailed-comparator"+t);a.removeAttr("disabled");a.selectpicker("refresh");var r=e?'[data-level="'+e+'"]':"";a=$("select.detailed-level"+r);a.removeAttr("disabled");a.selectpicker("refresh");var s=$("select.set-level"+r);s.attr("disabled","");s.selectpicker("refresh")}function ve(e){var t=e?'[data-item="'+e+'"]':"";var a=$("select.detailed-comparator"+t);a.attr("disabled","");a.selectpicker("refresh");var r=e?'[data-level="'+e+'"]':"";a=$("select.detailed-level"+r);a.attr("disabled","");a.selectpicker("refresh");var s=$("select.set-level"+r);s.removeAttr("disabled");s.selectpicker("refresh")}function _e(){$("select.detailed-comparator").selectpicker("deselectAll");$("select.detailed-level").selectpicker("deselectAll")}function be(e){return Object.keys(e)[0]}function ye(e){if(e&&e!==""&&e.length===60){if(parseInt(e[0])>Object.keys(P).length-1)return false;if(parseInt(e[1])>W.length-1)return false}else{return false}return true}function ke(){if(window.location.search==="")return;var e=R.parse(window.location.search).token;if(ye(e)){Z=e;var t=parseInt(e[0])+1;var a=parseInt(e[1]);$("#game :nth-child("+t+")").prop("selected",true);z=$("#game").val();var r=W[a];if(a===1){var s=e.substr(2,29);var i={head:s.substr(1,7),chest:s.substr(8,7),hands:s.substr(15,7),legs:s.substr(22,7)};s=e.substr(31,29);var n={head:s.substr(1,7),chest:s.substr(8,7),hands:s.substr(15,7),legs:s.substr(22,7)};var o=oe("sha","sha",i,n).then(function(e){if(z===P.DkS1){U=new I.Armor.View({el:"#comparison"})}else if(z===P.DkS2){U=new N.Armor.View({el:"#comparison"})}me(e[0],e[1],r).then(function(e){U.renderSetsEvolution(e[0],e[1])});U.render(e[0],e[1]);we(z,r,e[0],e[1]);pe()}).catch(function(e){De(e);G.navigate("/")})}else{var l=e.substr(2,29).substr(1,7);var u=e.substr(31,29).substr(1,7);var c=r==="shields";var o=ne(r,l,u).then(function(e){if(z===P.DkS1){U=new Be({el:"#comparison"})}else if(z===P.DkS2){U=new Fe({el:"#comparison"})}he(e[0].name,e[1].name,r).then(function(t){if(r==="weapons"){U.renderWeaponsEvolution(t[0],t[1])}else{U.renderShieldsEvolution(t[0],t[1]);U.renderReductionsChart(e[0],e[1])}});U.render(e[0],e[1],c);we(z,r,e[0],e[1]);pe()}).catch(function(e){De(e);G.navigate("/")})}}else{alert("Invalid token");G.navigate("/")}}function Ae(e){return["B",e.sha,E,E,E].join("")}function Ve(e){return["F",e.pieces.filter(function(e){return e.piece==="Head"})[0].sha,e.pieces.filter(function(e){return e.piece==="Chest"})[0].sha,e.pieces.filter(function(e){return e.piece==="Hands"})[0].sha,e.pieces.filter(function(e){return e.piece==="Legs"})[0].sha].join("")}function we(e,t,a,r){var s,i;if(Z){s=window.location.toString();i=window.location.pathname+window.location.search}else{var n=xe(e,t,a,r);var o=window.location.pathname;o=o[o.length-1]==="/"?o:o+"/";i=o+"?token="+n;s=window.location.origin+i}var l=J({url:s});$(".social-buttons").html(l);$('input[name="share-link"]').val(s);$('input[name="share-link"]').focus(function(){$(this).select()});loadSocial();$(".social-buttons").show();G.navigate(i)}function xe(e,t,a,r){var s=[],i,n,o;o=e===P.DkS1?"0":"1";tid=t==="weapons"?"0":t==="armors"?"1":"2";if(t==="armors"){i=Ve(a);n=Ve(r)}else{i=Ae(a);n=Ae(r)}s.push(o);s.push(tid);s.push(i);s.push(n);var l=s.join("");return l}function Se(e,t,a,r){$(".modal-title").text(e);if(t){$(".modal-body").html(t)}if(a){$(".modal-close").hide();$(".modal-body").html('<div><img src="http://i.imgur.com/unIj1Le.gif" /></div>'+'<p class="waiting">Please wait...</p>'+'<span class="credits">Image by <a href="http://zedotagger.deviantart.com/" target="_blank">Zedotagger</a></span>')}else{$(".modal-close").show()}if(r){$(".modal-footer").show()}else{$(".modal-footer").hide()}$("#modal-dialog").modal("show")}function Ce(){$("#modal-dialog").modal("hide")}function De(e){alert("There was an error fetching the information for the requested element.\n\nERR: "+e)}var $e=function(e,t){this.elemental_defense={fire:0,lightning:0,magic:0};this.physical_defense={regular:0,strike:0,slash:0,thrust:0};this.resistances={bleed:0,poison:0,curse:0};this.stats={fire_defense:0,lightning_defense:0,magic_defense:0,dark_defense:0,physical_defense:0,strike_defense:0,slash_defense:0,thrust_defense:0,bleed_resist:0,poison_resist:0,curse_resist:0,petrify_resist:0,weight:0,poise:0,durability:0};this.req_param={strength:0,dexterity:0,intelligence:0,faith:0};this.weight=0;this.poise=0;this.durability=0;this.physical_defense_bonus="-";this.name=e?e:t?"Naked "+t:"";this.type="N/A";if(t){this.piece=t.capitalize()}};$e.constructor.prototype=$e;var Re=function(){var e=Handlebars.compile($("#attribute-template").html());var t=Handlebars.compile($("#image-template").html());var a=Handlebars.compile($("#chart-box-template").html());var r=["-","–","S","A","B","C","D","E"];var s=function(e,t){if(e!==t){if(e==="S"){return-1}else if(t==="S"){return 1}else if(e==="-"&&t!=="-"){return 1}else if(e!=="-"&&t==="-"){return-1}else{if(e>t)return 1;if(e<t)return-1}}else{return 0}};return{renderAttribute:function(t,a,i,n,o){o=o||{};var l=color2="",u="=";if(o.isNegative){goodColor="red";badColor="blue"}else{goodColor="blue";badColor="red"}if(o.invertSymbols){biggerThanSymbol="<";lesserThanSymbol=">"}else{biggerThanSymbol=">";lesserThanSymbol="<"}if(!o.isString){i=i==="–"||i==="-"||i===""?0:parseFloat(i);n=n==="–"||n==="-"||n===""?0:parseFloat(n)}if(s(i,n)>0){l=goodColor;color2=badColor;u=biggerThanSymbol}else if(s(i,n)<0){l=badColor;color2=goodColor;u=lesserThanSymbol}if(!o.isInteger&&!o.isPercentage){i=r.indexOf(i)>=0?i:i.toFixed(1);n=r.indexOf(n)>=0?n:n.toFixed(1)}if(o.isPercentage){i=i+"%";n=n+"%"}tooltip=o.tooltip||a;var c={key:a,icon:{icon:t,caption:a},tooltip:tooltip,color1:l,color2:color2,value1:i,value2:n,symbol:u};if(o.notIcon)delete c.icon;return e(c)},renderImage:function(e,a,r){var s=e[a];var i=e[r];return t({name:unescape(e.name),source:e.wiki_image,title1:a,title2:r,type1:s,type2:i})},renderChartBox:function(e,t){return a({id:e,layout:t})},drawWeaponEvolution:function(e,t,a,r){var s=[];for(var i=0;i<Math.max(t.length,r.length);i++){s.push("+"+i)}$("#weapons-evolution").highcharts({chart:{height:B},title:{text:"Weapons damage evolution"},credits:{enabled:false},yAxis:{title:{text:"Total Damage"}},xAxis:{categories:s},series:[{data:t,name:e},{data:r,name:a}]})},drawShieldEvolution:function(e,t,a,r){var s=[];for(var i=0;i<Math.max(t.length,r.length);i++){s.push("+"+i)}$("#shields-evolution").highcharts({chart:{height:B},title:{text:"Shields stability evolution"},credits:{enabled:false},yAxis:{title:{text:"Stability"}},xAxis:{categories:s},series:[{data:t,name:e},{data:r,name:a}]})},drawShieldsReductions:function(e,t,a,r,s){$("#shields-reduction").highcharts({chart:{polar:true,type:"line",height:B},title:{text:"Shields Reduction"},credits:{enabled:false},xAxis:{categories:e,lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},legend:{align:"center",verticalAlign:"bottom",layout:"vertical"},series:[{name:t,data:a,pointPlacement:"on"},{name:r,data:s,pointPlacement:"on"}]})},drawArmorEvolutions:function(e){var t=[];for(var a=0;a<Math.max(e[0].resistances.length,e[1].resistances.length);a++){t.push("+"+a)}$("#sets-defense-evolution").highcharts({chart:{height:B},title:{text:"Defense evolution by set"},credits:{enabled:false},yAxis:{title:{text:"Total defense (physical + elemental)"}},xAxis:{categories:t},series:[{data:e[0].defenses,name:e[0].name},{data:e[1].defenses,name:e[1].name}]});$("#sets-resistance-evolution").highcharts({chart:{height:B},title:{text:"Resistance evolution by set"},credits:{enabled:false},yAxis:{title:{text:"Total resistance (all resistances)"}},xAxis:{categories:t},series:[{data:e[0].resistances,name:e[0].name},{data:e[1].resistances,name:e[1].name}]})},drawArmorDefenses:function(e,t,a,r,s){$("#sets-defense").highcharts({chart:{polar:true,type:"line",height:B},credits:{enabled:false},title:{text:"Defenses by set"},xAxis:{categories:e,lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},legend:{align:"center",verticalAlign:"bottom",layout:"vertical"},series:[{name:t,data:a,pointPlacement:"on"},{name:r,data:s,pointPlacement:"on"}]})},unescape:function(e){e=unescape(e);return e},parseValue:function(e){var t=parseFloat(e);return isNaN(t)?0:t}}}();var Pe=Backbone.View.extend({initialize:function(){this.isArmor=true;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},buildEvolutionDataSet:function(e,t,a){var r=_.max(e,function(e){return e.data.length}).data.length-1;var s={name:null,defenses:new Array(r),resistances:new Array(r)};for(var i=0;i<=r;i++){e.forEach(function(e){var r=e.data[i];if(r===undefined){r=e.data[e.data.length-1]}var n=r.set.split("+")[0].trim();if(s.name&&s.name!==n&&s.name!=="Custom Set"){s.name="Custom Set"}else if(!s.name){s.name=n}if(!s.defenses[i])s.defenses[i]=0;if(!s.resistances[i])s.resistances[i]=0;s.defenses[i]+=t(r);s.resistances[i]+=a(r)})}return s},renderSets:function(e,t){var a=Re.renderImage(e,"type");var r=Re.renderImage(t,"type");var s="";s+=this.renderPhysicalDefense(e,t);s+=this.renderElementalDefense(e,t);s+=this.renderResistances(e,t);s+=this.renderOthers(e,t);return this.contentTemplate({body:s,description1:a,description2:r,social:{up:true}})},renderPiece:function(e,t){t=t||{};var a="";var r=_.find(this.armor1.pieces,{piece:e})||{};var s=_.find(this.armor2.pieces,{piece:e})||{};var i=Re.renderImage(r,"type");var n=Re.renderImage(s,"type");var a="";a+=this.renderPhysicalDefense(r,s);a+=this.renderElementalDefense(r,s);a+=this.renderResistances(r,s);a+=this.renderOthers(r,s);return this.contentTemplate({body:a,description1:i,description2:n,social:{down:t.social}})},render:function(e,t){this.armor1=e;this.armor2=t;this.set1=this.calculateSetStats(this.armor1);this.set2=this.calculateSetStats(this.armor2);var a=this.renderSets(this.set1,this.set2);a+=Re.renderChartBox("sets-defense-evolution","col-sm-12 col-md-6 col-lg-4");a+=Re.renderChartBox("sets-resistance-evolution","col-sm-12 col-md-6 col-lg-4");a+=Re.renderChartBox("sets-defense","col-sm-12 col-md-6 col-lg-4");a+=this.renderPiece("Head");a+=this.renderPiece("Chest");a+=this.renderPiece("Hands");a+=this.renderPiece("Legs",{social:true});this.$el.html(a);this.renderDefensesChart(this.set1,this.set2)}});I.Armor.View=Pe.extend({calculateSetStats:function(e){var t=new $e;for(var a=0;a<e.pieces.length;a++){var r=e.pieces[a];t.elemental_defense.fire+=parseFloat(r.elemental_defense.fire);t.elemental_defense.lightning+=parseFloat(r.elemental_defense.lightning);t.elemental_defense.magic+=parseFloat(r.elemental_defense.magic);t.physical_defense.regular+=parseFloat(r.physical_defense.regular);t.physical_defense.strike+=parseFloat(r.physical_defense.strike);t.physical_defense.slash+=parseFloat(r.physical_defense.slash);t.physical_defense.thrust+=parseFloat(r.physical_defense.thrust);t.resistances.bleed+=parseFloat(r.resistances.bleed);t.resistances.poison+=parseFloat(r.resistances.poison);t.resistances.curse+=parseFloat(r.resistances.curse);t.weight+=parseFloat(r.weight);t.poise+=parseFloat(r.poise);t.durability+=parseInt(r.durability);if(t.name===""){t.name=r.set}else if(r.set!==t.name){t.name="Custom Set"}t.type=r.type}return t},calculatePhysicalWeightRatio:function(e){if(_.isEmpty(e)||e.weight===0)return 0;var t;t=Re.parseValue(e.physical_defense.regular);t+=Re.parseValue(e.physical_defense.strike);t+=Re.parseValue(e.physical_defense.slash);t+=Re.parseValue(e.physical_defense.thrust);return t/4/Re.parseValue(e.weight)},calculateElementalWeightRatio:function(e){if(_.isEmpty(e)||e.weight===0)return 0;var t;t=Re.parseValue(e.elemental_defense.fire);t+=Re.parseValue(e.elemental_defense.magic);t+=Re.parseValue(e.elemental_defense.lightning);return t/3/Re.parseValue(e.weight)},calculatePoiseWeightRatio:function(e){if(e.weight===0)return 0;return Re.parseValue(e.poise)/Re.parseValue(e.weight)},renderPhysicalDefense:function(e,t){var a="",r=e.physical_defense||{},s=t.physical_defense||{},i=this.calculatePhysicalWeightRatio(e),n=this.calculatePhysicalWeightRatio(t);a+=Re.renderAttribute("darksouls1/icon_regular_defense","Regular",r.regular,s.regular);a+=Re.renderAttribute("darksouls1/icon_strike_defense","Strike",r.strike,s.strike);a+=Re.renderAttribute("darksouls1/icon_slash_defense","Slash",r.slash,s.slash);a+=Re.renderAttribute("darksouls1/icon_thrust_defense","Thrust",r.thrust,s.thrust);a+=Re.renderAttribute("darksouls1/icon_regular_defense","Def/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Physical Defense/Weight"});return this.statsBoxTemplate({title:"Physical Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderElementalDefense:function(e,t){var a="",r=e.elemental_defense||{},s=t.elemental_defense||{},i=this.calculateElementalWeightRatio(e),n=this.calculateElementalWeightRatio(t);a+=Re.renderAttribute("darksouls1/icon_fire_defense","Fire",r.fire,s.fire);a+=Re.renderAttribute("darksouls1/icon_magic_defense","Magic",r.magic,s.magic);a+=Re.renderAttribute("darksouls1/icon_lightning_defense","Lightning",r.lightning,s.lightning);a+=Re.renderAttribute("darksouls1/icon_fire_defense","Ele/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Elemental Defense/Weight"});return this.statsBoxTemplate({title:"Elemental Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",r=e.resistances||{},s=t.resistances||{};a+=Re.renderAttribute("darksouls1/icon_bleed","Bleed",r.bleed,s.bleed);a+=Re.renderAttribute("darksouls1/icon_poison","Poison",r.poison,s.poison);a+=Re.renderAttribute("darksouls1/icon_curse","Curse",r.curse,s.curse);return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t){var a=this.calculatePoiseWeightRatio(e),r=this.calculatePoiseWeightRatio(t),s="";s+=Re.renderAttribute("darksouls1/icon_poise","Poise",e.poise,t.poise);s+=Re.renderAttribute("darksouls1/icon_weight","Weight",e.weight,t.weight,{isNegative:true});s+=Re.renderAttribute("darksouls1/icon_durability","Durability",e.durability,t.durability,{isInteger:true});s+=Re.renderAttribute("darksouls1/icon_poise","Poi/Wei",a.toFixed(2),r.toFixed(2),{tooltip:"Poise/Weight"});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:s,isArmor:this.isArmor})}});I.Armor.View.prototype.renderSetsEvolution=function(e,t){var a=new I.Armor.Model;Re.drawArmorEvolutions([this.buildEvolutionDataSet(e,a.defenseCalculation,a.resistanceCalculation),this.buildEvolutionDataSet(t,a.defenseCalculation,a.resistanceCalculation)])};I.Armor.View.prototype.renderDefensesChart=function(e,t){var a=new I.Armor.Model;Re.drawArmorDefenses(a.getCategories(),e.name,a.defenseChartData(e),t.name,a.defenseChartData(t))};I.Armor.Model=Backbone.Model.extend({getCategories:function(){return["Regular Def","Slash Def","Strike Def","Thrust Def","Fire Def","Magic Red","Lightning Red","Dark Res","Bleed Res","Poison Res","Curse Res","Petrify Res","Poise","Weight"]},defenseCalculation:function(e){var t=0;t+=Re.parseValue(e.physical_defense.regular);t+=Re.parseValue(e.physical_defense.slash);t+=Re.parseValue(e.physical_defense.strike);t+=Re.parseValue(e.physical_defense.thrust);t+=Re.parseValue(e.elemental_defense.fire);t+=Re.parseValue(e.elemental_defense.magic);t+=Re.parseValue(e.elemental_defense.lightning);return t},resistanceCalculation:function(e){var t=0;t+=Re.parseValue(e.resistances.bleed);t+=Re.parseValue(e.resistances.curse);t+=Re.parseValue(e.resistances.poison);return t},defenseChartData:function(e){return[Re.parseValue(e.physical_defense.regular),Re.parseValue(e.physical_defense.slash),Re.parseValue(e.physical_defense.strike),Re.parseValue(e.physical_defense.thrust),Re.parseValue(e.elemental_defense.fire),Re.parseValue(e.elemental_defense.magic),Re.parseValue(e.elemental_defense.lightning),Re.parseValue(e.resistances.bleed),Re.parseValue(e.resistances.poison),Re.parseValue(e.resistances.curse),Re.parseValue(e.poise),Re.parseValue(e.weight)]}});var Be=Backbone.View.extend({initialize:function(){this.isArmor=false;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateDamageWeightRatio:function(e){var t;t=Re.parseValue(e.stats.physical_damage);t+=Re.parseValue(e.stats.fire_damage);t+=Re.parseValue(e.stats.magic_damage);t+=Re.parseValue(e.stats.lightning_damage);return t/4/Re.parseValue(e.weight)},calculateStabilityWeightRation:function(e){return Re.parseValue(e.stats.stability)/Re.parseValue(e.weight)},renderDamageStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=Re.renderAttribute("darksouls1/icon_physical_damage","Regular",r.physical_damage,s.physical_damage);a+=Re.renderAttribute("darksouls1/icon_magic_damage","Magic",r.magic_damage,s.magic_damage);

a+=Re.renderAttribute("darksouls1/icon_fire_damage","Fire",r.fire_damage,s.fire_damage);a+=Re.renderAttribute("darksouls1/icon_lightning_damage","Lightning",r.lightning_damage,s.lightning_damage);a+=Re.renderAttribute("darksouls1/icon_critical","Critical",r.critical,s.critical);return this.statsBoxTemplate({title:"Damage",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReductionStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=Re.renderAttribute("darksouls1/icon_physical_reduction","Physical",r.physical_reduction,s.physical_reduction);a+=Re.renderAttribute("darksouls1/icon_magic_reduction","Magic",r.magic_reduction,s.magic_reduction);a+=Re.renderAttribute("darksouls1/icon_fire_reduction","Fire",r.fire_reduction,s.fire_reduction);a+=Re.renderAttribute("darksouls1/icon_lightning_reduction","Lightning",r.lightning_reduction,s.lightning_reduction);a+=Re.renderAttribute("darksouls1/icon_stability","Stability",r.stability,s.stability);return this.statsBoxTemplate({title:"Reduction",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderParamBonus:function(e,t){var a="",r=e.param_bonus,s=t.param_bonus;a+=Re.renderAttribute("darksouls1/icon_strength","Strength",r.strength,s.strength,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls1/icon_dexterity","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls1/icon_intelligence","Intelligence",r.intelligence,s.intelligence,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls1/icon_faith","Faith",r.faith,s.faith,{isNegative:true,isString:true,invertSymbols:true});return this.statsBoxTemplate({title:"Param Bonus",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",r=e.req_param,s=t.req_param;a+=Re.renderAttribute("darksouls1/icon_strength","Strength",r.strength,s.strength,{isNegative:true,isInteger:true});a+=Re.renderAttribute("darksouls1/icon_dexterity","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isInteger:true});a+=Re.renderAttribute("darksouls1/icon_intelligence","Intelligence",r.intelligence,s.intelligence,{isNegative:true,isInteger:true});a+=Re.renderAttribute("darksouls1/icon_faith","Faith",r.faith,s.faith,{isNegative:true,isInteger:true});return this.statsBoxTemplate({title:"Req Params",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderAuxEffects:function(e,t){var a="",r=e.aux_effect,s=t.aux_effect;a+=Re.renderAttribute("darksouls1/icon_bleed","Bleed",r.bleed,s.bleed,{isInteger:true});a+=Re.renderAttribute("darksouls1/icon_toxic","Toxic",r.toxic,s.toxic,{isInteger:true});a+=Re.renderAttribute("darksouls1/icon_occult","Occult",r.occult,s.occult,{isInteger:true});a+=Re.renderAttribute("darksouls1/icon_divine","Divine",r.divine,s.divine,{isInteger:true});return this.statsBoxTemplate({title:"Aux Effects",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",r=e.resistances,s=t.resistances;a+=Re.renderAttribute("darksouls1/icon_bleed","Bleed",r.bleed,s.bleed,{isPercentage:true});a+=Re.renderAttribute("darksouls1/icon_poison","Poison",r.poison,s.poison,{isPercentage:true});a+=Re.renderAttribute("darksouls1/icon_toxic","Toxic",r.toxic,s.toxic,{isPercentage:true});a+=Re.renderAttribute("darksouls1/icon_curse","Curse",r.curse,s.curse,{isPercentage:true});return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t,a){var r="",s=e.stats,i=t.stats;r+=Re.renderAttribute("darksouls1/icon_weight","Weight",e.weight,t.weight,{isNegative:true});r+=Re.renderAttribute("darksouls1/icon_durability","Durability",e.durability,t.durability,{isInteger:true});if(e.magic_adjust||t.magic_adjust){r+=Re.renderAttribute("darksouls1/icon_magic_adjust","Magic Adjust",e.magic_adjust,t.magic_adjust,{isInteger:true})}if(a){var n=this.calculateStabilityWeightRation(e);var o=this.calculateStabilityWeightRation(t);r+=Re.renderAttribute("darksouls1/icon_stability","Sta/Wei",n.toFixed(2),o.toFixed(2),{tooltip:"Stability/Weight"})}else{var l=this.calculateDamageWeightRatio(e);var u=this.calculateDamageWeightRatio(t);r+=Re.renderAttribute("darksouls1/icon_physical_damage","Dmg/Wei",l.toFixed(2),u.toFixed(2),{tooltip:"Damage/Weight"})}return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},render:function(e,t,a){var r=Re.renderImage(e,"attack_type","weapon_type");var s=Re.renderImage(t,"attack_type","weapon_type");var i="";i+=this.renderDamageStats(e,t);i+=this.renderReductionStats(e,t);i+=this.renderParamBonus(e,t);i+=this.renderReqParams(e,t);if(a){i+=this.renderResistances(e,t)}else{i+=this.renderAuxEffects(e,t)}i+=this.renderOthers(e,t,a);i+=Re.renderChartBox("weapons-evolution","col-sm-12 col-md-12");i+=Re.renderChartBox("shields-evolution","col-sm-6 col-md-6");i+=Re.renderChartBox("shields-reduction","col-sm-6 col-md-6");content=this.contentTemplate({body:i,description1:r,description2:s,social:{up:true,down:true}});this.$el.html(content)}});Be.prototype.renderWeaponsEvolution=function(e,t){var a=e.data.map(function(e){var t=0;t+=Re.parseValue(e.stats.physical_damage);t+=Re.parseValue(e.stats.magic_damage);t+=Re.parseValue(e.stats.fire_damage);t+=Re.parseValue(e.stats.lightning_damage);return t});var r=t.data.map(function(e){var t=0;t+=Re.parseValue(e.stats.physical_damage);t+=Re.parseValue(e.stats.magic_damage);t+=Re.parseValue(e.stats.fire_damage);t+=Re.parseValue(e.stats.lightning_damage);return t});Re.drawWeaponEvolution(e.name,a,t.name,r)};Be.prototype.renderShieldsEvolution=function(e,t){var a=e.data.map(function(e){return Re.parseValue(e.stats.stability)});var r=t.data.map(function(e){return Re.parseValue(e.stats.stability)});Re.drawShieldEvolution(e.name,a,t.name,r)};Be.prototype.renderReductionsChart=function(e,t){var a=["Physical Red","Fire Red","Magic Red","Lightning Red","Bleed Res","Poison Res","Curse Res","Stability","Weight"];var r=[Re.parseValue(e.stats.physical_reduction),Re.parseValue(e.stats.magic_reduction),Re.parseValue(e.stats.fire_reduction),Re.parseValue(e.stats.lightning_reduction),Re.parseValue(e.resistances.bleed),Re.parseValue(e.resistances.poison),Re.parseValue(e.resistances.curse),Re.parseValue(e.stats.stability),Re.parseValue(e.weight)];var s=[Re.parseValue(t.stats.physical_reduction),Re.parseValue(t.stats.magic_reduction),Re.parseValue(t.stats.fire_reduction),Re.parseValue(t.stats.lightning_reduction),Re.parseValue(t.resistances.bleed),Re.parseValue(t.resistances.poison),Re.parseValue(t.resistances.curse),Re.parseValue(t.stats.stability),Re.parseValue(t.weight)];Re.drawShieldsReductions(a,e.name,r,t.name,s)};N.Armor.View=Pe.extend({calculateSetStats:function(e){var t=new $e;for(var a=0;a<e.pieces.length;a++){var r=e.pieces[a];t.stats.physical_defense+=parseFloat(r.stats.physical_defense);t.stats.strike_defense+=parseFloat(r.stats.strike_defense);t.stats.slash_defense+=parseFloat(r.stats.slash_defense);t.stats.thrust_defense+=parseFloat(r.stats.thrust_defense);t.stats.fire_defense+=parseFloat(r.stats.fire_defense);t.stats.lightning_defense+=parseFloat(r.stats.lightning_defense);t.stats.magic_defense+=parseFloat(r.stats.magic_defense);t.stats.dark_defense+=parseFloat(r.stats.dark_defense);t.stats.bleed_resist+=parseFloat(r.stats.bleed_resist);t.stats.poison_resist+=parseFloat(r.stats.poison_resist);t.stats.curse_resist+=parseFloat(r.stats.curse_resist);t.stats.dark_resist+=parseFloat(r.stats.dark_resist);t.stats.weight+=parseFloat(r.stats.weight);t.stats.poise+=parseFloat(r.stats.poise);t.stats.durability+=parseInt(r.stats.durability);if(t.name===""){t.name=r.set}else if(r.set!==t.name){t.name="Custom Set"}t.type=r.type}return t},calculatePhysicalWeightRatio:function(e){if(e.stats.weight===0)return 0;var t;t=Re.parseValue(e.stats.physical_defense);t+=Re.parseValue(e.stats.strike_defense);t+=Re.parseValue(e.stats.slash_defense);t+=Re.parseValue(e.stats.thrust_defense);return t/4/Re.parseValue(e.stats.weight)},calculateElementalWeightRatio:function(e){if(e.stats.weight===0)return 0;var t;t=Re.parseValue(e.stats.fire_defense);t+=Re.parseValue(e.stats.magic_defense);t+=Re.parseValue(e.stats.lightning_defense);t+=Re.parseValue(e.stats.dark_defense);return t/4/Re.parseValue(e.stats.weight)},calculatePoiseWeightRatio:function(e){if(e.stats.weight===0)return 0;return Re.parseValue(e.stats.poise)/Re.parseValue(e.stats.weight)},renderPhysicalDefense:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=Re.renderAttribute("darksouls2/icon_physical_reduction","Physical",r.physical_defense,s.physical_defense);a+=Re.renderAttribute("darksouls2/icon_strike_reduction","Strike",r.strike_defense,s.strike_defense);a+=Re.renderAttribute("darksouls2/icon_slash_reduction","Slash",r.slash_defense,s.slash_defense);a+=Re.renderAttribute("darksouls2/icon_thrust_reduction","Thrust",r.thrust_defense,s.thrust_defense);return this.statsBoxTemplate({title:"Physical Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderElementalDefense:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=Re.renderAttribute("darksouls2/icon_fire_reduction","Fire",r.fire_defense,s.fire_defense);a+=Re.renderAttribute("darksouls2/icon_magic_reduction","Magic",r.magic_defense,s.magic_defense);a+=Re.renderAttribute("darksouls2/icon_lightning_reduction","Lightning",r.lightning_defense,s.lightning_defense);a+=Re.renderAttribute("darksouls2/icon_dark_reduction","Dark",r.dark_defense,s.dark_defense);return this.statsBoxTemplate({title:"Elemental Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=Re.renderAttribute("darksouls2/icon_bleed_reduction","Bleed",r.bleed_resist,s.bleed_resist);a+=Re.renderAttribute("darksouls2/icon_poison_reduction","Poison",r.poison_resist,s.poison_resist);a+=Re.renderAttribute("darksouls2/icon_curse_reduction","Curse",r.curse_resist,s.curse_resist);a+=Re.renderAttribute("darksouls2/icon_petrify_reduction","Petrify",r.petrify_resist,s.petrify_resist);return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",r=e.req_param||{},s=t.req_param||{};a+=Re.renderAttribute("darksouls2/icon_strength","Strength",r.strength,s.strength);a+=Re.renderAttribute("darksouls2/icon_dexterity","Dexterity",r.dexterity,s.dexterity);a+=Re.renderAttribute("darksouls2/icon_intelligence","Intelligence",r.intelligence,s.intelligence);a+=Re.renderAttribute("darksouls2/icon_faith","Faith",r.faith,s.faith);return this.statsBoxTemplate({title:"Req Param",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=Re.renderAttribute("darksouls2/icon_poise","Poise",r.poise,s.poise);a+=Re.renderAttribute("darksouls2/icon_weight","Weight",r.weight,s.weight,{isNegative:true});a+=Re.renderAttribute("darksouls2/icon_durability","Durability",r.durability,s.durability,{isInteger:true});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})}});N.Armor.View.prototype.renderSetsEvolution=function(e,t){var a=new N.Armor.Model;Re.drawArmorEvolutions([this.buildEvolutionDataSet(e,a.defenseCalculation,a.resistanceCalculation),this.buildEvolutionDataSet(t,a.defenseCalculation,a.resistanceCalculation)])};N.Armor.View.prototype.renderDefensesChart=function(e,t){var a=new N.Armor.Model;Re.drawArmorDefenses(a.getCategories(),e.name,a.defenseChartData(e),t.name,a.defenseChartData(t))};N.Armor.Model=Backbone.Model.extend({getCategories:function(){return["Regular Def","Slash Def","Strike Def","Thrust Def","Fire Def","Magic Red","Lightning Red","Bleed Res","Poison Res","Curse Res","Poise","Weight"]},defenseCalculation:function(e){var t=0;t+=Re.parseValue(e.stats.physical_defense);t+=Re.parseValue(e.stats.slash_defense);t+=Re.parseValue(e.stats.strike_defense);t+=Re.parseValue(e.stats.thrust_defense);t+=Re.parseValue(e.stats.fire_defense);t+=Re.parseValue(e.stats.magic_defense);t+=Re.parseValue(e.stats.lightning_defense);t+=Re.parseValue(e.stats.dark_defense);return t},resistanceCalculation:function(e){var t=0;t+=Re.parseValue(e.stats.bleed_resist);t+=Re.parseValue(e.stats.curse_resist);t+=Re.parseValue(e.stats.poison_resist);t+=Re.parseValue(e.stats.petrify_resist);return t},defenseChartData:function(e){return[Re.parseValue(e.stats.physical_defense),Re.parseValue(e.stats.slash_defense),Re.parseValue(e.stats.strike_defense),Re.parseValue(e.stats.thrust_defense),Re.parseValue(e.stats.fire_defense),Re.parseValue(e.stats.magic_defense),Re.parseValue(e.stats.lightning_defense),Re.parseValue(e.stats.dark_defense),Re.parseValue(e.stats.bleed_resist),Re.parseValue(e.stats.poison_resist),Re.parseValue(e.stats.curse_resist),Re.parseValue(e.stats.petrify_resist),Re.parseValue(e.stats.poise),Re.parseValue(e.stats.weight)]}});var Fe=Backbone.View.extend({initialize:function(){this.isArmor=false;this.game="darksouls2";this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateDamageWeightRatio:function(e){var t;t=Re.parseValue(e.stats.physical_damage);t+=Re.parseValue(e.stats.fire_damage);t+=Re.parseValue(e.stats.magic_damage);t+=Re.parseValue(e.stats.lightning_damage);t+=Re.parseValue(e.stats.dark_damage);return t/4/Re.parseValue(e.stats.weight)},calculateStabilityWeightRation:function(e){return Re.parseValue(e.stats.stability)/Re.parseValue(e.stats.weight)},renderDamageStats:function(e,t){var a="",r=e.stats,s=t.stats,i=this.calculateDamageWeightRatio(e),n=this.calculateDamageWeightRatio(t);a+=Re.renderAttribute("darksouls2/icon_physical_damage","Physical",r.physical_damage,s.physical_damage);a+=Re.renderAttribute("darksouls2/icon_magic_damage","Magic",r.magic_damage,s.magic_damage);a+=Re.renderAttribute("darksouls2/icon_fire_damage","Fire",r.fire_damage,s.fire_damage);a+=Re.renderAttribute("darksouls2/icon_lightning_damage","Lightning",r.lightning_damage,s.lightning_damage);a+=Re.renderAttribute("darksouls2/icon_dark_damage","Dark",r.dark_damage,s.dark_damage);a+=Re.renderAttribute("darksouls2/icon_physical_damage","Dmg/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Damage/Weight"});return this.statsBoxTemplate({title:"Damage",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderAuxDamageStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=Re.renderAttribute("darksouls2/icon_poison_damage","Poison",r.poison_damage,s.poison_damage);a+=Re.renderAttribute("darksouls2/icon_bleed_damage","Bleed",r.bleed_damage,s.bleed_damage);a+=Re.renderAttribute("darksouls2/icon_counter_damage","Counter",r.counter_damage,s.counter_damage);a+=Re.renderAttribute("darksouls2/icon_poise_damage","Poise",r.poise_damage,s.poise_damage);return this.statsBoxTemplate({title:"Aux. Damage",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderReductionStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=Re.renderAttribute("darksouls2/icon_physical_reduction","Physical",r.physical_reduction,s.physical_reduction);a+=Re.renderAttribute("darksouls2/icon_magic_reduction","Magic",r.magic_reduction,s.magic_reduction);a+=Re.renderAttribute("darksouls2/icon_fire_reduction","Fire",r.fire_reduction,s.fire_reduction);a+=Re.renderAttribute("darksouls2/icon_lightning_reduction","Lightning",r.lightning_reduction,s.lightning_reduction);a+=Re.renderAttribute("darksouls2/icon_dark_reduction","Dark",r.dark_reduction,s.dark_reduction);return this.statsBoxTemplate({title:"Reduction",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderAuxReductionStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=Re.renderAttribute("darksouls2/icon_poison_reduction","Poison",r.poison_reduction,s.poison_reduction);a+=Re.renderAttribute("darksouls2/icon_bleed_reduction","Bleed",r.bleed_reduction,s.bleed_reduction);a+=Re.renderAttribute("darksouls2/icon_petrify_reduction","Petrify",r.petrify_reduction,s.petrify_reduction);a+=Re.renderAttribute("darksouls2/icon_curse_reduction","Curse",r.curse_reduction,s.curse_reduction);return this.statsBoxTemplate({title:"Aux. Reduction",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderParamBonus:function(e,t){var a="",r=e.param_bonus,s=t.param_bonus;a+=Re.renderAttribute("darksouls2/icon_strength_bonus","Strength",r.strength,s.strength,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls2/icon_dexterity_bonus","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls2/icon_magic_bonus","Magic",r.magic,s.magic,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls2/icon_fire_bonus","Fire",r.fire,s.fire,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls2/icon_lightning_bonus","Lightning",r.lightning,s.lightning,{isNegative:true,isString:true,invertSymbols:true});a+=Re.renderAttribute("darksouls2/icon_dark_bonus","Dark",r.dark,s.dark,{isNegative:true,isString:true,invertSymbols:true});return this.statsBoxTemplate({title:"Param Bonus",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",r=e.req_param,s=t.req_param;a+=Re.renderAttribute("darksouls2/icon_strength","Strength",r.strength,s.strength,{isNegative:true,isInteger:true});a+=Re.renderAttribute("darksouls2/icon_dexterity","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isInteger:true});a+=Re.renderAttribute("darksouls2/icon_intelligence","Intelligence",r.intelligence,s.intelligence,{isNegative:true,isInteger:true});a+=Re.renderAttribute("darksouls2/icon_faith","Faith",r.faith,s.faith,{isNegative:true,isInteger:true});return this.statsBoxTemplate({title:"Req Params",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderOthers:function(e,t,a){var r="",s=this.calculateStabilityWeightRation(e),i=this.calculateStabilityWeightRation(t);r+=Re.renderAttribute("darksouls2/icon_shot_range","Shot Range",e.stats.shot_range,t.stats.shot_range,{isNegative:true});r+=Re.renderAttribute("darksouls2/icon_stability","Stability",e.stats.stability,t.stats.stability);r+=Re.renderAttribute("darksouls2/icon_casting_speed","Casting Speed",e.stats.casting_speed,t.stats.casting_speed,{isNegative:true});r+=Re.renderAttribute("darksouls2/icon_weight","Weight",e.stats.weight,t.stats.weight,{isNegative:true});r+=Re.renderAttribute("darksouls2/icon_durability","Durability",e.stats.durability,t.stats.durability,{isInteger:true});r+=Re.renderAttribute("darksouls2/icon_stability","Sta/Wei",s.toFixed(2),i.toFixed(2),{tooltip:"Stability/Weight"});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:r,game:this.game,isArmor:this.isArmor})},render:function(e,t,a){var r=Re.renderImage(e,"attack_type","weapon_type");var s=Re.renderImage(t,"attack_type","weapon_type");var i="";i+=this.renderDamageStats(e,t);i+=this.renderAuxDamageStats(e,t);i+=this.renderReductionStats(e,t);i+=this.renderParamBonus(e,t);i+=this.renderReqParams(e,t);i+=this.renderOthers(e,t,a);i+=Re.renderChartBox("weapons-evolution","col-sm-12 col-md-12");i+=Re.renderChartBox("shields-evolution","col-sm-6 col-md-6");i+=Re.renderChartBox("shields-reduction","col-sm-6 col-md-6");content=this.contentTemplate({body:i,description1:r,description2:s,social:{up:true,down:true}});this.$el.html(content)}});Fe.prototype.renderWeaponsEvolution=function(e,t){var a=e.data.map(function(e){var t=0;t+=Re.parseValue(e.stats.physical_damage);t+=Re.parseValue(e.stats.magic_damage);t+=Re.parseValue(e.stats.fire_damage);t+=Re.parseValue(e.stats.lightning_damage);t+=Re.parseValue(e.stats.dark_damage);return t});var r=t.data.map(function(e){var t=0;t+=Re.parseValue(e.stats.physical_damage);t+=Re.parseValue(e.stats.magic_damage);t+=Re.parseValue(e.stats.fire_damage);t+=Re.parseValue(e.stats.lightning_damage);t+=Re.parseValue(e.stats.dark_damage);return t});Re.drawWeaponEvolution(e.name,a,t.name,r)};Fe.prototype.renderShieldsEvolution=function(e,t){var a=e.data.map(function(e){return Re.parseValue(e.stats.stability)});var r=t.data.map(function(e){return Re.parseValue(e.stats.stability)});Re.drawShieldEvolution(e.name,a,t.name,r)};Fe.prototype.renderReductionsChart=function(e,t){var a=["Physical Red","Fire Red","Magic Red","Lightning Red","Dark Red","Bleed Res","Poison Res","Curse Res","Petrify Res","Stability","Weight"];var r=[Re.parseValue(e.stats.physical_reduction),Re.parseValue(e.stats.magic_reduction),Re.parseValue(e.stats.fire_reduction),Re.parseValue(e.stats.lightning_reduction),Re.parseValue(e.stats.dark_reduction),Re.parseValue(e.stats.bleed_reduction),Re.parseValue(e.stats.poison_reduction),Re.parseValue(e.stats.curse_reduction),Re.parseValue(e.stats.petrify_reduction),Re.parseValue(e.stats.stability),Re.parseValue(e.weight)];var s=[Re.parseValue(t.stats.physical_reduction),Re.parseValue(t.stats.magic_reduction),Re.parseValue(t.stats.fire_reduction),Re.parseValue(t.stats.lightning_reduction),Re.parseValue(t.stats.dark_reduction),Re.parseValue(t.stats.bleed_reduction),Re.parseValue(t.stats.poison_reduction),Re.parseValue(t.stats.curse_reduction),Re.parseValue(t.stats.petrify_reduction),Re.parseValue(t.stats.stability),Re.parseValue(t.weight)];Re.drawShieldsReductions(a,e.name,r,t.name,s)};