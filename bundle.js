var e={game:null,type:null,token:null,Models:{}};var t={Armor:{},Weapon:{}};var a={Armor:{},Weapon:{}};Handlebars.registerHelper("toTitleCase",function(e){return e.split("_").map(function(e){return e[0].toUpperCase()+e.slice(1,e.length)}).join(" ")});e.Firebase=function(){var t="NotFound";firebase.initializeApp({databaseURL:"https://darksoulscomparator.firebaseio.com"});var a=firebase.database();var r=function(e,t){return e+"/"+t};var s=function(e){var t=[];Object.keys(e).forEach(function(a){var r=e[a];t.push(r)});var a=t.sort(function(e,t){if(e.level<t.level)return-1;if(e.level===t.level)return 0;if(e.level>t.level)return 1});return a};return{getByField:function(i,n,o){return new Promise(function(l,u){a.ref(r(e.game,i)).orderByChild(n).equalTo(o).once("value").then(function(e){var a=e.val();if(a){a=s(a);l(a)}else{u(t)}})})},getAllByName:function(e,t){return this.getByField(e,"base_name",t)},getAllBySHA:function(e,a){return this.getByField(e,"sha",a).then(function(a){var r=a[Object.keys(a)[0]];if(typeof r.base_name==="undefined"){return Promise.reject(t)}else{return this.getAllByName(e,r.base_name)}}.bind(this)).catch(function(e){return Promise.reject(e)})},getAllBySet:function(e){return new Promise(function(t,a){this.getByField("armors","set",e).then(function(e){var a={head:[],chest:[],hands:[],legs:[]};Object.keys(e).forEach(function(t){var r=e[t];a[r.piece.toLowerCase()].push(r)});M.forEach(function(e){a[e]=a[e].sort(function(e,t){if(e.level<t.level)return-1;if(e.level===t.level)return 0;if(e.level>t.level)return 1})});t(a)}).catch(function(e){return Promise.reject(e)})}.bind(this))},getIndexes:function(){return a.ref(r(e.game,"indexes")).once("value")}}}();var r=function(e){this.ref=new Firebase("https://darksoulscomparator.firebaseIO.com")};r.prototype.fetchByField=function(t,a,r){var s=this.ref;return new Promise(function(i,n){s.child(e.game+"/"+t).orderByChild(a).equalTo(r).once("value",function(e){var t=e.val();if(!t)n();i(t[Object.keys(t)[0]])})})};r.prototype.fetchWeaponEvolutionData=function(e,t,a,r){var s=this.ref;return new Promise(function(i,n){s.child(e+"/"+t).orderByChild(a).startAt(r).endAt(r+" +999").once("value",function(e){var t=e.val();if(!t)n();i({name:r,data:Object.keys(t).map(function(e){return t[e]})})})})};r.prototype.fetchArmorEvolutionData=function(e,t,a){var r=this;var s=a.pieces.filter(function(e){return e.name!=="Naked Head"&&e.name!=="Naked Chest"&&e.name!=="Naked Hands"&&e.name!=="Naked Legs"});return Promise.all(s.map(function(e){var a=L(e.name);return r.fetchWeaponEvolutionData(Z,"armors",t,a)}))};r.prototype.fetchArmorPiece=function(e,t,a,r){var s=this.ref;return new Promise(function(i,n){if(r!=="naked"){s.child(e+"/armors").orderByChild(t).equalTo(r).once("value",function(e){var t=e.val(),r;if(t===null){r=new de("Error fetching "+a.capitalize(),a)}else{r=t[Object.keys(t)[0]]}i(r)})}else{var o=new de("Naked "+a.capitalize(),a);i(o)}})};var s=0;var i="";function n(e){return f(m(b(e)))}function o(e){return g(m(b(e)))}function l(e,t){return v(m(b(e)),t)}function u(e,t){return f(p(b(e),b(t)))}function c(e,t){return g(p(b(e),b(t)))}function d(e,t,a){return v(p(b(e),b(t)),a)}function h(){return n("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function m(e){return w(V(k(e),e.length*8))}function p(e,t){var a=k(e);if(a.length>16)a=V(a,e.length*8);var r=Array(16),s=Array(16);for(var i=0;i<16;i++){r[i]=a[i]^909522486;s[i]=a[i]^1549556828}var n=V(r.concat(k(t)),512+t.length*8);return w(V(s.concat(n),512+128))}function f(e){try{s}catch(t){s=0}var a=s?"0123456789ABCDEF":"0123456789abcdef";var r="";var i;for(var n=0;n<e.length;n++){i=e.charCodeAt(n);r+=a.charAt(i>>>4&15)+a.charAt(i&15)}return r}function g(e){try{i}catch(t){i=""}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var r="";var s=e.length;for(var n=0;n<s;n+=3){var o=e.charCodeAt(n)<<16|(n+1<s?e.charCodeAt(n+1)<<8:0)|(n+2<s?e.charCodeAt(n+2):0);for(var l=0;l<4;l++){if(n*8+l*6>e.length*8)r+=i;else r+=a.charAt(o>>>6*(3-l)&63)}}return r}function v(e,t){var a=t.length;var r,s,i,n,o;var l=Array(Math.ceil(e.length/2));for(r=0;r<l.length;r++){l[r]=e.charCodeAt(r*2)<<8|e.charCodeAt(r*2+1)}var u=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));var c=Array(u);for(s=0;s<u;s++){o=Array();n=0;for(r=0;r<l.length;r++){n=(n<<16)+l[r];i=Math.floor(n/a);n-=i*a;if(o.length>0||i>0)o[o.length]=i}c[s]=n;l=o}var d="";for(r=c.length-1;r>=0;r--)d+=t.charAt(c[r]);return d}function b(e){var t="";var a=-1;var r,s;while(++a<e.length){r=e.charCodeAt(a);s=a+1<e.length?e.charCodeAt(a+1):0;if(55296<=r&&r<=56319&&56320<=s&&s<=57343){r=65536+((r&1023)<<10)+(s&1023);a++}if(r<=127)t+=String.fromCharCode(r);else if(r<=2047)t+=String.fromCharCode(192|r>>>6&31,128|r&63);else if(r<=65535)t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63);else if(r<=2097151)t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63)}return t}function y(e){var t="";for(var a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)&255,e.charCodeAt(a)>>>8&255);return t}function A(e){var t="";for(var a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)>>>8&255,e.charCodeAt(a)&255);return t}function k(e){var t=Array(e.length>>2);for(var a=0;a<t.length;a++)t[a]=0;for(var a=0;a<e.length*8;a+=8)t[a>>5]|=(e.charCodeAt(a/8)&255)<<a%32;return t}function w(e){var t="";for(var a=0;a<e.length*32;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function V(e,t){e[t>>5]|=128<<t%32;e[(t+64>>>9<<4)+14]=t;var a=1732584193;var r=-271733879;var s=-1732584194;var i=271733878;for(var n=0;n<e.length;n+=16){var o=a;var l=r;var u=s;var c=i;a=x(a,r,s,i,e[n+0],7,-680876936);i=x(i,a,r,s,e[n+1],12,-389564586);s=x(s,i,a,r,e[n+2],17,606105819);r=x(r,s,i,a,e[n+3],22,-1044525330);a=x(a,r,s,i,e[n+4],7,-176418897);i=x(i,a,r,s,e[n+5],12,1200080426);s=x(s,i,a,r,e[n+6],17,-1473231341);r=x(r,s,i,a,e[n+7],22,-45705983);a=x(a,r,s,i,e[n+8],7,1770035416);i=x(i,a,r,s,e[n+9],12,-1958414417);s=x(s,i,a,r,e[n+10],17,-42063);r=x(r,s,i,a,e[n+11],22,-1990404162);a=x(a,r,s,i,e[n+12],7,1804603682);i=x(i,a,r,s,e[n+13],12,-40341101);s=x(s,i,a,r,e[n+14],17,-1502002290);r=x(r,s,i,a,e[n+15],22,1236535329);a=C(a,r,s,i,e[n+1],5,-165796510);i=C(i,a,r,s,e[n+6],9,-1069501632);s=C(s,i,a,r,e[n+11],14,643717713);r=C(r,s,i,a,e[n+0],20,-373897302);a=C(a,r,s,i,e[n+5],5,-701558691);i=C(i,a,r,s,e[n+10],9,38016083);s=C(s,i,a,r,e[n+15],14,-660478335);r=C(r,s,i,a,e[n+4],20,-405537848);a=C(a,r,s,i,e[n+9],5,568446438);i=C(i,a,r,s,e[n+14],9,-1019803690);s=C(s,i,a,r,e[n+3],14,-187363961);r=C(r,s,i,a,e[n+8],20,1163531501);a=C(a,r,s,i,e[n+13],5,-1444681467);i=C(i,a,r,s,e[n+2],9,-51403784);s=C(s,i,a,r,e[n+7],14,1735328473);r=C(r,s,i,a,e[n+12],20,-1926607734);a=D(a,r,s,i,e[n+5],4,-378558);i=D(i,a,r,s,e[n+8],11,-2022574463);s=D(s,i,a,r,e[n+11],16,1839030562);r=D(r,s,i,a,e[n+14],23,-35309556);a=D(a,r,s,i,e[n+1],4,-1530992060);i=D(i,a,r,s,e[n+4],11,1272893353);s=D(s,i,a,r,e[n+7],16,-155497632);r=D(r,s,i,a,e[n+10],23,-1094730640);a=D(a,r,s,i,e[n+13],4,681279174);i=D(i,a,r,s,e[n+0],11,-358537222);s=D(s,i,a,r,e[n+3],16,-722521979);r=D(r,s,i,a,e[n+6],23,76029189);a=D(a,r,s,i,e[n+9],4,-640364487);i=D(i,a,r,s,e[n+12],11,-421815835);s=D(s,i,a,r,e[n+15],16,530742520);r=D(r,s,i,a,e[n+2],23,-995338651);a=R(a,r,s,i,e[n+0],6,-198630844);i=R(i,a,r,s,e[n+7],10,1126891415);s=R(s,i,a,r,e[n+14],15,-1416354905);r=R(r,s,i,a,e[n+5],21,-57434055);a=R(a,r,s,i,e[n+12],6,1700485571);i=R(i,a,r,s,e[n+3],10,-1894986606);s=R(s,i,a,r,e[n+10],15,-1051523);r=R(r,s,i,a,e[n+1],21,-2054922799);a=R(a,r,s,i,e[n+8],6,1873313359);i=R(i,a,r,s,e[n+15],10,-30611744);s=R(s,i,a,r,e[n+6],15,-1560198380);r=R(r,s,i,a,e[n+13],21,1309151649);a=R(a,r,s,i,e[n+4],6,-145523070);i=R(i,a,r,s,e[n+11],10,-1120210379);s=R(s,i,a,r,e[n+2],15,718787259);r=R(r,s,i,a,e[n+9],21,-343485551);a=P(a,o);r=P(r,l);s=P(s,u);i=P(i,c)}return Array(a,r,s,i)}function S(e,t,a,r,s,i){return P(W(P(P(t,e),P(r,i)),s),a)}function x(e,t,a,r,s,i,n){return S(t&a|~t&r,e,t,s,i,n)}function C(e,t,a,r,s,i,n){return S(t&r|a&~r,e,t,s,i,n)}function D(e,t,a,r,s,i,n){return S(t^a^r,e,t,s,i,n)}function R(e,t,a,r,s,i,n){return S(a^(t|~r),e,t,s,i,n)}function P(e,t){var a=(e&65535)+(t&65535);var r=(e>>16)+(t>>16)+(a>>16);return r<<16|a&65535}function W(e,t){return e<<t|e>>>32-t}var B={parse:function(e){e=e.replace("?","");var t={};e.split("&").forEach(function(e){var a=e.split("=")[0];var r=e.split("=")[1];t[a]=r});return t}};String.prototype.capitalize=function(){return this,this.charAt(0).toUpperCase()+this.slice(1)};e.Cookie=function(){return{get:function(e){var t=document.cookie.match(new RegExp(e+"=[a-zA-Z0-9.()=|%/_]+($|;)","g"));if(!t||!t[0])return null;else return unescape(t[0].substring(e.length+1,t[0].length).replace(";",""))||null},set:function(e,t,a,r){var s=[e+"="+escape(t),"path="+(!a||a==""?"/":a),"domain="+(!r||r==""?window.location.host:r)];return document.cookie=s.join("; ")}}}();e.Token=function(){var e=function(e){return["B",e.sha,N,N,N].join("")};var t=function(e){return["F",e.pieces.filter(function(e){return e.piece==="Head"})[0].sha,e.pieces.filter(function(e){return e.piece==="Chest"})[0].sha,e.pieces.filter(function(e){return e.piece==="Hands"})[0].sha,e.pieces.filter(function(e){return e.piece==="Legs"})[0].sha].join("")};return{generate:function(a,r,s,i){var n=[],o,l,u;u=a===F.DkS1?"0":"1";tid=r==="weapons"?"0":r==="armors"?"1":"2";if(r==="armors"){o=t(s);l=t(i)}else{o=e(s);l=e(i)}n.push(u);n.push(tid);n.push(o);n.push(l);var c=n.join("");return c},load:function(){},isValid:function(e){if(e&&e!==""&&e.length===60){if(parseInt(e[0])>Object.keys(F).length-1)return false;if(parseInt(e[1])>O.length-1)return false}else{return false}return true}}}();e.UI=function(){var t=function(t){var a=unescape($('.set-comparator[data-item="'+t+'"]').selectpicker("val"));if(a!=="custom"){var r=new e.Models.ComparableObject(E.Single,H);var s=$('select.set-level[data-level="'+t+'"]').selectpicker("val");r.addItem(a,s)}else{var r=new e.Models.ComparableObject(E.Detailed,H);M.forEach(function(e){var a=$('select.detailed-comparator[data-item="'+t+'"][data-piece="'+e+'"]').selectpicker("val");var s=$('select.detailed-level[data-level="'+t+'"][data-piece="'+e+'"]').selectpicker("val");r.addItem(a,s,e)})}return r};var a=function(t){var a=unescape($('.basic-comparator[data-item="'+t+'"]').selectpicker("val"));var r=unescape($('.basic-level[data-level="'+t+'"]').selectpicker("val"));var s=new e.Models.ComparableObject("single",H);s.addItem(a,r);return s};return{resetView:function(){$("#by").selectpicker("val",null);$(".basic-level").selectpicker("val",null);$("#by-widgets").hide();$("#detailed-widgets").hide();$("#basic-widgets").hide();this.resetComparison();this.enableDetailedWidgets(false);this.clearDetailedWidgets();J.navigate(U)},resetComparison:function(){$("#comparison").html("")},resetAll:function(){$("#type").selectpicker("val",null);this.resetView()},showComparisonWidgets:function(e){if(e){$(".new-comparison-widgets").hide("slow");$("#comparison-widgets").show("slow")}else{$("#comparison-widgets").hide("slow");$(".new-comparison-widgets").show("slow")}},enableDetailedWidgets:function(e,t){var a=t?'[data-item="'+t+'"]':"";var r=$("select.detailed-comparator"+a);if(e){r.removeAttr("disabled")}else{r.attr("disabled","")}r.selectpicker("refresh");var s=t?'[data-level="'+t+'"]':"";r=$("select.detailed-level"+s);if(e){r.removeAttr("disabled")}else{r.attr("disabled","")}r.selectpicker("refresh");var i=$("select.set-level"+s);if(!e){i.removeAttr("disabled")}else{i.attr("disabled","")}i.selectpicker("refresh")},clearDetailedWidgets:function(){$("select.detailed-comparator").selectpicker("deselectAll");$("select.detailed-level").selectpicker("deselectAll")},enableCompareButton:function(e){if(e){$("button#compare").removeAttr("disabled")}else{$("button#compare").attr("disabled","")}},showModal:function(e,t,a,r){$(".modal-title").text(e);if(t){$(".modal-body").html(t)}if(a){$(".modal-close").hide();$(".modal-body").html('<div><img src="http://i.imgur.com/unIj1Le.gif" /></div>'+'<p class="waiting">Please wait...</p>'+'<span class="credits">Image by <a href="http://zedotagger.deviantart.com/" target="_blank">Zedotagger</a></span>')}else{$(".modal-close").show()}if(r){$(".modal-footer").show()}else{$(".modal-footer").hide()}$("#modal-dialog").modal("show")},hideModal:function(){$("#modal-dialog").modal("hide")},showErrMessage:function(e){alert("There was an error fetching the information for the requested element.\n\nERR: "+e)},getComparisonData:function(){var e=H===I.Armors?t:a;return[e("1"),e("2")]}}}();e.View=function(){var r=function(){if(e.game===F.DkS1){if(H===I.Armors)return new t.Armor.View({el:"#comparison"});return new t.Weapon.View({el:"#comparison"})}else if(e.game===F.DkS2){if(H===I.Armors)return new a.Armor.View({el:"#comparison"});return new a.Weapon.View({el:"#comparison"})}};return{renderData:function(e){var t=H===I.Shields;var a=r();a.render(e[0].comparison,e[1].comparison,t);if(H===I.Armors){a.renderSetsEvolution(e[0].evolution,e[1].evolution)}else if(H===I.Weapons){a.renderWeaponsEvolution(e[0].evolution,e[1].evolution)}else{a.renderShieldsEvolution(e[0].evolution,e[1].evolution);a.renderReductionsChart(e[0].comparison,e[1].comparison)}}}}();e.Controller=function(){var t=function(t){return new Promise(function(a,r){e.Firebase.getAllBySet(unescape(t.name)).then(function(e){var r={comparison:{pieces:[e["head"][t.level],e["chest"][t.level],e["hands"][t.level],e["legs"][t.level]]},evolution:e};a(r)}).catch(function(e){r(e)})})};var a=function(t){return new Promise(function(a,r){e.Firebase.getAllByName(H,unescape(t.name)).then(function(e){var r={comparison:e[t.level],evolution:e};a(r)}).catch(function(e){r(e)})})};var r=function(t){return new Promise(function(a,r){var s=[];t.forEach(function(t){if(t.name==="Naked"){s.push(Promise.resolve(new de("",t.piece)))}else{s.push(e.Firebase.getAllByName("armors",unescape(t.name)))}});Promise.all(s).then(function(e){e={head:e[0],chest:e[1],hands:e[2],legs:e[3]};var r={comparison:{pieces:[e["head"][t[0].level],e["chest"][t[1].level],e["hands"][t[2].level],e["legs"][t[3].level]]},evolution:e};a(r)}).catch(function(e){r(e)})})};return{fetch:function(e){var s=[];for(var i=0;i<e.length;i++){var n=e[i];if(n.isSingle()&&n.isArmor()){s.push(t(n.getSingle()))}else if(n.isSingle()&&!n.isArmor()){s.push(a(n.getSingle()))}else if(n.isDetailed()){s.push(r(n.getDetails()))}}return Promise.all(s)}}}();var F={DkS1:"darksouls1",DkS2:"darksouls2"};var I={Weapons:"weapons",Armors:"armors",Shields:"shields"};var E={Single:"single",Detailed:"detailed"};var T=300;var M=["head","chest","hands","legs"];var N="0000000";var O=["weapons","armors","shields"];var j="This website uses cookies to collect statistical information in anonymous form on "+"usage of the website. We also use cookies to save your preferences and provide a better experience. "+"However, we do not register any information that can identify you personally.<br/><br/>A cookie is "+"a small text file saved to your computer and allows our website to follow your visit and to recognize "+"your computer when you visit our website again. A cookie is not a program and does not contain virus, "+"nor spreads malicious software.";var U="/soulscomparator";var L=function(e){return e.split("+")[0].trim()};var q={armors:[],shields:[],weapons:[],pieces:{head:[],chest:[],hands:[],legs:[]}};var H=null;var z={1:null,2:null};var Z=e.Cookie.get("game")||F.DkS1;e.game=e.Cookie.get("game")||F.DkS1;var Q=null;var G=null;var J=null;var K=Handlebars.compile($("#social-template").html());X();function X(){e.UI.showModal("Loading...",null,true);e.Firebase.getIndexes().then(function(t){data=t.val();console.log("indexes",data);q.weapons=data.weapons[ne(data.weapons)];q.armors=data.armors[ne(data.armors)];q.shields=data.shields[ne(data.shields)];q.pieces=data.pieces[ne(data.pieces)];ae();$("#type").removeAttr("disabled");$("#type").selectpicker("refresh");$("select.basic-comparator").on("change",function(e){var t=unescape($(this).val());var a=$(this).attr("data-item");var r=$("#type").val();var s=q[r].filter(function(e){return ne(e)===t})[0][t];re(a,s)});$("select.detailed-comparator").on("change",function(e){var t=unescape($(this).val());var a=$(this).attr("data-item");var r=$(this).attr("data-piece");var s=0;if(t!=="naked"&&t){s=q.pieces[r].filter(function(e){return ne(e)===t})[0][t]}se(a,r,s)});e.UI.hideModal()})}var Y=Backbone.Router.extend({});$(document).ready(function(){Backbone.history.start({pushState:true});J=new Y;e.UI.enableDetailedWidgets(false);$("#game").val(Z);$("#game").on("change",function(t){Z=$(this).val();e.UI.resetView();$("#type").attr("disabled","");$("#type").selectpicker("val",null);e.Cookie.set("game",Z);X()});$("#type").on("change",function(t){H=$(this).val();e.UI.resetView();if(H==="armors"){te()}else{ee()}});$(".set-comparator").on("change",function(t){var a=$(this).val();var r=$(this).attr("data-item");if(a==="custom"){e.UI.enableDetailedWidgets(r)}else{a=unescape(a);var s=q.armors.filter(function(e){return ne(e)===a})[0][a];e.UI.enableDetailedWidgets(false,r);ie(r,s)}var i=unescape($('.set-comparator[data-item="1"]').selectpicker("val"));var n=unescape($('.set-comparator[data-item="2"]').selectpicker("val"));if(i==="custom"||n==="custom"){$("#detailed-widgets").show()}else{$("#detailed-widgets").hide()}});$("button#compare").on("click",function(t){e.UI.enableCompareButton(false);var a=e.UI.getComparisonData();e.Controller.fetch(a).then(function(t){console.log("results",t);e.View.renderData(t);e.UI.enableCompareButton(true);e.UI.showComparisonWidgets(false)}).catch(function(t){e.UI.showErrMessage(t);e.UI.resetComparison();e.UI.enableCompareButton(true)})});$(".new-comparison").on("click",function(t){e.UI.showComparisonWidgets(true);e.UI.resetComparison();$("html, body").animate({scrollTop:$(".navbar").offset().top},500)});$("#cookies-policy").on("click",function(t){t.preventDefault();e.UI.showModal("Cookies Policy",j,null,true);return false});oe()});function ee(){var e="";q[H].map(function(e){return ne(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});$("select.basic-comparator").html(e);$("select.basic-comparator").selectpicker("refresh");$("#basic-widgets").show()}function te(){var e='<option value="custom">Custom</option>';e+='<optgroup label="Sets">';q[H].map(function(e){return ne(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});e+="</optgroup>";$("select.set-comparator").html(e);$("select.set-comparator").selectpicker("refresh");$("#by-widgets").show()}function ae(){Object.keys(q.pieces).forEach(function(e){var t='<option value="naked">Naked</option>';t+='<option data-divider="true"></option>';var a=q.pieces[e].map(function(e){return ne(e)}).sort();a.forEach(function(e){t+='<option value="'+escape(e)+'">'+e+"</option>"});var r=$('select.detailed-comparator[data-piece="'+e+'"]');r.html(t);r.selectpicker("refresh")})}function re(e,t){var a='<option value="0" selected>0</option>';for(var r=1;r<=t;r++){a+='<option value="'+r+'">+'+r+"</option>"}var s=$('select.basic-level[data-level="'+e+'"]');s.html(a);s.selectpicker("refresh")}function se(e,t,a){var r='<option value="0" selected>0</option>';for(var s=1;s<=a;s++){r+='<option value="'+s+'">+'+s+"</option>"}var i=$('select.detailed-level[data-level="'+e+'"][data-piece="'+t+'"]');i.html(r);i.selectpicker("refresh")}function ie(e,t){var a='<option value="0" selected>0</option>';for(var r=1;r<=t;r++){a+='<option value="'+r+'">+'+r+"</option>"}var s=$('select.set-level[data-level="'+e+'"]');s.html(a);s.selectpicker("refresh")}function ne(e){return Object.keys(e)[0]}function oe(){if(window.location.search==="")return;var r=B.parse(window.location.search).token;if(tokenIsValid(r)){G=r;var s=parseInt(r[0])+1;var i=parseInt(r[1]);$("#game :nth-child("+s+")").prop("selected",true);Z=$("#game").val();var n=O[i];if(i===1){var o=r.substr(2,29);var l={head:o.substr(1,7),chest:o.substr(8,7),hands:o.substr(15,7),legs:o.substr(22,7)};o=r.substr(31,29);var u={head:o.substr(1,7),chest:o.substr(8,7),hands:o.substr(15,7),legs:o.substr(22,7)};var c=fetchArmors("sha","sha",l,u).then(function(r){if(Z===F.DkS1){Q=new t.Armor.View({el:"#comparison"})}else if(Z===F.DkS2){Q=new a.Armor.View({el:"#comparison"})}getArmorEvolutionData(r[0],r[1],n).then(function(e){Q.renderSetsEvolution(e[0],e[1])});Q.render(r[0],r[1]);le(Z,n,r[0],r[1]);e.UI.enableCompareButton(true)}).catch(function(t){e.UI.showErrMessage(t);J.navigate(U)})}else{var d=r.substr(2,29).substr(1,7);var h=r.substr(31,29).substr(1,7);var m=n==="shields";var c=fetchSingleItemsFromSha(n,d,h).then(function(t){if(Z===F.DkS1){Q=new DarkSouls1WeaponsView({el:"#comparison"})}else if(Z===F.DkS2){Q=new DarkSouls2WeaponsView({el:"#comparison"})}getEvolutionData(t[0].name,t[1].name,n).then(function(e){if(n==="weapons"){Q.renderWeaponsEvolution(e[0],e[1])}else{Q.renderShieldsEvolution(e[0],e[1]);Q.renderReductionsChart(t[0],t[1])}});Q.render(t[0],t[1],m);le(Z,n,t[0],t[1]);e.UI.enableCompareButton(true)}).catch(function(t){e.UI.showErrMessage(t);J.navigate(U)})}}else{alert("Invalid token");J.navigate(U)}}function le(t,a,r,s){var i,n;if(G){i=window.location.toString();n=window.location.pathname+window.location.search}else{var o=e.Token.generate(t,a,r,s);var l=window.location.pathname;l=l[l.length-1]==="/"?l:l+"/";n=l+"?token="+o;i=window.location.origin+n}var u=K({url:i});$(".social-buttons").html(u);$('input[name="share-link"]').val(i);$('input[name="share-link"]').focus(function(){$(this).select()});loadSocial();$(".social-buttons").show();J.navigate(n)}var ue=function(){var e=Handlebars.compile($("#attribute-template").html());var t=Handlebars.compile($("#image-template").html());var a=Handlebars.compile($("#chart-box-template").html());var r=["-","–","S","A","B","C","D","E"];var s=function(e,t){if(e!==t){if(e==="S"){return-1}else if(t==="S"){return 1}else if(e==="-"&&t!=="-"){return 1}else if(e!=="-"&&t==="-"){return-1}else{if(e>t)return 1;if(e<t)return-1}}else{return 0}};return{renderAttribute:function(t,a,i,n,o){o=o||{};var l=color2="",u="=";if(o.isNegative){goodColor="red";badColor="blue"}else{goodColor="blue";badColor="red"}if(o.invertSymbols){biggerThanSymbol="<";lesserThanSymbol=">"}else{biggerThanSymbol=">";lesserThanSymbol="<"}if(!o.isString){i=i==="–"||i==="-"||i===""?0:parseFloat(i);n=n==="–"||n==="-"||n===""?0:parseFloat(n)}if(s(i,n)>0){l=goodColor;color2=badColor;u=biggerThanSymbol}else if(s(i,n)<0){l=badColor;color2=goodColor;u=lesserThanSymbol}if(!o.isInteger&&!o.isPercentage){i=r.indexOf(i)>=0?i:i.toFixed(1);n=r.indexOf(n)>=0?n:n.toFixed(1)}if(o.isPercentage){i=i+"%";n=n+"%"}tooltip=o.tooltip||a;var c={key:a,icon:{root:U,icon:t,caption:a},tooltip:tooltip,color1:l,color2:color2,value1:i,value2:n,symbol:u};if(o.notIcon)delete c.icon;return e(c)},renderImage:function(e,a,r){var s=e[a];var i=e[r];return t({name:unescape(e.name),source:e.wiki_image,title1:a,title2:r,type1:s,type2:i})},renderChartBox:function(e,t){return a({id:e,layout:t})},drawWeaponEvolution:function(e,t,a,r){var s=[];for(var i=0;i<Math.max(t.length,r.length);i++){s.push("+"+i)}$("#weapons-evolution").highcharts({chart:{height:T},title:{text:"Weapons damage evolution"},credits:{enabled:false},yAxis:{title:{text:"Total Damage"}},xAxis:{categories:s},series:[{data:t,name:e},{data:r,name:a}]})},drawShieldEvolution:function(e,t,a,r){var s=[];for(var i=0;i<Math.max(t.length,r.length);i++){s.push("+"+i)}$("#shields-evolution").highcharts({chart:{height:T},title:{text:"Shields stability evolution"},credits:{enabled:false},yAxis:{title:{text:"Stability"}},xAxis:{categories:s},series:[{data:t,name:e},{data:r,name:a}]})},drawShieldsReductions:function(e,t,a,r,s){$("#shields-reduction").highcharts({chart:{polar:true,type:"line",height:T},title:{text:"Shields Reduction"},credits:{enabled:false},xAxis:{categories:e,lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},legend:{align:"center",verticalAlign:"bottom",layout:"vertical"},series:[{name:t,data:a,pointPlacement:"on"},{name:r,data:s,pointPlacement:"on"}]})},drawArmorEvolutions:function(e){var t=[];for(var a=0;a<Math.max(e[0].resistances.length,e[1].resistances.length);a++){t.push("+"+a)}$("#sets-defense-evolution").highcharts({chart:{height:T},title:{text:"Defense evolution by set"},credits:{enabled:false},yAxis:{title:{text:"Total defense (physical + elemental)"}},xAxis:{categories:t},series:[{data:e[0].defenses,name:e[0].name},{data:e[1].defenses,name:e[1].name}]});$("#sets-resistance-evolution").highcharts({chart:{height:T},title:{text:"Resistance evolution by set"},credits:{enabled:false},yAxis:{title:{text:"Total resistance (all resistances)"}},xAxis:{categories:t},series:[{data:e[0].resistances,name:e[0].name},{data:e[1].resistances,name:e[1].name}]})},drawArmorDefenses:function(e,t,a,r,s){$("#sets-defense").highcharts({chart:{polar:true,type:"line",height:T},credits:{enabled:false},title:{text:"Defenses by set"},xAxis:{categories:e,lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},legend:{align:"center",verticalAlign:"bottom",layout:"vertical"},series:[{name:t,data:a,pointPlacement:"on"},{name:r,data:s,pointPlacement:"on"}]})},unescape:function(e){e=unescape(e);return e},parseValue:function(e){var t=parseFloat(e);return isNaN(t)?0:t}}}();var ce=Backbone.View.extend({initialize:function(){this.isArmor=true;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},renderSets:function(e,t){var a=ue.renderImage(e,"type");var r=ue.renderImage(t,"type");var s="";s+=this.renderPhysicalDefense(e,t);s+=this.renderElementalDefense(e,t);s+=this.renderResistances(e,t);s+=this.renderOthers(e,t);return this.contentTemplate({body:s,description1:a,description2:r,social:{up:true}})},renderPiece:function(e,t){t=t||{};var a="";var r=_.find(this.armor1.pieces,{piece:e})||{};var s=_.find(this.armor2.pieces,{piece:e})||{};var i=ue.renderImage(r,"type");var n=ue.renderImage(s,"type");var a="";a+=this.renderPhysicalDefense(r,s);a+=this.renderElementalDefense(r,s);a+=this.renderResistances(r,s);a+=this.renderOthers(r,s);return this.contentTemplate({body:a,description1:i,description2:n,social:{down:t.social}})},render:function(e,t){this.armor1=e;this.armor2=t;this.set1=this.calculateSetStats(this.armor1);this.set2=this.calculateSetStats(this.armor2);var a=this.renderSets(this.set1,this.set2);a+=ue.renderChartBox("sets-defense-evolution","col-sm-12 col-md-6 col-lg-4");a+=ue.renderChartBox("sets-resistance-evolution","col-sm-12 col-md-6 col-lg-4");a+=ue.renderChartBox("sets-defense","col-sm-12 col-md-6 col-lg-4");a+=this.renderPiece("Head");a+=this.renderPiece("Chest");a+=this.renderPiece("Hands");a+=this.renderPiece("Legs",{social:true});this.$el.html(a);this.renderDefensesChart(this.set1,this.set2)}});t.Armor.View=ce.extend({calculateSetStats:function(e){var t=new de;for(var a=0;a<e.pieces.length;a++){var r=e.pieces[a];t.elemental_defense.fire+=parseFloat(r.elemental_defense.fire);t.elemental_defense.lightning+=parseFloat(r.elemental_defense.lightning);t.elemental_defense.magic+=parseFloat(r.elemental_defense.magic);t.physical_defense.regular+=parseFloat(r.physical_defense.regular);t.physical_defense.strike+=parseFloat(r.physical_defense.strike);t.physical_defense.slash+=parseFloat(r.physical_defense.slash);t.physical_defense.thrust+=parseFloat(r.physical_defense.thrust);t.resistances.bleed+=parseFloat(r.resistances.bleed);t.resistances.poison+=parseFloat(r.resistances.poison);t.resistances.curse+=parseFloat(r.resistances.curse);t.weight+=parseFloat(r.weight);t.poise+=parseFloat(r.poise);t.durability+=parseInt(r.durability);if(t.name===""){t.name=r.set}else if(r.set!==t.name){t.name="Custom Set"}t.type=r.type}return t},calculatePhysicalWeightRatio:function(e){if(_.isEmpty(e)||e.weight===0)return 0;var t;t=ue.parseValue(e.physical_defense.regular);t+=ue.parseValue(e.physical_defense.strike);t+=ue.parseValue(e.physical_defense.slash);t+=ue.parseValue(e.physical_defense.thrust);return t/4/ue.parseValue(e.weight)},calculateElementalWeightRatio:function(e){if(_.isEmpty(e)||e.weight===0)return 0;var t;t=ue.parseValue(e.elemental_defense.fire);t+=ue.parseValue(e.elemental_defense.magic);t+=ue.parseValue(e.elemental_defense.lightning);return t/3/ue.parseValue(e.weight)},calculatePoiseWeightRatio:function(e){if(e.weight===0)return 0;return ue.parseValue(e.poise)/ue.parseValue(e.weight)},renderPhysicalDefense:function(e,t){var a="",r=e.physical_defense||{},s=t.physical_defense||{},i=this.calculatePhysicalWeightRatio(e),n=this.calculatePhysicalWeightRatio(t);a+=ue.renderAttribute("darksouls1/icon_regular_defense","Regular",r.regular,s.regular);a+=ue.renderAttribute("darksouls1/icon_strike_defense","Strike",r.strike,s.strike);a+=ue.renderAttribute("darksouls1/icon_slash_defense","Slash",r.slash,s.slash);a+=ue.renderAttribute("darksouls1/icon_thrust_defense","Thrust",r.thrust,s.thrust);a+=ue.renderAttribute("darksouls1/icon_regular_defense","Def/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Physical Defense/Weight"});return this.statsBoxTemplate({title:"Physical Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderElementalDefense:function(e,t){var a="",r=e.elemental_defense||{},s=t.elemental_defense||{},i=this.calculateElementalWeightRatio(e),n=this.calculateElementalWeightRatio(t);a+=ue.renderAttribute("darksouls1/icon_fire_defense","Fire",r.fire,s.fire);a+=ue.renderAttribute("darksouls1/icon_magic_defense","Magic",r.magic,s.magic);a+=ue.renderAttribute("darksouls1/icon_lightning_defense","Lightning",r.lightning,s.lightning);a+=ue.renderAttribute("darksouls1/icon_fire_defense","Ele/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Elemental Defense/Weight"});return this.statsBoxTemplate({title:"Elemental Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",r=e.resistances||{},s=t.resistances||{};a+=ue.renderAttribute("darksouls1/icon_bleed","Bleed",r.bleed,s.bleed);a+=ue.renderAttribute("darksouls1/icon_poison","Poison",r.poison,s.poison);a+=ue.renderAttribute("darksouls1/icon_curse","Curse",r.curse,s.curse);return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t){var a=this.calculatePoiseWeightRatio(e),r=this.calculatePoiseWeightRatio(t),s="";s+=ue.renderAttribute("darksouls1/icon_poise","Poise",e.poise,t.poise);s+=ue.renderAttribute("darksouls1/icon_weight","Weight",e.weight,t.weight,{isNegative:true});s+=ue.renderAttribute("darksouls1/icon_durability","Durability",e.durability,t.durability,{isInteger:true});s+=ue.renderAttribute("darksouls1/icon_poise","Poi/Wei",a.toFixed(2),r.toFixed(2),{tooltip:"Poise/Weight"});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:s,isArmor:this.isArmor})}});t.Armor.View.prototype.renderSetsEvolution=function(e,a){var r=new t.Armor.Model;ue.drawArmorEvolutions([r.buildEvolutionDataSet(e),r.buildEvolutionDataSet(a)])};t.Armor.View.prototype.renderDefensesChart=function(e,a){var r=new t.Armor.Model;ue.drawArmorDefenses(r.getCategories(),e.name,r.defenseChartData(e),a.name,r.defenseChartData(a))};t.Weapon.View=Backbone.View.extend({initialize:function(){this.isArmor=false;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateDamageWeightRatio:function(e){var t;t=ue.parseValue(e.stats.physical_damage);t+=ue.parseValue(e.stats.fire_damage);t+=ue.parseValue(e.stats.magic_damage);t+=ue.parseValue(e.stats.lightning_damage);return t/4/ue.parseValue(e.weight)},calculateStabilityWeightRation:function(e){return ue.parseValue(e.stats.stability)/ue.parseValue(e.weight)},renderDamageStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=ue.renderAttribute("darksouls1/icon_physical_damage","Regular",r.physical_damage,s.physical_damage);a+=ue.renderAttribute("darksouls1/icon_magic_damage","Magic",r.magic_damage,s.magic_damage);

a+=ue.renderAttribute("darksouls1/icon_fire_damage","Fire",r.fire_damage,s.fire_damage);a+=ue.renderAttribute("darksouls1/icon_lightning_damage","Lightning",r.lightning_damage,s.lightning_damage);a+=ue.renderAttribute("darksouls1/icon_critical","Critical",r.critical,s.critical);return this.statsBoxTemplate({title:"Damage",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReductionStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=ue.renderAttribute("darksouls1/icon_physical_reduction","Physical",r.physical_reduction,s.physical_reduction);a+=ue.renderAttribute("darksouls1/icon_magic_reduction","Magic",r.magic_reduction,s.magic_reduction);a+=ue.renderAttribute("darksouls1/icon_fire_reduction","Fire",r.fire_reduction,s.fire_reduction);a+=ue.renderAttribute("darksouls1/icon_lightning_reduction","Lightning",r.lightning_reduction,s.lightning_reduction);a+=ue.renderAttribute("darksouls1/icon_stability","Stability",r.stability,s.stability);return this.statsBoxTemplate({title:"Reduction",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderParamBonus:function(e,t){var a="",r=e.param_bonus,s=t.param_bonus;a+=ue.renderAttribute("darksouls1/icon_strength","Strength",r.strength,s.strength,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls1/icon_dexterity","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls1/icon_intelligence","Intelligence",r.intelligence,s.intelligence,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls1/icon_faith","Faith",r.faith,s.faith,{isNegative:true,isString:true,invertSymbols:true});return this.statsBoxTemplate({title:"Param Bonus",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",r=e.req_param,s=t.req_param;a+=ue.renderAttribute("darksouls1/icon_strength","Strength",r.strength,s.strength,{isNegative:true,isInteger:true});a+=ue.renderAttribute("darksouls1/icon_dexterity","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isInteger:true});a+=ue.renderAttribute("darksouls1/icon_intelligence","Intelligence",r.intelligence,s.intelligence,{isNegative:true,isInteger:true});a+=ue.renderAttribute("darksouls1/icon_faith","Faith",r.faith,s.faith,{isNegative:true,isInteger:true});return this.statsBoxTemplate({title:"Req Params",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderAuxEffects:function(e,t){var a="",r=e.aux_effect,s=t.aux_effect;a+=ue.renderAttribute("darksouls1/icon_bleed","Bleed",r.bleed,s.bleed,{isInteger:true});a+=ue.renderAttribute("darksouls1/icon_toxic","Toxic",r.toxic,s.toxic,{isInteger:true});a+=ue.renderAttribute("darksouls1/icon_occult","Occult",r.occult,s.occult,{isInteger:true});a+=ue.renderAttribute("darksouls1/icon_divine","Divine",r.divine,s.divine,{isInteger:true});return this.statsBoxTemplate({title:"Aux Effects",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",r=e.resistances,s=t.resistances;a+=ue.renderAttribute("darksouls1/icon_bleed","Bleed",r.bleed,s.bleed,{isPercentage:true});a+=ue.renderAttribute("darksouls1/icon_poison","Poison",r.poison,s.poison,{isPercentage:true});a+=ue.renderAttribute("darksouls1/icon_toxic","Toxic",r.toxic,s.toxic,{isPercentage:true});a+=ue.renderAttribute("darksouls1/icon_curse","Curse",r.curse,s.curse,{isPercentage:true});return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t,a){var r="",s=e.stats,i=t.stats;r+=ue.renderAttribute("darksouls1/icon_weight","Weight",e.weight,t.weight,{isNegative:true});r+=ue.renderAttribute("darksouls1/icon_durability","Durability",e.durability,t.durability,{isInteger:true});if(e.magic_adjust||t.magic_adjust){r+=ue.renderAttribute("darksouls1/icon_magic_adjust","Magic Adjust",e.magic_adjust,t.magic_adjust,{isInteger:true})}if(a){var n=this.calculateStabilityWeightRation(e);var o=this.calculateStabilityWeightRation(t);r+=ue.renderAttribute("darksouls1/icon_stability","Sta/Wei",n.toFixed(2),o.toFixed(2),{tooltip:"Stability/Weight"})}else{var l=this.calculateDamageWeightRatio(e);var u=this.calculateDamageWeightRatio(t);r+=ue.renderAttribute("darksouls1/icon_physical_damage","Dmg/Wei",l.toFixed(2),u.toFixed(2),{tooltip:"Damage/Weight"})}return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},render:function(e,t,a){var r=ue.renderImage(e,"attack_type","weapon_type");var s=ue.renderImage(t,"attack_type","weapon_type");var i="";i+=this.renderDamageStats(e,t);i+=this.renderReductionStats(e,t);i+=this.renderParamBonus(e,t);i+=this.renderReqParams(e,t);if(a){i+=this.renderResistances(e,t)}else{i+=this.renderAuxEffects(e,t)}i+=this.renderOthers(e,t,a);i+=ue.renderChartBox("weapons-evolution","col-sm-12 col-md-12");i+=ue.renderChartBox("shields-evolution","col-sm-6 col-md-6");i+=ue.renderChartBox("shields-reduction","col-sm-6 col-md-6");content=this.contentTemplate({body:i,description1:r,description2:s,social:{up:true,down:true}});this.$el.html(content)}});t.Weapon.View.prototype.renderWeaponsEvolution=function(e,t){var a=e.map(function(e){var t=0;t+=ue.parseValue(e.stats.physical_damage);t+=ue.parseValue(e.stats.magic_damage);t+=ue.parseValue(e.stats.fire_damage);t+=ue.parseValue(e.stats.lightning_damage);return t});var r=t.map(function(e){var t=0;t+=ue.parseValue(e.stats.physical_damage);t+=ue.parseValue(e.stats.magic_damage);t+=ue.parseValue(e.stats.fire_damage);t+=ue.parseValue(e.stats.lightning_damage);return t});ue.drawWeaponEvolution(e.name,a,t.name,r)};t.Weapon.View.prototype.renderShieldsEvolution=function(e,t){var a=e.map(function(e){return ue.parseValue(e.stats.stability)});var r=t.map(function(e){return ue.parseValue(e.stats.stability)});ue.drawShieldEvolution(e.name,a,t.name,r)};t.Weapon.View.prototype.renderReductionsChart=function(e,t){var a=["Physical Red","Fire Red","Magic Red","Lightning Red","Bleed Res","Poison Res","Curse Res","Stability","Weight"];var r=[ue.parseValue(e.stats.physical_reduction),ue.parseValue(e.stats.magic_reduction),ue.parseValue(e.stats.fire_reduction),ue.parseValue(e.stats.lightning_reduction),ue.parseValue(e.resistances.bleed),ue.parseValue(e.resistances.poison),ue.parseValue(e.resistances.curse),ue.parseValue(e.stats.stability),ue.parseValue(e.weight)];var s=[ue.parseValue(t.stats.physical_reduction),ue.parseValue(t.stats.magic_reduction),ue.parseValue(t.stats.fire_reduction),ue.parseValue(t.stats.lightning_reduction),ue.parseValue(t.resistances.bleed),ue.parseValue(t.resistances.poison),ue.parseValue(t.resistances.curse),ue.parseValue(t.stats.stability),ue.parseValue(t.weight)];ue.drawShieldsReductions(a,e.name,r,t.name,s)};a.Armor.View=ce.extend({calculateSetStats:function(e){var t=new de;for(var a=0;a<e.pieces.length;a++){var r=e.pieces[a];t.stats.physical_defense+=parseFloat(r.stats.physical_defense);t.stats.strike_defense+=parseFloat(r.stats.strike_defense);t.stats.slash_defense+=parseFloat(r.stats.slash_defense);t.stats.thrust_defense+=parseFloat(r.stats.thrust_defense);t.stats.fire_defense+=parseFloat(r.stats.fire_defense);t.stats.lightning_defense+=parseFloat(r.stats.lightning_defense);t.stats.magic_defense+=parseFloat(r.stats.magic_defense);t.stats.dark_defense+=parseFloat(r.stats.dark_defense);t.stats.bleed_resist+=parseFloat(r.stats.bleed_resist);t.stats.poison_resist+=parseFloat(r.stats.poison_resist);t.stats.curse_resist+=parseFloat(r.stats.curse_resist);t.stats.dark_resist+=parseFloat(r.stats.dark_resist);t.stats.weight+=parseFloat(r.stats.weight);t.stats.poise+=parseFloat(r.stats.poise);t.stats.durability+=parseInt(r.stats.durability);if(t.name===""){t.name=r.set}else if(r.set!==t.name){t.name="Custom Set"}t.type=r.type}return t},calculatePhysicalWeightRatio:function(e){if(e.stats.weight===0)return 0;var t;t=ue.parseValue(e.stats.physical_defense);t+=ue.parseValue(e.stats.strike_defense);t+=ue.parseValue(e.stats.slash_defense);t+=ue.parseValue(e.stats.thrust_defense);return t/4/ue.parseValue(e.stats.weight)},calculateElementalWeightRatio:function(e){if(e.stats.weight===0)return 0;var t;t=ue.parseValue(e.stats.fire_defense);t+=ue.parseValue(e.stats.magic_defense);t+=ue.parseValue(e.stats.lightning_defense);t+=ue.parseValue(e.stats.dark_defense);return t/4/ue.parseValue(e.stats.weight)},calculatePoiseWeightRatio:function(e){if(e.stats.weight===0)return 0;return ue.parseValue(e.stats.poise)/ue.parseValue(e.stats.weight)},renderPhysicalDefense:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=ue.renderAttribute("darksouls2/icon_physical_reduction","Physical",r.physical_defense,s.physical_defense);a+=ue.renderAttribute("darksouls2/icon_strike_reduction","Strike",r.strike_defense,s.strike_defense);a+=ue.renderAttribute("darksouls2/icon_slash_reduction","Slash",r.slash_defense,s.slash_defense);a+=ue.renderAttribute("darksouls2/icon_thrust_reduction","Thrust",r.thrust_defense,s.thrust_defense);return this.statsBoxTemplate({title:"Physical Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderElementalDefense:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=ue.renderAttribute("darksouls2/icon_fire_reduction","Fire",r.fire_defense,s.fire_defense);a+=ue.renderAttribute("darksouls2/icon_magic_reduction","Magic",r.magic_defense,s.magic_defense);a+=ue.renderAttribute("darksouls2/icon_lightning_reduction","Lightning",r.lightning_defense,s.lightning_defense);a+=ue.renderAttribute("darksouls2/icon_dark_reduction","Dark",r.dark_defense,s.dark_defense);return this.statsBoxTemplate({title:"Elemental Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=ue.renderAttribute("darksouls2/icon_bleed_reduction","Bleed",r.bleed_resist,s.bleed_resist);a+=ue.renderAttribute("darksouls2/icon_poison_reduction","Poison",r.poison_resist,s.poison_resist);a+=ue.renderAttribute("darksouls2/icon_curse_reduction","Curse",r.curse_resist,s.curse_resist);a+=ue.renderAttribute("darksouls2/icon_petrify_reduction","Petrify",r.petrify_resist,s.petrify_resist);return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",r=e.req_param||{},s=t.req_param||{};a+=ue.renderAttribute("darksouls2/icon_strength","Strength",r.strength,s.strength);a+=ue.renderAttribute("darksouls2/icon_dexterity","Dexterity",r.dexterity,s.dexterity);a+=ue.renderAttribute("darksouls2/icon_intelligence","Intelligence",r.intelligence,s.intelligence);a+=ue.renderAttribute("darksouls2/icon_faith","Faith",r.faith,s.faith);return this.statsBoxTemplate({title:"Req Param",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t){var a="",r=e.stats||{},s=t.stats||{};a+=ue.renderAttribute("darksouls2/icon_poise","Poise",r.poise,s.poise);a+=ue.renderAttribute("darksouls2/icon_weight","Weight",r.weight,s.weight,{isNegative:true});a+=ue.renderAttribute("darksouls2/icon_durability","Durability",r.durability,s.durability,{isInteger:true});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})}});a.Armor.View.prototype.renderSetsEvolution=function(e,t){var r=new a.Armor.Model;ue.drawArmorEvolutions([this.buildEvolutionDataSet(e,r.defenseCalculation,r.resistanceCalculation),this.buildEvolutionDataSet(t,r.defenseCalculation,r.resistanceCalculation)])};a.Armor.View.prototype.renderDefensesChart=function(e,t){var r=new a.Armor.Model;ue.drawArmorDefenses(r.getCategories(),e.name,r.defenseChartData(e),t.name,r.defenseChartData(t))};a.Weapon.View=Backbone.View.extend({initialize:function(){this.isArmor=false;this.game="darksouls2";this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateDamageWeightRatio:function(e){var t;t=ue.parseValue(e.stats.physical_damage);t+=ue.parseValue(e.stats.fire_damage);t+=ue.parseValue(e.stats.magic_damage);t+=ue.parseValue(e.stats.lightning_damage);t+=ue.parseValue(e.stats.dark_damage);return t/4/ue.parseValue(e.stats.weight)},calculateStabilityWeightRation:function(e){return ue.parseValue(e.stats.stability)/ue.parseValue(e.stats.weight)},renderDamageStats:function(e,t){var a="",r=e.stats,s=t.stats,i=this.calculateDamageWeightRatio(e),n=this.calculateDamageWeightRatio(t);a+=ue.renderAttribute("darksouls2/icon_physical_damage","Physical",r.physical_damage,s.physical_damage);a+=ue.renderAttribute("darksouls2/icon_magic_damage","Magic",r.magic_damage,s.magic_damage);a+=ue.renderAttribute("darksouls2/icon_fire_damage","Fire",r.fire_damage,s.fire_damage);a+=ue.renderAttribute("darksouls2/icon_lightning_damage","Lightning",r.lightning_damage,s.lightning_damage);a+=ue.renderAttribute("darksouls2/icon_dark_damage","Dark",r.dark_damage,s.dark_damage);a+=ue.renderAttribute("darksouls2/icon_physical_damage","Dmg/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Damage/Weight"});return this.statsBoxTemplate({title:"Damage",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderAuxDamageStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=ue.renderAttribute("darksouls2/icon_poison_damage","Poison",r.poison_damage,s.poison_damage);a+=ue.renderAttribute("darksouls2/icon_bleed_damage","Bleed",r.bleed_damage,s.bleed_damage);a+=ue.renderAttribute("darksouls2/icon_counter_damage","Counter",r.counter_damage,s.counter_damage);a+=ue.renderAttribute("darksouls2/icon_poise_damage","Poise",r.poise_damage,s.poise_damage);return this.statsBoxTemplate({title:"Aux. Damage",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderReductionStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=ue.renderAttribute("darksouls2/icon_physical_reduction","Physical",r.physical_reduction,s.physical_reduction);a+=ue.renderAttribute("darksouls2/icon_magic_reduction","Magic",r.magic_reduction,s.magic_reduction);a+=ue.renderAttribute("darksouls2/icon_fire_reduction","Fire",r.fire_reduction,s.fire_reduction);a+=ue.renderAttribute("darksouls2/icon_lightning_reduction","Lightning",r.lightning_reduction,s.lightning_reduction);a+=ue.renderAttribute("darksouls2/icon_dark_reduction","Dark",r.dark_reduction,s.dark_reduction);return this.statsBoxTemplate({title:"Reduction",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderAuxReductionStats:function(e,t){var a="",r=e.stats,s=t.stats;a+=ue.renderAttribute("darksouls2/icon_poison_reduction","Poison",r.poison_reduction,s.poison_reduction);a+=ue.renderAttribute("darksouls2/icon_bleed_reduction","Bleed",r.bleed_reduction,s.bleed_reduction);a+=ue.renderAttribute("darksouls2/icon_petrify_reduction","Petrify",r.petrify_reduction,s.petrify_reduction);a+=ue.renderAttribute("darksouls2/icon_curse_reduction","Curse",r.curse_reduction,s.curse_reduction);return this.statsBoxTemplate({title:"Aux. Reduction",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderParamBonus:function(e,t){var a="",r=e.param_bonus,s=t.param_bonus;a+=ue.renderAttribute("darksouls2/icon_strength_bonus","Strength",r.strength,s.strength,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls2/icon_dexterity_bonus","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls2/icon_magic_bonus","Magic",r.magic,s.magic,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls2/icon_fire_bonus","Fire",r.fire,s.fire,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls2/icon_lightning_bonus","Lightning",r.lightning,s.lightning,{isNegative:true,isString:true,invertSymbols:true});a+=ue.renderAttribute("darksouls2/icon_dark_bonus","Dark",r.dark,s.dark,{isNegative:true,isString:true,invertSymbols:true});return this.statsBoxTemplate({title:"Param Bonus",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",r=e.req_param,s=t.req_param;a+=ue.renderAttribute("darksouls2/icon_strength","Strength",r.strength,s.strength,{isNegative:true,isInteger:true});a+=ue.renderAttribute("darksouls2/icon_dexterity","Dexterity",r.dexterity,s.dexterity,{isNegative:true,isInteger:true});a+=ue.renderAttribute("darksouls2/icon_intelligence","Intelligence",r.intelligence,s.intelligence,{isNegative:true,isInteger:true});a+=ue.renderAttribute("darksouls2/icon_faith","Faith",r.faith,s.faith,{isNegative:true,isInteger:true});return this.statsBoxTemplate({title:"Req Params",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderOthers:function(e,t,a){var r="",s=this.calculateStabilityWeightRation(e),i=this.calculateStabilityWeightRation(t);r+=ue.renderAttribute("darksouls2/icon_shot_range","Shot Range",e.stats.shot_range,t.stats.shot_range,{isNegative:true});r+=ue.renderAttribute("darksouls2/icon_stability","Stability",e.stats.stability,t.stats.stability);r+=ue.renderAttribute("darksouls2/icon_casting_speed","Casting Speed",e.stats.casting_speed,t.stats.casting_speed,{isNegative:true});r+=ue.renderAttribute("darksouls2/icon_weight","Weight",e.stats.weight,t.stats.weight,{isNegative:true});r+=ue.renderAttribute("darksouls2/icon_durability","Durability",e.stats.durability,t.stats.durability,{isInteger:true});r+=ue.renderAttribute("darksouls2/icon_stability","Sta/Wei",s.toFixed(2),i.toFixed(2),{tooltip:"Stability/Weight"});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:r,game:this.game,isArmor:this.isArmor})},render:function(e,t,a){var r=ue.renderImage(e,"attack_type","weapon_type");var s=ue.renderImage(t,"attack_type","weapon_type");var i="";i+=this.renderDamageStats(e,t);i+=this.renderAuxDamageStats(e,t);i+=this.renderReductionStats(e,t);i+=this.renderParamBonus(e,t);i+=this.renderReqParams(e,t);i+=this.renderOthers(e,t,a);i+=ue.renderChartBox("weapons-evolution","col-sm-12 col-md-12");i+=ue.renderChartBox("shields-evolution","col-sm-6 col-md-6");i+=ue.renderChartBox("shields-reduction","col-sm-6 col-md-6");content=this.contentTemplate({body:i,description1:r,description2:s,social:{up:true,down:true}});this.$el.html(content)}});a.Weapon.View.prototype.renderWeaponsEvolution=function(e,t){var a=e.data.map(function(e){var t=0;t+=ue.parseValue(e.stats.physical_damage);t+=ue.parseValue(e.stats.magic_damage);t+=ue.parseValue(e.stats.fire_damage);t+=ue.parseValue(e.stats.lightning_damage);t+=ue.parseValue(e.stats.dark_damage);return t});var r=t.data.map(function(e){var t=0;t+=ue.parseValue(e.stats.physical_damage);t+=ue.parseValue(e.stats.magic_damage);t+=ue.parseValue(e.stats.fire_damage);t+=ue.parseValue(e.stats.lightning_damage);t+=ue.parseValue(e.stats.dark_damage);return t});ue.drawWeaponEvolution(e.name,a,t.name,r)};a.Weapon.View.prototype.renderShieldsEvolution=function(e,t){var a=e.data.map(function(e){return ue.parseValue(e.stats.stability)});var r=t.data.map(function(e){return ue.parseValue(e.stats.stability)});ue.drawShieldEvolution(e.name,a,t.name,r)};a.Weapon.View.prototype.renderReductionsChart=function(e,t){var a=["Physical Red","Fire Red","Magic Red","Lightning Red","Dark Red","Bleed Res","Poison Res","Curse Res","Petrify Res","Stability","Weight"];var r=[ue.parseValue(e.stats.physical_reduction),ue.parseValue(e.stats.magic_reduction),ue.parseValue(e.stats.fire_reduction),ue.parseValue(e.stats.lightning_reduction),ue.parseValue(e.stats.dark_reduction),ue.parseValue(e.stats.bleed_reduction),ue.parseValue(e.stats.poison_reduction),ue.parseValue(e.stats.curse_reduction),ue.parseValue(e.stats.petrify_reduction),ue.parseValue(e.stats.stability),ue.parseValue(e.weight)];var s=[ue.parseValue(t.stats.physical_reduction),ue.parseValue(t.stats.magic_reduction),ue.parseValue(t.stats.fire_reduction),ue.parseValue(t.stats.lightning_reduction),ue.parseValue(t.stats.dark_reduction),ue.parseValue(t.stats.bleed_reduction),ue.parseValue(t.stats.poison_reduction),ue.parseValue(t.stats.curse_reduction),ue.parseValue(t.stats.petrify_reduction),ue.parseValue(t.stats.stability),ue.parseValue(t.weight)];ue.drawShieldsReductions(a,e.name,r,t.name,s)};t.Armor.Model=Backbone.Model.extend({getCategories:function(){return["Regular Def","Slash Def","Strike Def","Thrust Def","Fire Def","Magic Red","Lightning Red","Dark Res","Bleed Res","Poison Res","Curse Res","Petrify Res","Poise","Weight"]},defenseCalculation:function(e){var t=0;t+=ue.parseValue(e.physical_defense.regular);t+=ue.parseValue(e.physical_defense.slash);t+=ue.parseValue(e.physical_defense.strike);t+=ue.parseValue(e.physical_defense.thrust);t+=ue.parseValue(e.elemental_defense.fire);t+=ue.parseValue(e.elemental_defense.magic);t+=ue.parseValue(e.elemental_defense.lightning);return t},resistanceCalculation:function(e){var t=0;t+=ue.parseValue(e.resistances.bleed);t+=ue.parseValue(e.resistances.curse);t+=ue.parseValue(e.resistances.poison);return t},defenseChartData:function(e){return[ue.parseValue(e.physical_defense.regular),ue.parseValue(e.physical_defense.slash),ue.parseValue(e.physical_defense.strike),ue.parseValue(e.physical_defense.thrust),ue.parseValue(e.elemental_defense.fire),ue.parseValue(e.elemental_defense.magic),ue.parseValue(e.elemental_defense.lightning),ue.parseValue(e.resistances.bleed),ue.parseValue(e.resistances.poison),ue.parseValue(e.resistances.curse),ue.parseValue(e.poise),ue.parseValue(e.weight)]},calculationArrayPerPiece:function(e,t,a){var r=new Array(t);for(var s=0;s<=t;s++){r[s]=a(e[s])}return r},buildEvolutionDataSet:function(e){var t=_.map(Object.keys(e),function(t){return e[t].length-1});var a=Math.max.apply(null,_.map(t));var r={name:null,defenses:new Array(a),resistances:new Array(a)};var s=_.map(Object.keys(e),function(t){pieceArray=e[t];var s=L(pieceArray[0].set);if(r.name!==null&&r.name!==s&&r.name!=="Custom Set"){r.name="Custom Set"}else if(r.name===null){r.name=s}return{defenses:this.calculationArrayPerPiece(pieceArray,a,this.defenseCalculation),resistances:this.calculationArrayPerPiece(pieceArray,a,this.resistanceCalculation)}}.bind(this));for(var i=0;i<=a;i++){var n=function(e,t){return e+t};r.defenses[i]=_.reduce(_.map(s,function(e){return e.defenses[i]}),n);r.resistances[i]=_.reduce(_.map(s,function(e){return e.resistances[i]}),n)}return r}});a.Armor.Model=Backbone.Model.extend({getCategories:function(){return["Regular Def","Slash Def","Strike Def","Thrust Def","Fire Def","Magic Red","Lightning Red","Bleed Res","Poison Res","Curse Res","Poise","Weight"]},defenseCalculation:function(e){var t=0;t+=ue.parseValue(e.stats.physical_defense);t+=ue.parseValue(e.stats.slash_defense);t+=ue.parseValue(e.stats.strike_defense);t+=ue.parseValue(e.stats.thrust_defense);t+=ue.parseValue(e.stats.fire_defense);t+=ue.parseValue(e.stats.magic_defense);t+=ue.parseValue(e.stats.lightning_defense);t+=ue.parseValue(e.stats.dark_defense);return t},resistanceCalculation:function(e){var t=0;t+=ue.parseValue(e.stats.bleed_resist);t+=ue.parseValue(e.stats.curse_resist);t+=ue.parseValue(e.stats.poison_resist);t+=ue.parseValue(e.stats.petrify_resist);return t},defenseChartData:function(e){return[ue.parseValue(e.stats.physical_defense),ue.parseValue(e.stats.slash_defense),ue.parseValue(e.stats.strike_defense),ue.parseValue(e.stats.thrust_defense),ue.parseValue(e.stats.fire_defense),ue.parseValue(e.stats.magic_defense),ue.parseValue(e.stats.lightning_defense),ue.parseValue(e.stats.dark_defense),ue.parseValue(e.stats.bleed_resist),ue.parseValue(e.stats.poison_resist),ue.parseValue(e.stats.curse_resist),ue.parseValue(e.stats.petrify_resist),ue.parseValue(e.stats.poise),ue.parseValue(e.stats.weight)]}});e.Models.ComparisonQuery=function(e,t){this.query=[e,t]};e.Models.ComparableObject=function(e,t){this.comparison=e;this.type=t;this.items=[]};e.Models.ComparableObject.prototype.addItem=function(e,t,a){this.items.push({piece:a||null,name:e,level:t})};e.Models.ComparableObject.prototype.isSingle=function(){return this.comparison===E.Single};e.Models.ComparableObject.prototype.isDetailed=function(){return this.comparison===E.Detailed};e.Models.ComparableObject.prototype.isArmor=function(){return this.type===I.Armors};e.Models.ComparableObject.prototype.getSingle=function(){return this.items[0]};e.Models.ComparableObject.prototype.getDetails=function(){return this.items};var de=function(e,t){this.elemental_defense={fire:0,lightning:0,magic:0};this.physical_defense={regular:0,strike:0,slash:0,thrust:0};this.resistances={bleed:0,poison:0,curse:0};this.stats={fire_defense:0,lightning_defense:0,magic_defense:0,dark_defense:0,physical_defense:0,strike_defense:0,slash_defense:0,thrust_defense:0,bleed_resist:0,poison_resist:0,curse_resist:0,petrify_resist:0,weight:0,poise:0,durability:0};this.req_param={strength:0,dexterity:0,intelligence:0,faith:0};this.weight=0;this.poise=0;this.durability=0;this.physical_defense_bonus="-";this.name=e?e:t?"Naked "+t:"";this.type="N/A";if(t){this.piece=t.capitalize()}};de.constructor.prototype=de;