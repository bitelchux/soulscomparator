String.prototype.capitalize=function(){return this,this.charAt(0).toUpperCase()+this.slice(1)};var e=new Firebase("https://darksoulscomparator.firebaseIO.com");var t={armors:[],shields:[],weapons:[],pieces:{head:[],chest:[],hands:[],legs:[]}};var r=null;var i={1:null,2:null};e.child("ds1/indexes").on("value",function(e){data=e.val();t.weapons=data.weapons[A(data.weapons)];t.armors=data.armors[A(data.armors)];t.shields=data.shields[A(data.shields)];t.pieces=data.pieces[A(data.pieces)];n();$("#type").removeAttr("disabled");$("#type").selectpicker("refresh");$("select.basic-comparator").on("change",function(e){var r=unescape($(this).val());var i=$(this).attr("data-item");var a=$("#type").val();var s=t[a].filter(function(e){return A(e)===r})[0][r];l(i,s)});$("select.detailed-comparator").on("change",function(e){var r=unescape($(this).val());var i=$(this).attr("data-item");var a=$(this).attr("data-piece");var s=0;if(r!=="naked"&&r){s=t.pieces[a].filter(function(e){return A(e)===r})[0][r]}c(i,a,s)})});$(document).ready(function(){b();$("#type").on("change",function(e){r=$(this).val();$("#comparison").html("");$("#by-widgets").hide();$("#by").selectpicker("val",null);$("#detailed-widgets").hide();$("#basic-widgets").hide();b();y();if(r==="armors"){s()}else{a()}});$(".set-comparator").on("change",function(e){var r=$(this).val();var i=$(this).attr("data-item");if(r==="custom"){v(i)}else{r=unescape(r);var a=t.armors.filter(function(e){return A(e)===r})[0][r];b(i);o(i,a)}var s=unescape($('.set-comparator[data-item="1"]').selectpicker("val"));var n=unescape($('.set-comparator[data-item="2"]').selectpicker("val"));if(s==="custom"||n==="custom"){$("#detailed-widgets").show()}else{$("#detailed-widgets").hide()}});$("button#compare").on("click",function(e){g();var t=unescape($(this).val());if(r==="armors"){var i=d().then(function(e){var t=new x({el:"#comparison"}).render(e[0],e[1]);f()}).catch(function(e){alert(e);f()})}else{var i=u().then(function(e){var t=r==="shields";var i=new S({el:"#comparison"}).render(e[0],e[1],t);f()}).catch(function(e){alert(e);f()})}})});Handlebars.registerHelper("toTitleCase",function(e){return e.split("_").map(function(e){return e[0].toUpperCase()+e.slice(1,e.length)}).join(" ")});function a(){var e="";t[r].map(function(e){return A(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});$("select.basic-comparator").html(e);$("select.basic-comparator").selectpicker("refresh");$("#basic-widgets").show()}function s(){var e='<option value="custom">Custom</option>';e+='<optgroup label="Sets">';t[r].map(function(e){return A(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});e+="</optgroup>";$("select.set-comparator").html(e);$("select.set-comparator").selectpicker("refresh");$("#by-widgets").show()}function n(){Object.keys(t.pieces).forEach(function(e){var r='<option value="naked">Naked</option>';r+='<option data-divider="true"></option>';var i=t.pieces[e].map(function(e){return A(e)}).sort();i.forEach(function(e){r+='<option value="'+escape(e)+'">'+e+"</option>"});var a=$('select.detailed-comparator[data-piece="'+e+'"]');a.html(r);a.selectpicker("refresh")})}function l(e,t){var r='<option value="0" selected>0</option>';for(var i=1;i<=t;i++){r+='<option value="'+i+'">+'+i+"</option>"}var a=$('select.basic-level[data-level="'+e+'"]');a.html(r);a.selectpicker("refresh")}function c(e,t,r){var i='<option value="0" selected>0</option>';for(var a=1;a<=r;a++){i+='<option value="'+a+'">+'+a+"</option>"}var s=$('select.detailed-level[data-level="'+e+'"][data-piece="'+t+'"]');s.html(i);s.selectpicker("refresh")}function o(e,t){var r='<option value="0" selected>0</option>';for(var i=1;i<=t;i++){r+='<option value="'+i+'">+'+i+"</option>"}var a=$('select.set-level[data-level="'+e+'"]');a.html(r);a.selectpicker("refresh")}function u(){var t=unescape($('.basic-comparator[data-item="1"]').selectpicker("val"));var i=unescape($('.basic-comparator[data-item="2"]').selectpicker("val"));var a=unescape($('.basic-level[data-level="1"]').selectpicker("val"));var s=unescape($('.basic-level[data-level="2"]').selectpicker("val"));return new Promise(function(n,l){var c,o;var u=a!=="0"?t+" +"+a:t;var d=s!=="0"?i+" +"+s:i;e.child("ds1/"+r).orderByChild("name").equalTo(u).once("value",function(e){var t=e.val();c=t[Object.keys(t)[0]];if(c&&o)n([c,o])});e.child("ds1/"+r).orderByChild("name").equalTo(d).once("value",function(e){var t=e.val();o=t[Object.keys(t)[0]];if(c&&o)n([c,o])})})}function d(){var e=unescape($('.set-comparator[data-item="1"]').selectpicker("val"));var t=unescape($('.set-comparator[data-item="2"]').selectpicker("val"));return new Promise(function(r,i){var a,s;if(e==="custom"){var n=h(p(1))}else{var l=$('select.set-level[data-level="1"]').selectpicker("val");var c=l!=="0"?e+" +"+l:e;var n=m(c)}n.then(function(e){a=e;if(a&&s)r([a,s])});if(t==="custom"){var o=h(p(2))}else{var l=$('select.set-level[data-level="2"]').selectpicker("val");var u=l!=="0"?t+" +"+l:t;var o=m(u)}o.then(function(e){s=e;if(a&&s)r([a,s])})})}function m(t){return new Promise(function(r,i){e.child("ds1/armors").orderByChild("set").equalTo(t).once("value",function(e){var t=e.val();var i={pieces:[]};Object.keys(t).forEach(function(e){i.pieces.push(t[e])});r(i)})})}function h(r){return new Promise(function(i,a){var s={pieces:[]};Object.keys(t.pieces).forEach(function(t){if(r[t]){var a=unescape(r[t]);var n=new Promise(function(r,i){if(a!=="naked"){e.child("ds1/armors").orderByChild("name").equalTo(a).once("value",function(e){var t=e.val();var i=Object.keys(t)[0];r(t[i])})}else{var s=new k("Naked "+t.capitalize(),t);r(s)}});n.then(function(e){s.pieces.push(e);if(s.pieces.length===Object.keys(r).length){i(s)}})}})})}function p(e){var r={};Object.keys(t.pieces).forEach(function(t){var i=$('select.detailed-comparator[data-item="'+e+'"][data-piece="'+t+'"]').selectpicker("val");var a=$('select.detailed-level[data-level="'+e+'"][data-piece="'+t+'"]').selectpicker("val");r[t]=a!=="0"?i+" +"+a:i});return r}function f(){$("button#compare").removeAttr("disabled")}function g(e){$("button#compare").attr("disabled","")}function v(e){var t=e?'[data-item="'+e+'"]':"";var r=$("select.detailed-comparator"+t);r.removeAttr("disabled");r.selectpicker("refresh");var i=e?'[data-level="'+e+'"]':"";r=$("select.detailed-level"+i);r.removeAttr("disabled");r.selectpicker("refresh");var a=$("select.set-level"+i);a.attr("disabled","");a.selectpicker("refresh")}function b(e){var t=e?'[data-item="'+e+'"]':"";var r=$("select.detailed-comparator"+t);r.attr("disabled","");r.selectpicker("refresh");var i=e?'[data-level="'+e+'"]':"";r=$("select.detailed-level"+i);r.attr("disabled","");r.selectpicker("refresh");var a=$("select.set-level"+i);a.removeAttr("disabled");a.selectpicker("refresh")}function y(){$("select.detailed-comparator").selectpicker("deselectAll");$("select.detailed-level").selectpicker("deselectAll")}function A(e){return Object.keys(e)[0]}var x=Backbone.View.extend({initialize:function(){this.isArmor=true;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateSetStats:function(e){var t=new k;for(var r=0;r<e.pieces.length;r++){var i=e.pieces[r];t.elemental_defense.fire+=parseFloat(i.elemental_defense.fire);t.elemental_defense.lightning+=parseFloat(i.elemental_defense.lightning);t.elemental_defense.magic+=parseFloat(i.elemental_defense.magic);t.physical_defense.regular+=parseFloat(i.physical_defense.regular);t.physical_defense.strike+=parseFloat(i.physical_defense.strike);t.physical_defense.slash+=parseFloat(i.physical_defense.slash);t.physical_defense.thrust+=parseFloat(i.physical_defense.thrust);t.resistances.bleed+=parseFloat(i.resistances.bleed);t.resistances.poison+=parseFloat(i.resistances.poison);t.resistances.curse+=parseFloat(i.resistances.curse);t.weight+=parseFloat(i.weight);t.poise+=parseFloat(i.poise);t.durability+=parseInt(i.durability);if(t.name===""){t.name=i.set}else if(i.set!==t.name){t.name="Custom Set"}t.type=i.type}return t},renderChart:function(e,t){var r={chart:{renderTo:"chart",polar:true,type:"line"},title:{text:e.name+" vs "+t.name,x:-80},xAxis:{categories:["Regular Def","Strike Def","Slash Def","Thrust Def","Fire Def","Magic Def","Lightning Def","Bleed Res","Poison Res","Curse Res","Poise","Weight"],lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},legend:{align:"right",verticalAlign:"bottom",layout:"vertical"},series:[{name:e.name,data:[e.physical_defense.regular,e.physical_defense.strike,e.physical_defense.slash,e.physical_defense.thrust,e.elemental_defense.fire,e.elemental_defense.magic,e.elemental_defense.lightning,e.resistances.bleed,e.resistances.poison,e.resistances.curse,e.poise,e.weight],pointPlacement:"on"},{name:t.name,data:[t.physical_defense.regular,t.physical_defense.strike,t.physical_defense.slash,t.physical_defense.thrust,t.elemental_defense.fire,t.elemental_defense.magic,t.elemental_defense.lightning,t.resistances.bleed,t.resistances.poison,t.resistances.curse,t.poise,t.weight],pointPlacement:"on"}]};var i=new Highcharts.Chart(r)},renderSets:function(e,t){var r=w.renderImage(e,"type");var i=w.renderImage(t,"type");var a="";a+=this.renderPhysicalDefense(e,t);a+=this.renderElementalDefense(e,t);a+=this.renderResistances(e,t);a+=this.renderOthers(e,t);return this.contentTemplate({body:a,description1:r,description2:i})},renderPiece:function(e){var t="";var r=_.find(this.armor1.pieces,{piece:e})||{};var i=_.find(this.armor2.pieces,{piece:e})||{};var a=w.renderImage(r,"type");var s=w.renderImage(i,"type");var t="";t+=this.renderPhysicalDefense(r,i);t+=this.renderElementalDefense(r,i);t+=this.renderResistances(r,i);t+=this.renderOthers(r,i);return this.contentTemplate({body:t,description1:a,description2:s})},renderPhysicalDefense:function(e,t){var r="",i=e.physical_defense||{},a=t.physical_defense||{};r+=w.renderAttribute("regular_defense","Regular",i.regular,a.regular);r+=w.renderAttribute("strike_defense","Strike",i.strike,a.strike);r+=w.renderAttribute("slash_defense","Slashsh",i.slash,a.slash);r+=w.renderAttribute("thrust_defense","Thrust",i.thrust,a.thrust);return this.statsBoxTemplate({title:"Physical Defense",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderElementalDefense:function(e,t){var r="",i=e.elemental_defense||{},a=t.elemental_defense||{};r+=w.renderAttribute("fire_defense","Fire",i.fire,a.fire);r+=w.renderAttribute("magic_defense","Magic",i.magic,a.magic);r+=w.renderAttribute("lightning_defense","Lightning",i.lightning,a.lightning);return this.statsBoxTemplate({title:"Elemental Defense",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderResistances:function(e,t){var r="",i=e.resistances||{},a=t.resistances||{};r+=w.renderAttribute("bleed","Bleed",i.bleed,a.bleed);r+=w.renderAttribute("poison","Poison",i.poison,a.poison);r+=w.renderAttribute("curse","Curse",i.curse,a.curse);return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderOthers:function(e,t){var r="";r+=w.renderAttribute("poise","Poise",e.poise,t.poise);r+=w.renderAttribute("weight","Weight",e.weight,t.weight,{isNegative:true});r+=w.renderAttribute("durability","Durability",e.durability,t.durability,{isInteger:true});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},render:function(e,t){this.armor1=e;this.armor2=t;this.set1=this.calculateSetStats(this.armor1);this.set2=this.calculateSetStats(this.armor2);var r=this.renderSets(this.set1,this.set2);r+=this.renderPiece("Head");r+=this.renderPiece("Chest");r+=this.renderPiece("Hands");r+=this.renderPiece("Legs");this.$el.html(r)}});var k=function(e,t){this.elemental_defense={fire:0,lightning:0,magic:0};this.physical_defense={regular:0,strike:0,slash:0,thrust:0};this.resistances={bleed:0,poison:0,curse:0};this.weight=0;this.poise=0;this.durability=0;this.name=e?e:"";this.type="N/A";if(t){this.piece=t.capitalize()}};k.constructor.prototype=k;var S=Backbone.View.extend({initialize:function(){this.isArmor=false;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},parseNumber:function(e){if(e==="-"){return 0}else if(e==="S"){return 6}else if(e==="A"){return 5}else if(e==="B"){return 4}else if(e==="C"){return 3}else if(e==="D"){return 2}else if(e==="E"){return 1}else{attempt=parseFloat(e);if(isNaN(attempt)){return 0}return attempt}},convertForChart:function(e){return[this.parseNumber(e.stats.physical_damage),this.parseNumber(e.stats.magic_damage),this.parseNumber(e.stats.fire_damage),this.parseNumber(e.stats.lightning_damage),this.parseNumber(e.stats.critical),this.parseNumber(e.param_bonus.strength),this.parseNumber(e.param_bonus.dexterity),this.parseNumber(e.param_bonus.intelligence),this.parseNumber(e.param_bonus.faith),this.parseNumber(e.req_param.strength),this.parseNumber(e.req_param.dexterity),this.parseNumber(e.req_param.intelligence),this.parseNumber(e.req_param.faith),this.parseNumber(e.aux_effect.bleed),this.parseNumber(e.aux_effect.toxic),this.parseNumber(e.aux_effect.occult),this.parseNumber(e.aux_effect.divine),this.parseNumber(e.weight)]},renderChart:function(e,t){var r={chart:{renderTo:"chart",type:"bar"},title:{text:null},credits:{enabled:false},xAxis:{categories:["Physical Dmg","Magic Dmg","Fire Dmg","Lightning Dmg","Critical","Bonus Strengh","Bonus Dexterity","Bonus Intelligence","Bonus Faith","Req Strength","Req Dexterity","Req Intelligence","Req Faith","Bleed","Toxic","Occult","Divine","Weight"]},legend:{align:"center",verticalAlign:"top",layout:"vertical"},series:[{name:e.name,data:this.convertForChart(e)},{name:t.name,data:this.convertForChart(t)}]};console.log("opts",r);var i=new Highcharts.Chart(r)},renderDamageStats:function(e,t){var r="",i=e.stats,a=t.stats;r+=w.renderAttribute("physical_damage","Regular",i.physical_damage,a.physical_damage);r+=w.renderAttribute("magic_damage","Magic",i.magic_damage,a.magic_damage);r+=w.renderAttribute("fire_damage","Fire",i.fire_damage,a.fire_damage);r+=w.renderAttribute("lightning_damage","Lightning",i.lightning_damage,a.lightning_damage);r+=w.renderAttribute("critical","Critical",i.critical,a.critical);return this.statsBoxTemplate({title:"Damage",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderReductionStats:function(e,t){var r="",i=e.stats,a=t.stats;r+=w.renderAttribute("physical_reduction","Physical",i.physical_reduction,a.physical_reduction);r+=w.renderAttribute("magic_reduction","Magic",i.magic_reduction,a.magic_reduction);r+=w.renderAttribute("fire_reduction","Fire",i.fire_reduction,a.fire_reduction);r+=w.renderAttribute("lightning_reduction","Lightning",i.lightning_reduction,a.lightning_reduction);r+=w.renderAttribute("stability","Stability",i.stability,a.stability);return this.statsBoxTemplate({title:"Reduction",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderParamBonus:function(e,t){var r="",i=e.param_bonus,a=t.param_bonus;r+=w.renderAttribute("strength","Strength",i.strength,a.strength,{isNegative:true,isString:true,invertSymbols:true});r+=w.renderAttribute("dexterity","Dexterity",i.dexterity,a.dexterity,{isNegative:true,isString:true,invertSymbols:true});r+=w.renderAttribute("intelligence","Intelligence",i.intelligence,a.intelligence,{isNegative:true,isString:true,invertSymbols:true});r+=w.renderAttribute("faith","Faith",i.faith,a.faith,{isNegative:true,isString:true,invertSymbols:true});return this.statsBoxTemplate({title:"Param Bonus",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderReqParams:function(e,t){var r="",i=e.req_param,a=t.req_param;r+=w.renderAttribute("strength","Strength",i.strength,a.strength,{isNegative:true,isInteger:true});r+=w.renderAttribute("dexterity","Dexterity",i.dexterity,a.dexterity,{isNegative:true,isInteger:true});r+=w.renderAttribute("intelligence","Intelligence",i.intelligence,a.intelligence,{isNegative:true,isInteger:true});r+=w.renderAttribute("faith","Faith",i.faith,a.faith,{isNegative:true,isInteger:true});return this.statsBoxTemplate({title:"Req Params",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderAuxEffects:function(e,t){var r="",i=e.aux_effect,a=t.aux_effect;r+=w.renderAttribute("bleed","Bleed",i.bleed,a.bleed,{isInteger:true});r+=w.renderAttribute("toxic","Toxic",i.toxic,a.toxic,{isInteger:true});r+=w.renderAttribute("occult","Occult",i.occult,a.occult,{isInteger:true});r+=w.renderAttribute("divine","Divine",i.divine,a.divine,{isInteger:true});return this.statsBoxTemplate({title:"Aux Effects",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderResistances:function(e,t){var r="",i=e.resistances,a=t.resistances;r+=w.renderAttribute("bleed","Bleed",i.bleed,a.bleed,{isPercentage:true});r+=w.renderAttribute("poison","Poison",i.poison,a.poison,{isPercentage:true});r+=w.renderAttribute("toxic","Toxic",i.toxic,a.toxic,{isPercentage:true});r+=w.renderAttribute("curse","Curse",i.curse,a.curse,{isPercentage:true});return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},renderOthers:function(e,t){var r="";r+=w.renderAttribute("weight","Weight",e.weight,t.weight,{isNegative:true});r+=w.renderAttribute("durability","Durability",e.durability,t.durability,{isInteger:true});if(e.magic_adjust||t.magic_adjust){r+=w.renderAttribute("magic_adjust","Magic Adjust",e.magic_adjust,t.magic_adjust,{isInteger:true,notIcon:true})}return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},render:function(e,t,r){var i=w.renderImage(e,"attack_type","weapon_type");var a=w.renderImage(t,"attack_type","weapon_type");var s="";s+=this.renderDamageStats(e,t);s+=this.renderReductionStats(e,t);s+=this.renderParamBonus(e,t);s+=this.renderReqParams(e,t);if(r){s+=this.renderResistances(e,t)}else{s+=this.renderAuxEffects(e,t)}s+=this.renderOthers(e,t);content=this.contentTemplate({body:s,description1:i,description2:a});this.$el.html(content)}});var w=function(){var e=Handlebars.compile($("#attribute-template").html());var t=Handlebars.compile($("#image-template").html());var r=["-","–","S","A","B","C","D","E"];var i=function(e,t){if(e!==t){if(e==="S"){return 1}else if(t==="S"){return-1}else if(e==="-"||t==="-"){return 0}else{if(e>t)return 1;if(e<t)return-1}}else{return 0}};return{renderAttribute:function(t,a,s,n,l){l=l||{};var c=color2="",o="=";if(l.isNegative){goodColor="red";badColor="blue"}else{goodColor="blue";badColor="red"}if(l.invertSymbols){biggerThanSymbol="<";lesserThanSymbol=">"}else{biggerThanSymbol=">";lesserThanSymbol="<"}if(!l.isString){s=s==="–"||s==="-"?0:parseFloat(s);n=n==="–"||n==="-"?0:parseFloat(n)}if(i(s,n)>0){c=goodColor;color2=badColor;o=biggerThanSymbol}else if(i(s,n)<0){c=badColor;color2=goodColor;o=lesserThanSymbol}if(!l.isInteger&&!l.isPercentage){s=r.indexOf(s)>=0?s:s.toFixed(1);n=r.indexOf(n)>=0?n:n.toFixed(1)}if(l.isPercentage){s=s+"%";n=n+"%"}var u={key:a,icon:{icon:t,caption:a},color1:c,color2:color2,value1:s,value2:n,symbol:o};if(l.notIcon)delete u.icon;return e(u)},renderImage:function(e,r,i){var a=e[r];var s=e[i];return t({name:unescape(e.name),source:e.image,title1:r,title2:i,type1:a,type2:s})},unescape:function(e){e=unescape(e);return e}}}();