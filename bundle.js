var e=0;var t="";function a(e){return d(u(m(e)))}function s(e){return h(u(m(e)))}function r(e,t){return p(u(m(e)),t)}function i(e,t){return d(c(m(e),m(t)))}function n(e,t){return h(c(m(e),m(t)))}function l(e,t,a){return p(c(m(e),m(t)),a)}function o(){return a("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function u(e){return b(y(v(e),e.length*8))}function c(e,t){var a=v(e);if(a.length>16)a=y(a,e.length*8);var s=Array(16),r=Array(16);for(var i=0;i<16;i++){s[i]=a[i]^909522486;r[i]=a[i]^1549556828}var n=y(s.concat(v(t)),512+t.length*8);return b(y(r.concat(n),512+128))}function d(t){try{e}catch(a){e=0}var s=e?"0123456789ABCDEF":"0123456789abcdef";var r="";var i;for(var n=0;n<t.length;n++){i=t.charCodeAt(n);r+=s.charAt(i>>>4&15)+s.charAt(i&15)}return r}function h(e){try{t}catch(a){t=""}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var r="";var i=e.length;for(var n=0;n<i;n+=3){var l=e.charCodeAt(n)<<16|(n+1<i?e.charCodeAt(n+1)<<8:0)|(n+2<i?e.charCodeAt(n+2):0);for(var o=0;o<4;o++){if(n*8+o*6>e.length*8)r+=t;else r+=s.charAt(l>>>6*(3-o)&63)}}return r}function p(e,t){var a=t.length;var s,r,i,n,l;var o=Array(Math.ceil(e.length/2));for(s=0;s<o.length;s++){o[s]=e.charCodeAt(s*2)<<8|e.charCodeAt(s*2+1)}var u=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));var c=Array(u);for(r=0;r<u;r++){l=Array();n=0;for(s=0;s<o.length;s++){n=(n<<16)+o[s];i=Math.floor(n/a);n-=i*a;if(l.length>0||i>0)l[l.length]=i}c[r]=n;o=l}var d="";for(s=c.length-1;s>=0;s--)d+=t.charAt(c[s]);return d}function m(e){var t="";var a=-1;var s,r;while(++a<e.length){s=e.charCodeAt(a);r=a+1<e.length?e.charCodeAt(a+1):0;if(55296<=s&&s<=56319&&56320<=r&&r<=57343){s=65536+((s&1023)<<10)+(r&1023);a++}if(s<=127)t+=String.fromCharCode(s);else if(s<=2047)t+=String.fromCharCode(192|s>>>6&31,128|s&63);else if(s<=65535)t+=String.fromCharCode(224|s>>>12&15,128|s>>>6&63,128|s&63);else if(s<=2097151)t+=String.fromCharCode(240|s>>>18&7,128|s>>>12&63,128|s>>>6&63,128|s&63)}return t}function f(e){var t="";for(var a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)&255,e.charCodeAt(a)>>>8&255);return t}function g(e){var t="";for(var a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)>>>8&255,e.charCodeAt(a)&255);return t}function v(e){var t=Array(e.length>>2);for(var a=0;a<t.length;a++)t[a]=0;for(var a=0;a<e.length*8;a+=8)t[a>>5]|=(e.charCodeAt(a/8)&255)<<a%32;return t}function b(e){var t="";for(var a=0;a<e.length*32;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function y(e,t){e[t>>5]|=128<<t%32;e[(t+64>>>9<<4)+14]=t;var a=1732584193;var s=-271733879;var r=-1732584194;var i=271733878;for(var n=0;n<e.length;n+=16){var l=a;var o=s;var u=r;var c=i;a=A(a,s,r,i,e[n+0],7,-680876936);i=A(i,a,s,r,e[n+1],12,-389564586);r=A(r,i,a,s,e[n+2],17,606105819);s=A(s,r,i,a,e[n+3],22,-1044525330);a=A(a,s,r,i,e[n+4],7,-176418897);i=A(i,a,s,r,e[n+5],12,1200080426);r=A(r,i,a,s,e[n+6],17,-1473231341);s=A(s,r,i,a,e[n+7],22,-45705983);a=A(a,s,r,i,e[n+8],7,1770035416);i=A(i,a,s,r,e[n+9],12,-1958414417);r=A(r,i,a,s,e[n+10],17,-42063);s=A(s,r,i,a,e[n+11],22,-1990404162);a=A(a,s,r,i,e[n+12],7,1804603682);i=A(i,a,s,r,e[n+13],12,-40341101);r=A(r,i,a,s,e[n+14],17,-1502002290);s=A(s,r,i,a,e[n+15],22,1236535329);a=V(a,s,r,i,e[n+1],5,-165796510);i=V(i,a,s,r,e[n+6],9,-1069501632);r=V(r,i,a,s,e[n+11],14,643717713);s=V(s,r,i,a,e[n+0],20,-373897302);a=V(a,s,r,i,e[n+5],5,-701558691);i=V(i,a,s,r,e[n+10],9,38016083);r=V(r,i,a,s,e[n+15],14,-660478335);s=V(s,r,i,a,e[n+4],20,-405537848);a=V(a,s,r,i,e[n+9],5,568446438);i=V(i,a,s,r,e[n+14],9,-1019803690);r=V(r,i,a,s,e[n+3],14,-187363961);s=V(s,r,i,a,e[n+8],20,1163531501);a=V(a,s,r,i,e[n+13],5,-1444681467);i=V(i,a,s,r,e[n+2],9,-51403784);r=V(r,i,a,s,e[n+7],14,1735328473);s=V(s,r,i,a,e[n+12],20,-1926607734);a=w(a,s,r,i,e[n+5],4,-378558);i=w(i,a,s,r,e[n+8],11,-2022574463);r=w(r,i,a,s,e[n+11],16,1839030562);s=w(s,r,i,a,e[n+14],23,-35309556);a=w(a,s,r,i,e[n+1],4,-1530992060);i=w(i,a,s,r,e[n+4],11,1272893353);r=w(r,i,a,s,e[n+7],16,-155497632);s=w(s,r,i,a,e[n+10],23,-1094730640);a=w(a,s,r,i,e[n+13],4,681279174);i=w(i,a,s,r,e[n+0],11,-358537222);r=w(r,i,a,s,e[n+3],16,-722521979);s=w(s,r,i,a,e[n+6],23,76029189);a=w(a,s,r,i,e[n+9],4,-640364487);i=w(i,a,s,r,e[n+12],11,-421815835);r=w(r,i,a,s,e[n+15],16,530742520);s=w(s,r,i,a,e[n+2],23,-995338651);a=x(a,s,r,i,e[n+0],6,-198630844);i=x(i,a,s,r,e[n+7],10,1126891415);r=x(r,i,a,s,e[n+14],15,-1416354905);s=x(s,r,i,a,e[n+5],21,-57434055);a=x(a,s,r,i,e[n+12],6,1700485571);i=x(i,a,s,r,e[n+3],10,-1894986606);r=x(r,i,a,s,e[n+10],15,-1051523);s=x(s,r,i,a,e[n+1],21,-2054922799);a=x(a,s,r,i,e[n+8],6,1873313359);i=x(i,a,s,r,e[n+15],10,-30611744);r=x(r,i,a,s,e[n+6],15,-1560198380);s=x(s,r,i,a,e[n+13],21,1309151649);a=x(a,s,r,i,e[n+4],6,-145523070);i=x(i,a,s,r,e[n+11],10,-1120210379);r=x(r,i,a,s,e[n+2],15,718787259);s=x(s,r,i,a,e[n+9],21,-343485551);a=S(a,l);s=S(s,o);r=S(r,u);i=S(i,c)}return Array(a,s,r,i)}function k(e,t,a,s,r,i){return S(C(S(S(t,e),S(s,i)),r),a)}function A(e,t,a,s,r,i,n){return k(t&a|~t&s,e,t,r,i,n)}function V(e,t,a,s,r,i,n){return k(t&s|a&~s,e,t,r,i,n)}function w(e,t,a,s,r,i,n){return k(t^a^s,e,t,r,i,n)}function x(e,t,a,s,r,i,n){return k(a^(t|~s),e,t,r,i,n)}function S(e,t){var a=(e&65535)+(t&65535);var s=(e>>16)+(t>>16)+(a>>16);return s<<16|a&65535}function C(e,t){return e<<t|e>>>32-t}var R={get:function(e){var t=document.cookie.match(new RegExp(e+"=[a-zA-Z0-9.()=|%/_]+($|;)","g"));if(!t||!t[0])return null;else return unescape(t[0].substring(e.length+1,t[0].length).replace(";",""))||null},set:function(e,t,a,s){var r=[e+"="+escape(t),"path="+(!a||a==""?"/":a),"domain="+(!s||s==""?window.location.host:s)];return document.cookie=r.join("; ")}};var P={parse:function(e){e=e.replace("?","");var t={};e.split("&").forEach(function(e){var a=e.split("=")[0];var s=e.split("=")[1];t[a]=s});return t}};var D={DkS1:"darksouls1",DkS2:"darksouls2"};var B=300;var E=["head","chest","hands","legs"];var F="0000000";var T=["weapons","armors","shields"];var W="This website uses cookies to collect statistical information in anonymous form on "+"usage of the website. We also use cookies to save your preferences and provide a better experience. "+"However, we do not register any information that can identify you personally.<br/><br/>A cookie is "+"a small text file saved to your computer and allows our website to follow your visit and to recognize "+"your computer when you visit our website again. A cookie is not a program and does not contain virus, "+"nor spreads malicious software.";String.prototype.capitalize=function(){return this,this.charAt(0).toUpperCase()+this.slice(1)};var I=new Firebase("https://darksoulscomparator.firebaseIO.com");var N={armors:[],shields:[],weapons:[],pieces:{head:[],chest:[],hands:[],legs:[]}};var O=null;var j={1:null,2:null};var H=R.get("game")||D.DkS1;var q=null;var L=null;var M=null;var z=Handlebars.compile($("#social-template").html());U();function U(){Ae("Loading...",null,true);I.child(H+"/indexes").on("value",function(e){data=e.val();N.weapons=data.weapons[fe(data.weapons)];N.armors=data.armors[fe(data.armors)];N.shields=data.shields[fe(data.shields)];N.pieces=data.pieces[fe(data.pieces)];Q();$("#type").removeAttr("disabled");$("#type").selectpicker("refresh");$("select.basic-comparator").on("change",function(e){var t=unescape($(this).val());var a=$(this).attr("data-item");var s=$("#type").val();var r=N[s].filter(function(e){return fe(e)===t})[0][t];X(a,r)});$("select.detailed-comparator").on("change",function(e){var t=unescape($(this).val());var a=$(this).attr("data-item");var s=$(this).attr("data-piece");var r=0;if(t!=="naked"&&t){r=N.pieces[s].filter(function(e){return fe(e)===t})[0][t]}Y(a,s,r)});Ve()})}function Z(){$("#comparison").html("");$("#by-widgets").hide();$("#by").selectpicker("val",null);$("#detailed-widgets").hide();$("#basic-widgets").hide();$(".basic-level").selectpicker("val",null);pe();me()}var G=Backbone.Router.extend({});$(document).ready(function(){Backbone.history.start({pushState:true});M=new G;pe();$("#game").val(H);$("#game").on("change",function(e){H=$(this).val();Z();$("#type").attr("disabled","");$("#type").selectpicker("val",null);R.set("game",H);U()});$("#type").on("change",function(e){O=$(this).val();Z();if(O==="armors"){K()}else{J()}});$(".set-comparator").on("change",function(e){var t=$(this).val();var a=$(this).attr("data-item");if(t==="custom"){he(a)}else{t=unescape(t);var s=N.armors.filter(function(e){return fe(e)===t})[0][t];pe(a);ee(a,s)}var r=unescape($('.set-comparator[data-item="1"]').selectpicker("val"));var i=unescape($('.set-comparator[data-item="2"]').selectpicker("val"));if(r==="custom"||i==="custom"){$("#detailed-widgets").show()}else{$("#detailed-widgets").hide()}});$("button#compare").on("click",function(e){de();var t=unescape($(this).val());if(O==="armors"){var a=se().then(function(e){if(H===D.DkS1){q=new $e({el:"#comparison"})}else if(H===D.DkS2){q=new Re({el:"#comparison"})}ue(e[0],e[1],O).then(function(e){q.renderSetsEvolution(e[0],e[1])});q.render(e[0],e[1]);ye(H,O,e[0],e[1]);ce()}).catch(function(e){we(e);ce()})}else{var s=O==="shields";var a=te().then(function(e){if(H===D.DkS1){q=new Ce({el:"#comparison"})}else if(H===D.DkS2){q=new Pe({el:"#comparison"})}oe(e[0].name,e[1].name,O).then(function(t){if(O==="weapons"){q.renderWeaponsEvolution(t[0],t[1])}else{q.renderShieldsEvolution(t[0],t[1]);q.renderReductionsChart(e[0],e[1])}});q.render(e[0],e[1],s);ye(H,O,e[0],e[1]);ce()}).catch(function(e){we(e);ce()})}});$("#cookies-policy").on("click",function(e){e.preventDefault();Ae("Cookies Policy",W,null,true);return false});ve()});Handlebars.registerHelper("toTitleCase",function(e){return e.split("_").map(function(e){return e[0].toUpperCase()+e.slice(1,e.length)}).join(" ")});function J(){var e="";N[O].map(function(e){return fe(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});$("select.basic-comparator").html(e);$("select.basic-comparator").selectpicker("refresh");$("#basic-widgets").show()}function K(){var e='<option value="custom">Custom</option>';e+='<optgroup label="Sets">';N[O].map(function(e){return fe(e)}).sort().forEach(function(t){e+='<option value="'+escape(t)+'">'+t+"</option>"});e+="</optgroup>";$("select.set-comparator").html(e);$("select.set-comparator").selectpicker("refresh");$("#by-widgets").show()}function Q(){Object.keys(N.pieces).forEach(function(e){var t='<option value="naked">Naked</option>';t+='<option data-divider="true"></option>';var a=N.pieces[e].map(function(e){return fe(e)}).sort();a.forEach(function(e){t+='<option value="'+escape(e)+'">'+e+"</option>"});var s=$('select.detailed-comparator[data-piece="'+e+'"]');s.html(t);s.selectpicker("refresh")})}function X(e,t){var a='<option value="0" selected>0</option>';for(var s=1;s<=t;s++){a+='<option value="'+s+'">+'+s+"</option>"}var r=$('select.basic-level[data-level="'+e+'"]');r.html(a);r.selectpicker("refresh")}function Y(e,t,a){var s='<option value="0" selected>0</option>';for(var r=1;r<=a;r++){s+='<option value="'+r+'">+'+r+"</option>"}var i=$('select.detailed-level[data-level="'+e+'"][data-piece="'+t+'"]');i.html(s);i.selectpicker("refresh")}function ee(e,t){var a='<option value="0" selected>0</option>';for(var s=1;s<=t;s++){a+='<option value="'+s+'">+'+s+"</option>"}var r=$('select.set-level[data-level="'+e+'"]');r.html(a);r.selectpicker("refresh")}function te(){var e=unescape($('.basic-comparator[data-item="1"]').selectpicker("val"));var t=unescape($('.basic-comparator[data-item="2"]').selectpicker("val"));var a=unescape($('.basic-level[data-level="1"]').selectpicker("val"));var s=unescape($('.basic-level[data-level="2"]').selectpicker("val"));return new Promise(function(r,i){var n,l;var o=a!=="0"?e+" +"+a:e;var u=s!=="0"?t+" +"+s:t;I.child(H+"/"+O).orderByChild("name").equalTo(o).once("value",function(e){var t=e.val();if(!t)i();n=t[Object.keys(t)[0]];if(n&&l)r([n,l])});I.child(H+"/"+O).orderByChild("name").equalTo(u).once("value",function(e){var t=e.val();if(!t)i();l=t[Object.keys(t)[0]];if(n&&l)r([n,l])})})}function ae(e,t,a){return new Promise(function(s,r){var i,n;I.child(H+"/"+e).orderByChild("sha").equalTo(t).once("value",function(e){var t=e.val();if(!t)r();i=t[Object.keys(t)[0]];if(i&&n)s([i,n])});I.child(H+"/"+e).orderByChild("sha").equalTo(a).once("value",function(e){var t=e.val();if(!t)r();n=t[Object.keys(t)[0]];if(i&&n)s([i,n])})})}function se(e,t,a,s){var e=e||unescape($('.set-comparator[data-item="1"]').selectpicker("val"));var t=e||unescape($('.set-comparator[data-item="2"]').selectpicker("val"));return new Promise(function(r,i){var n,l,o,u;if(e==="sha"){o=ne(a)}else if(e==="custom"){o=ie(le(1))}else{var c=$('select.set-level[data-level="1"]').selectpicker("val");a=c!=="0"?e+" +"+c:e;o=re(a)}o.then(function(e){n=e;if(n&&l)r([n,l])});if(t==="sha"){u=ne(s)}else if(t==="custom"){u=ie(le(2))}else{var c=$('select.set-level[data-level="2"]').selectpicker("val");s=c!=="0"?t+" +"+c:t;u=re(s)}u.then(function(e){l=e;if(n&&l)r([n,l])})})}function re(e){return new Promise(function(t,a){I.child(H+"/armors").orderByChild("set").equalTo(e).once("value",function(e){var s=e.val();if(!s)a();var r={pieces:[]};Object.keys(s).forEach(function(e){r.pieces.push(s[e])});t(r)})})}function ie(e){return new Promise(function(t,a){var s={pieces:[]};Object.keys(N.pieces).forEach(function(a){if(e[a]){var r=unescape(e[a]);var i=new Promise(function(e,t){if(r!=="naked"){I.child(H+"/armors").orderByChild("name").equalTo(r).once("value",function(t){var s=t.val();var r=null;if(s===null){r=new xe("Error fetching "+a.capitalize(),a)}else{r=s[Object.keys(s)[0]]}e(r)})}else{var s=new xe("Naked "+a.capitalize(),a);e(s)}});i.then(function(a){s.pieces.push(a);if(s.pieces.length===Object.keys(e).length){t(s)}})}})})}function ne(e){return new Promise(function(t,a){var s={pieces:[]};Object.keys(N.pieces).forEach(function(a){if(e[a]){var r=unescape(e[a]);var i=new Promise(function(e,t){if(r!=="naked"){I.child(H+"/armors").orderByChild("sha").equalTo(r).once("value",function(t){var s=t.val();var r=null;if(s===null){r=new xe("Error fetching "+a.capitalize(),a)}else{r=s[Object.keys(s)[0]]}e(r)})}else{var s=new xe("Naked "+a.capitalize(),a);e(s)}});i.then(function(a){s.pieces.push(a);if(s.pieces.length===Object.keys(e).length){t(s)}})}})})}function le(e){var t={};Object.keys(N.pieces).forEach(function(a){var s=$('select.detailed-comparator[data-item="'+e+'"][data-piece="'+a+'"]').selectpicker("val");var r=$('select.detailed-level[data-level="'+e+'"][data-piece="'+a+'"]').selectpicker("val");t[a]=r!=="0"?s+" +"+r:s});return t}function oe(e,t,a){var s=e.split("+")[0].trim();var r=t.split("+")[0].trim();return new Promise(function(e,t){var i,n;I.child(H+"/"+a).orderByChild("name").startAt(s).endAt(s+" +999").once("value",function(a){var r=a.val();if(!r)t();i={name:s,data:Object.keys(r).map(function(e){return r[e]})};if(i&&n)e([i,n])});I.child(H+"/"+a).orderByChild("name").startAt(r).endAt(r+" +999").once("value",function(a){var s=a.val();if(!s)t();n={name:r,data:Object.keys(s).map(function(e){return s[e]})};if(i&&n)e([i,n])})})}function ue(e,t){var a,s;return new Promise(function(r,i){var n=new Promise(function(t,a){var s=[];var r=e.pieces.filter(function(e){return e.name!=="Naked Head"&&e.name!=="Naked Chest"&&e.name!=="Naked Hands"&&e.name!=="Naked Legs"});r.forEach(function(e){var i=e.name.split("+")[0].trim();I.child(H+"/armors").orderByChild("name").startAt(i).endAt(i+" +999").once("value",function(e){var n=e.val();if(!n)a();s.push({name:i,data:Object.keys(n).map(function(e){return n[e]})});if(s.length===r.length)t(s)})})});var l=new Promise(function(e,a){var s=[];var r=t.pieces.filter(function(e){return e.name!=="Naked Head"&&e.name!=="Naked Chest"&&e.name!=="Naked Hands"&&e.name!=="Naked Legs"});r.forEach(function(t){var i=t.name.split("+")[0].trim();I.child(H+"/armors").orderByChild("name").startAt(i).endAt(i+" +999").once("value",function(t){var n=t.val();if(!n)a();s.push({name:i,data:Object.keys(n).map(function(e){return n[e]})});if(s.length===r.length)e(s)})})});n.then(function(e){a=e;if(a&&s)r([a,s])});l.then(function(e){s=e;if(a&&s)r([a,s])})})}function ce(){$("button#compare").removeAttr("disabled")}function de(e){$("button#compare").attr("disabled","")}function he(e){var t=e?'[data-item="'+e+'"]':"";var a=$("select.detailed-comparator"+t);a.removeAttr("disabled");a.selectpicker("refresh");var s=e?'[data-level="'+e+'"]':"";a=$("select.detailed-level"+s);a.removeAttr("disabled");a.selectpicker("refresh");var r=$("select.set-level"+s);r.attr("disabled","");r.selectpicker("refresh")}function pe(e){var t=e?'[data-item="'+e+'"]':"";var a=$("select.detailed-comparator"+t);a.attr("disabled","");a.selectpicker("refresh");var s=e?'[data-level="'+e+'"]':"";a=$("select.detailed-level"+s);a.attr("disabled","");a.selectpicker("refresh");var r=$("select.set-level"+s);r.removeAttr("disabled");r.selectpicker("refresh")}function me(){$("select.detailed-comparator").selectpicker("deselectAll");$("select.detailed-level").selectpicker("deselectAll")}function fe(e){return Object.keys(e)[0]}function ge(e){if(e&&e!==""&&e.length===60){if(parseInt(e[0])>Object.keys(D).length-1)return false;if(parseInt(e[1])>T.length-1)return false}else{return false}return true}function ve(){if(window.location.search==="")return;var e=P.parse(window.location.search).token;if(ge(e)){L=e;var t=parseInt(e[0])+1;var a=parseInt(e[1]);$("#game :nth-child("+t+")").prop("selected",true);H=$("#game").val();var s=T[a];if(a===1){var r=e.substr(2,29);var i={head:r.substr(1,7),chest:r.substr(8,7),hands:r.substr(15,7),legs:r.substr(23,7)};r=e.substr(31,29);var n={head:r.substr(1,7),chest:r.substr(8,7),hands:r.substr(15,7),legs:r.substr(23,7)};var l=se("sha","sha",i,n).then(function(e){if(H===D.DkS1){q=new $e({el:"#comparison"})}else if(H===D.DkS2){q=new Re({el:"#comparison"})}ue(e[0],e[1],s).then(function(e){q.renderSetsEvolution(e[0],e[1])});q.render(e[0],e[1]);ye(H,s,e[0],e[1]);ce()}).catch(function(e){we(e);M.navigate("/")})}else{var o=e.substr(2,29).substr(1,7);var u=e.substr(31,29).substr(1,7);var c=s==="shields";var l=ae(s,o,u).then(function(e){if(H===D.DkS1){q=new Ce({el:"#comparison"})}else if(H===D.DkS2){q=new Pe({el:"#comparison"})}oe(e[0].name,e[1].name,s).then(function(t){if(s==="weapons"){q.renderWeaponsEvolution(t[0],t[1])}else{q.renderShieldsEvolution(t[0],t[1]);q.renderReductionsChart(e[0],e[1])}});q.render(e[0],e[1],c);ye(H,s,e[0],e[1]);ce()}).catch(function(e){we(e);M.navigate("/")})}}else{alert("Invalid token");M.navigate("/")}}function _e(e){return["B",e.sha,F,F,F].join("")}function be(e){return["F",e.pieces.filter(function(e){return e.piece==="Head"})[0].sha,e.pieces.filter(function(e){return e.piece==="Chest"})[0].sha,e.pieces.filter(function(e){return e.piece==="Hands"})[0].sha,e.pieces.filter(function(e){return e.piece==="Legs"})[0].sha].join("")}function ye(e,t,a,s){var r,i;if(L){r=window.location.toString();i=window.location.pathname+window.location.search}else{var n=ke(e,t,a,s);i=window.location.pathname+"/?token="+n;r=window.location.origin+i}var l=z({url:r});$(".social-buttons").html(l);$('input[name="share-link"]').val(r);$('input[name="share-link"]').focus(function(){$(this).select()});loadSocial();$(".social-buttons").show();M.navigate(i)}function ke(e,t,a,s){var r=[],i,n,l;l=e===D.DkS1?"0":"1";tid=t==="weapons"?"0":t==="armors"?"1":"2";if(t==="armors"){i=be(a);n=be(s)}else{i=_e(a);n=_e(s)}r.push(l);r.push(tid);r.push(i);r.push(n);var o=r.join("");return o}function Ae(e,t,a,s){$(".modal-title").text(e);if(t){$(".modal-body").html(t)}if(a){$(".modal-close").hide();$(".modal-body").html('<div><img src="http://i.imgur.com/unIj1Le.gif" /></div>'+'<p class="waiting">Please wait...</p>'+'<span class="credits">Image by <a href="http://zedotagger.deviantart.com/" target="_blank">Zedotagger</a></span>')}else{$(".modal-close").show()}if(s){$(".modal-footer").show()}else{$(".modal-footer").hide()}$("#modal-dialog").modal("show")}function Ve(){$("#modal-dialog").modal("hide")}function we(e){alert("There was an error fetching the information for the requested element.\n\nERR: "+e)}var xe=function(e,t){this.elemental_defense={fire:0,lightning:0,magic:0};this.physical_defense={regular:0,strike:0,slash:0,thrust:0};this.resistances={bleed:0,poison:0,curse:0};this.stats={fire_defense:0,lightning_defense:0,magic_defense:0,dark_defense:0,physical_defense:0,strike_defense:0,slash_defense:0,thrust_defense:0,bleed_resist:0,poison_resist:0,curse_resist:0,petrify_resist:0,weight:0,poise:0,durability:0};this.req_param={strength:0,dexterity:0,intelligence:0,faith:0};this.weight=0;this.poise=0;this.durability=0;this.physical_defense_bonus="-";this.name=e?e:t?"Naked "+t:"";this.type="N/A";if(t){this.piece=t.capitalize()}};xe.constructor.prototype=xe;var Se=function(){var e=Handlebars.compile($("#attribute-template").html());var t=Handlebars.compile($("#image-template").html());var a=Handlebars.compile($("#chart-box-template").html());var s=["-","–","S","A","B","C","D","E"];var r=function(e,t){if(e!==t){if(e==="S"){return-1}else if(t==="S"){return 1}else if(e==="-"&&t!=="-"){return 1}else if(e!=="-"&&t==="-"){return-1}else{if(e>t)return 1;if(e<t)return-1}}else{return 0}};return{renderAttribute:function(t,a,i,n,l){l=l||{};var o=color2="",u="=";if(l.isNegative){goodColor="red";badColor="blue"}else{goodColor="blue";badColor="red"}if(l.invertSymbols){biggerThanSymbol="<";lesserThanSymbol=">"}else{biggerThanSymbol=">";lesserThanSymbol="<"}if(!l.isString){i=i==="–"||i==="-"||i===""?0:parseFloat(i);n=n==="–"||n==="-"||n===""?0:parseFloat(n)}if(r(i,n)>0){o=goodColor;color2=badColor;u=biggerThanSymbol}else if(r(i,n)<0){o=badColor;color2=goodColor;u=lesserThanSymbol}if(!l.isInteger&&!l.isPercentage){i=s.indexOf(i)>=0?i:i.toFixed(1);n=s.indexOf(n)>=0?n:n.toFixed(1)}if(l.isPercentage){i=i+"%";n=n+"%"}tooltip=l.tooltip||a;var c={key:a,icon:{icon:t,caption:a},tooltip:tooltip,color1:o,color2:color2,value1:i,value2:n,symbol:u};if(l.notIcon)delete c.icon;return e(c)},renderImage:function(e,a,s){var r=e[a];var i=e[s];return t({name:unescape(e.name),source:e.wiki_image,title1:a,title2:s,type1:r,type2:i})},renderChartBox:function(e,t){return a({id:e,layout:t})},drawWeaponEvolution:function(e,t,a,s){var r=[];for(var i=0;i<Math.max(t.length,s.length);i++){r.push("+"+i)}$("#weapons-evolution").highcharts({chart:{height:B},title:{text:"Weapons damage evolution"},credits:{enabled:false},yAxis:{title:{text:"Total Damage"}},xAxis:{categories:r},series:[{data:t,name:e},{data:s,name:a}]})},drawShieldEvolution:function(e,t,a,s){var r=[];for(var i=0;i<Math.max(t.length,s.length);i++){r.push("+"+i)}$("#shields-evolution").highcharts({chart:{height:B},title:{text:"Shields stability evolution"},credits:{enabled:false},yAxis:{title:{text:"Stability"}},xAxis:{categories:r},series:[{data:t,name:e},{data:s,name:a}]})},drawShieldsReductions:function(e,t,a,s,r){$("#shields-reduction").highcharts({chart:{polar:true,type:"line",height:B},title:{text:"Shields Reduction"},credits:{enabled:false},xAxis:{categories:e,lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},legend:{align:"center",verticalAlign:"bottom",layout:"vertical"},series:[{name:t,data:a,pointPlacement:"on"},{name:s,data:r,pointPlacement:"on"}]})},drawArmorEvolutions:function(e){var t=[];for(var a=0;a<Math.max(e[0].resistances.length,e[1].resistances.length);a++){t.push("+"+a)}$("#sets-defense-evolution").highcharts({chart:{height:B},title:{text:"Defense evolution by set"},credits:{enabled:false},yAxis:{title:{text:"Total defense (physical + elemental)"}},xAxis:{categories:t},series:[{data:e[0].defenses,name:e[0].name},{data:e[1].defenses,name:e[1].name}]});$("#sets-resistance-evolution").highcharts({chart:{height:B},title:{text:"Resistance evolution by set"},credits:{enabled:false},yAxis:{title:{text:"Total resistance (all resistances)"}},xAxis:{categories:t},series:[{data:e[0].resistances,name:e[0].name},{data:e[1].resistances,name:e[1].name}]})},drawArmorDefenses:function(e,t,a,s,r){$("#sets-defense").highcharts({chart:{polar:true,type:"line",height:B},credits:{enabled:false},title:{text:"Defenses by set"},xAxis:{categories:e,lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},legend:{align:"center",verticalAlign:"bottom",layout:"vertical"},series:[{name:t,data:a,pointPlacement:"on"},{name:s,data:r,pointPlacement:"on"}]})},unescape:function(e){e=unescape(e);return e},parseValue:function(e){var t=parseFloat(e);return isNaN(t)?0:t}}}();var $e=Backbone.View.extend({initialize:function(){this.isArmor=true;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html());this.chartBoxTemplate=Handlebars.compile($("#chart-box-template").html())},calculateSetStats:function(e){var t=new xe;for(var a=0;a<e.pieces.length;a++){var s=e.pieces[a];t.elemental_defense.fire+=parseFloat(s.elemental_defense.fire);t.elemental_defense.lightning+=parseFloat(s.elemental_defense.lightning);t.elemental_defense.magic+=parseFloat(s.elemental_defense.magic);t.physical_defense.regular+=parseFloat(s.physical_defense.regular);t.physical_defense.strike+=parseFloat(s.physical_defense.strike);t.physical_defense.slash+=parseFloat(s.physical_defense.slash);t.physical_defense.thrust+=parseFloat(s.physical_defense.thrust);t.resistances.bleed+=parseFloat(s.resistances.bleed);t.resistances.poison+=parseFloat(s.resistances.poison);t.resistances.curse+=parseFloat(s.resistances.curse);t.weight+=parseFloat(s.weight);t.poise+=parseFloat(s.poise);t.durability+=parseInt(s.durability);if(t.name===""){t.name=s.set}else if(s.set!==t.name){t.name="Custom Set"}t.type=s.type}return t},calculatePhysicalWeightRatio:function(e){if(_.isEmpty(e)||e.weight===0)return 0;var t;t=Se.parseValue(e.physical_defense.regular);t+=Se.parseValue(e.physical_defense.strike);t+=Se.parseValue(e.physical_defense.slash);t+=Se.parseValue(e.physical_defense.thrust);return t/4/Se.parseValue(e.weight)},calculateElementalWeightRatio:function(e){if(_.isEmpty(e)||e.weight===0)return 0;var t;t=Se.parseValue(e.elemental_defense.fire);t+=Se.parseValue(e.elemental_defense.magic);t+=Se.parseValue(e.elemental_defense.lightning);return t/3/Se.parseValue(e.weight)},calculatePoiseWeightRatio:function(e){if(e.weight===0)return 0;return Se.parseValue(e.poise)/Se.parseValue(e.weight)},renderSets:function(e,t){var a=Se.renderImage(e,"type");var s=Se.renderImage(t,"type");var r="";r+=this.renderPhysicalDefense(e,t);r+=this.renderElementalDefense(e,t);r+=this.renderResistances(e,t);r+=this.renderOthers(e,t);return this.contentTemplate({body:r,description1:a,description2:s})},renderPiece:function(e){var t="";var a=_.find(this.armor1.pieces,{piece:e})||{};var s=_.find(this.armor2.pieces,{piece:e})||{};var r=Se.renderImage(a,"type");var i=Se.renderImage(s,"type");var t="";t+=this.renderPhysicalDefense(a,s);t+=this.renderElementalDefense(a,s);t+=this.renderResistances(a,s);t+=this.renderOthers(a,s);return this.contentTemplate({body:t,description1:r,description2:i})},renderPhysicalDefense:function(e,t){var a="",s=e.physical_defense||{},r=t.physical_defense||{},i=this.calculatePhysicalWeightRatio(e),n=this.calculatePhysicalWeightRatio(t);a+=Se.renderAttribute("darksouls1/icon_regular_defense","Regular",s.regular,r.regular);a+=Se.renderAttribute("darksouls1/icon_strike_defense","Strike",s.strike,r.strike);a+=Se.renderAttribute("darksouls1/icon_slash_defense","Slash",s.slash,r.slash);a+=Se.renderAttribute("darksouls1/icon_thrust_defense","Thrust",s.thrust,r.thrust);a+=Se.renderAttribute("darksouls1/icon_regular_defense","Def/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Physical Defense/Weight"});return this.statsBoxTemplate({title:"Physical Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderElementalDefense:function(e,t){var a="",s=e.elemental_defense||{},r=t.elemental_defense||{},i=this.calculateElementalWeightRatio(e),n=this.calculateElementalWeightRatio(t);a+=Se.renderAttribute("darksouls1/icon_fire_defense","Fire",s.fire,r.fire);a+=Se.renderAttribute("darksouls1/icon_magic_defense","Magic",s.magic,r.magic);a+=Se.renderAttribute("darksouls1/icon_lightning_defense","Lightning",s.lightning,r.lightning);a+=Se.renderAttribute("darksouls1/icon_fire_defense","Ele/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Elemental Defense/Weight"});return this.statsBoxTemplate({title:"Elemental Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",s=e.resistances||{},r=t.resistances||{};a+=Se.renderAttribute("darksouls1/icon_bleed","Bleed",s.bleed,r.bleed);a+=Se.renderAttribute("darksouls1/icon_poison","Poison",s.poison,r.poison);a+=Se.renderAttribute("darksouls1/icon_curse","Curse",s.curse,r.curse);return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t){var a=this.calculatePoiseWeightRatio(e),s=this.calculatePoiseWeightRatio(t),r="";r+=Se.renderAttribute("darksouls1/icon_poise","Poise",e.poise,t.poise);r+=Se.renderAttribute("darksouls1/icon_weight","Weight",e.weight,t.weight,{isNegative:true});r+=Se.renderAttribute("darksouls1/icon_durability","Durability",e.durability,t.durability,{isInteger:true});r+=Se.renderAttribute("darksouls1/icon_poise","Poi/Wei",a.toFixed(2),s.toFixed(2),{tooltip:"Poise/Weight"});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:r,isArmor:this.isArmor})},render:function(e,t){this.armor1=e;this.armor2=t;this.set1=this.calculateSetStats(this.armor1);this.set2=this.calculateSetStats(this.armor2);var a=this.renderSets(this.set1,this.set2);a+=Se.renderChartBox("sets-defense-evolution","col-sm-12 col-md-6 col-lg-4");a+=Se.renderChartBox("sets-resistance-evolution","col-sm-12 col-md-6 col-lg-4");a+=Se.renderChartBox("sets-defense","col-sm-12 col-md-6 col-lg-4");a+=this.renderPiece("Head");a+=this.renderPiece("Chest");a+=this.renderPiece("Hands");a+=this.renderPiece("Legs");this.$el.html(a);this.renderDefensesChart(this.set1,this.set2)}});$e.prototype.renderSetsEvolution=function(e,t){var a=[{name:null,defenses:new Array(e[0].data.length),resistances:new Array(e[0].data.length)},{name:null,defenses:new Array(t[0].data.length),resistances:new Array(t[0].data.length)}];e.forEach(function(e){e.data.forEach(function(e){var t=0,s=0;var r=e.set.split("+")[0].trim();if(a[0].name&&a[0].name!==r&&a[0].name!=="Custom Set"){a[0].name="Custom Set"}else if(!a[0].name){a[0].name=r}t+=Se.parseValue(e.physical_defense.regular);t+=Se.parseValue(e.physical_defense.slash);t+=Se.parseValue(e.physical_defense.strike);t+=Se.parseValue(e.physical_defense.thrust);t+=Se.parseValue(e.elemental_defense.fire);t+=Se.parseValue(e.elemental_defense.magic);t+=Se.parseValue(e.elemental_defense.lightning);s+=Se.parseValue(e.resistances.bleed);s+=Se.parseValue(e.resistances.curse);s+=Se.parseValue(e.resistances.poison);if(!a[0].defenses[e.level])a[0].defenses[e.level]=0;if(!a[0].resistances[e.level])a[0].resistances[e.level]=0;a[0].defenses[e.level]+=t;a[0].resistances[e.level]+=s})});t.forEach(function(e){e.data.forEach(function(e){var t=0,s=0;var r=e.set.split("+")[0].trim();if(a[1].name&&a[1].name!==r&&a[1].name!=="Custom Set"){a[1].name="Custom Set"}else if(!a[1].name){a[1].name=r}t+=Se.parseValue(e.physical_defense.regular);t+=Se.parseValue(e.physical_defense.slash);t+=Se.parseValue(e.physical_defense.strike);t+=Se.parseValue(e.physical_defense.thrust);t+=Se.parseValue(e.elemental_defense.fire);t+=Se.parseValue(e.elemental_defense.magic);t+=Se.parseValue(e.elemental_defense.lightning);s+=Se.parseValue(e.resistances.bleed);s+=Se.parseValue(e.resistances.curse);s+=Se.parseValue(e.resistances.poison);if(!a[1].defenses[e.level])a[1].defenses[e.level]=0;if(!a[1].resistances[e.level])a[1].resistances[e.level]=0;a[1].defenses[e.level]+=t;a[1].resistances[e.level]+=s})});Se.drawArmorEvolutions(a)};$e.prototype.renderDefensesChart=function(e,t){var a=["Regular Def","Slash Def","Strike Def","Thrust Def","Fire Def","Magic Red","Lightning Red","Bleed Res","Poison Res","Curse Res","Poise","Weight"];

var s=[Se.parseValue(e.physical_defense.regular),Se.parseValue(e.physical_defense.slash),Se.parseValue(e.physical_defense.strike),Se.parseValue(e.physical_defense.thrust),Se.parseValue(e.elemental_defense.fire),Se.parseValue(e.elemental_defense.magic),Se.parseValue(e.elemental_defense.lightning),Se.parseValue(e.resistances.bleed),Se.parseValue(e.resistances.poison),Se.parseValue(e.resistances.curse),Se.parseValue(e.poise),Se.parseValue(e.weight)];var r=[Se.parseValue(t.physical_defense.regular),Se.parseValue(t.physical_defense.slash),Se.parseValue(t.physical_defense.strike),Se.parseValue(t.physical_defense.thrust),Se.parseValue(t.elemental_defense.fire),Se.parseValue(t.elemental_defense.magic),Se.parseValue(t.elemental_defense.lightning),Se.parseValue(t.resistances.bleed),Se.parseValue(t.resistances.poison),Se.parseValue(t.resistances.curse),Se.parseValue(t.poise),Se.parseValue(t.weight)];Se.drawArmorDefenses(a,e.name,s,t.name,r)};var Ce=Backbone.View.extend({initialize:function(){this.isArmor=false;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateDamageWeightRatio:function(e){var t;t=Se.parseValue(e.stats.physical_damage);t+=Se.parseValue(e.stats.fire_damage);t+=Se.parseValue(e.stats.magic_damage);t+=Se.parseValue(e.stats.lightning_damage);return t/4/Se.parseValue(e.weight)},calculateStabilityWeightRation:function(e){return Se.parseValue(e.stats.stability)/Se.parseValue(e.weight)},renderDamageStats:function(e,t){var a="",s=e.stats,r=t.stats;a+=Se.renderAttribute("darksouls1/icon_physical_damage","Regular",s.physical_damage,r.physical_damage);a+=Se.renderAttribute("darksouls1/icon_magic_damage","Magic",s.magic_damage,r.magic_damage);a+=Se.renderAttribute("darksouls1/icon_fire_damage","Fire",s.fire_damage,r.fire_damage);a+=Se.renderAttribute("darksouls1/icon_lightning_damage","Lightning",s.lightning_damage,r.lightning_damage);a+=Se.renderAttribute("darksouls1/icon_critical","Critical",s.critical,r.critical);return this.statsBoxTemplate({title:"Damage",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReductionStats:function(e,t){var a="",s=e.stats,r=t.stats;a+=Se.renderAttribute("darksouls1/icon_physical_reduction","Physical",s.physical_reduction,r.physical_reduction);a+=Se.renderAttribute("darksouls1/icon_magic_reduction","Magic",s.magic_reduction,r.magic_reduction);a+=Se.renderAttribute("darksouls1/icon_fire_reduction","Fire",s.fire_reduction,r.fire_reduction);a+=Se.renderAttribute("darksouls1/icon_lightning_reduction","Lightning",s.lightning_reduction,r.lightning_reduction);a+=Se.renderAttribute("darksouls1/icon_stability","Stability",s.stability,r.stability);return this.statsBoxTemplate({title:"Reduction",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderParamBonus:function(e,t){var a="",s=e.param_bonus,r=t.param_bonus;a+=Se.renderAttribute("darksouls1/icon_strength","Strength",s.strength,r.strength,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls1/icon_dexterity","Dexterity",s.dexterity,r.dexterity,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls1/icon_intelligence","Intelligence",s.intelligence,r.intelligence,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls1/icon_faith","Faith",s.faith,r.faith,{isNegative:true,isString:true,invertSymbols:true});return this.statsBoxTemplate({title:"Param Bonus",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",s=e.req_param,r=t.req_param;a+=Se.renderAttribute("darksouls1/icon_strength","Strength",s.strength,r.strength,{isNegative:true,isInteger:true});a+=Se.renderAttribute("darksouls1/icon_dexterity","Dexterity",s.dexterity,r.dexterity,{isNegative:true,isInteger:true});a+=Se.renderAttribute("darksouls1/icon_intelligence","Intelligence",s.intelligence,r.intelligence,{isNegative:true,isInteger:true});a+=Se.renderAttribute("darksouls1/icon_faith","Faith",s.faith,r.faith,{isNegative:true,isInteger:true});return this.statsBoxTemplate({title:"Req Params",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderAuxEffects:function(e,t){var a="",s=e.aux_effect,r=t.aux_effect;a+=Se.renderAttribute("darksouls1/icon_bleed","Bleed",s.bleed,r.bleed,{isInteger:true});a+=Se.renderAttribute("darksouls1/icon_toxic","Toxic",s.toxic,r.toxic,{isInteger:true});a+=Se.renderAttribute("darksouls1/icon_occult","Occult",s.occult,r.occult,{isInteger:true});a+=Se.renderAttribute("darksouls1/icon_divine","Divine",s.divine,r.divine,{isInteger:true});return this.statsBoxTemplate({title:"Aux Effects",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",s=e.resistances,r=t.resistances;a+=Se.renderAttribute("darksouls1/icon_bleed","Bleed",s.bleed,r.bleed,{isPercentage:true});a+=Se.renderAttribute("darksouls1/icon_poison","Poison",s.poison,r.poison,{isPercentage:true});a+=Se.renderAttribute("darksouls1/icon_toxic","Toxic",s.toxic,r.toxic,{isPercentage:true});a+=Se.renderAttribute("darksouls1/icon_curse","Curse",s.curse,r.curse,{isPercentage:true});return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t,a){var s="",r=e.stats,i=t.stats;s+=Se.renderAttribute("darksouls1/icon_weight","Weight",e.weight,t.weight,{isNegative:true});s+=Se.renderAttribute("darksouls1/icon_durability","Durability",e.durability,t.durability,{isInteger:true});if(e.magic_adjust||t.magic_adjust){s+=Se.renderAttribute("darksouls1/icon_magic_adjust","Magic Adjust",e.magic_adjust,t.magic_adjust,{isInteger:true})}if(a){var n=this.calculateStabilityWeightRation(e);var l=this.calculateStabilityWeightRation(t);s+=Se.renderAttribute("darksouls1/icon_stability","Sta/Wei",n.toFixed(2),l.toFixed(2),{tooltip:"Stability/Weight"})}else{var o=this.calculateDamageWeightRatio(e);var u=this.calculateDamageWeightRatio(t);s+=Se.renderAttribute("darksouls1/icon_physical_damage","Dmg/Wei",o.toFixed(2),u.toFixed(2),{tooltip:"Damage/Weight"})}return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:s,isArmor:this.isArmor})},render:function(e,t,a){var s=Se.renderImage(e,"attack_type","weapon_type");var r=Se.renderImage(t,"attack_type","weapon_type");var i="";i+=this.renderDamageStats(e,t);i+=this.renderReductionStats(e,t);i+=this.renderParamBonus(e,t);i+=this.renderReqParams(e,t);if(a){i+=this.renderResistances(e,t)}else{i+=this.renderAuxEffects(e,t)}i+=this.renderOthers(e,t,a);i+=Se.renderChartBox("weapons-evolution","col-sm-12 col-md-12");i+=Se.renderChartBox("shields-evolution","col-sm-6 col-md-6");i+=Se.renderChartBox("shields-reduction","col-sm-6 col-md-6");content=this.contentTemplate({body:i,description1:s,description2:r});this.$el.html(content)}});Ce.prototype.renderWeaponsEvolution=function(e,t){var a=e.data.map(function(e){var t=0;t+=Se.parseValue(e.stats.physical_damage);t+=Se.parseValue(e.stats.magic_damage);t+=Se.parseValue(e.stats.fire_damage);t+=Se.parseValue(e.stats.lightning_damage);return t});var s=t.data.map(function(e){var t=0;t+=Se.parseValue(e.stats.physical_damage);t+=Se.parseValue(e.stats.magic_damage);t+=Se.parseValue(e.stats.fire_damage);t+=Se.parseValue(e.stats.lightning_damage);return t});Se.drawWeaponEvolution(e.name,a,t.name,s)};Ce.prototype.renderShieldsEvolution=function(e,t){var a=e.data.map(function(e){return Se.parseValue(e.stats.stability)});var s=t.data.map(function(e){return Se.parseValue(e.stats.stability)});Se.drawShieldEvolution(e.name,a,t.name,s)};Ce.prototype.renderReductionsChart=function(e,t){var a=["Physical Red","Fire Red","Magic Red","Lightning Red","Bleed Res","Poison Res","Curse Res","Stability","Weight"];var s=[Se.parseValue(e.stats.physical_reduction),Se.parseValue(e.stats.magic_reduction),Se.parseValue(e.stats.fire_reduction),Se.parseValue(e.stats.lightning_reduction),Se.parseValue(e.resistances.bleed),Se.parseValue(e.resistances.poison),Se.parseValue(e.resistances.curse),Se.parseValue(e.stats.stability),Se.parseValue(e.weight)];var r=[Se.parseValue(t.stats.physical_reduction),Se.parseValue(t.stats.magic_reduction),Se.parseValue(t.stats.fire_reduction),Se.parseValue(t.stats.lightning_reduction),Se.parseValue(t.resistances.bleed),Se.parseValue(t.resistances.poison),Se.parseValue(t.resistances.curse),Se.parseValue(t.stats.stability),Se.parseValue(t.weight)];Se.drawShieldsReductions(a,e.name,s,t.name,r)};var Re=Backbone.View.extend({initialize:function(){this.isArmor=true;this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateSetStats:function(e){var t=new xe;for(var a=0;a<e.pieces.length;a++){var s=e.pieces[a];t.stats.physical_defense+=parseFloat(s.stats.physical_defense);t.stats.strike_defense+=parseFloat(s.stats.strike_defense);t.stats.slash_defense+=parseFloat(s.stats.slash_defense);t.stats.thrust_defense+=parseFloat(s.stats.thrust_defense);t.stats.fire_defense+=parseFloat(s.stats.fire_defense);t.stats.lightning_defense+=parseFloat(s.stats.lightning_defense);t.stats.magic_defense+=parseFloat(s.stats.magic_defense);t.stats.dark_defense+=parseFloat(s.stats.dark_defense);t.stats.bleed_resist+=parseFloat(s.stats.bleed_resist);t.stats.poison_resist+=parseFloat(s.stats.poison_resist);t.stats.curse_resist+=parseFloat(s.stats.curse_resist);t.stats.dark_resist+=parseFloat(s.stats.dark_resist);t.stats.weight+=parseFloat(s.stats.weight);t.stats.poise+=parseFloat(s.stats.poise);t.stats.durability+=parseInt(s.stats.durability);if(t.name===""){t.name=s.set}else if(s.set!==t.name){t.name="Custom Set"}t.type=s.type}return t},calculatePhysicalWeightRatio:function(e){if(e.stats.weight===0)return 0;var t;t=Se.parseValue(e.stats.physical_defense);t+=Se.parseValue(e.stats.strike_defense);t+=Se.parseValue(e.stats.slash_defense);t+=Se.parseValue(e.stats.thrust_defense);return t/4/Se.parseValue(e.stats.weight)},calculateElementalWeightRatio:function(e){if(e.stats.weight===0)return 0;var t;t=Se.parseValue(e.stats.fire_defense);t+=Se.parseValue(e.stats.magic_defense);t+=Se.parseValue(e.stats.lightning_defense);t+=Se.parseValue(e.stats.dark_defense);return t/4/Se.parseValue(e.stats.weight)},calculatePoiseWeightRatio:function(e){if(e.stats.weight===0)return 0;return Se.parseValue(e.stats.poise)/Se.parseValue(e.stats.weight)},renderSets:function(e,t){var a=Se.renderImage(e,"type");var s=Se.renderImage(t,"type");var r="";r+=this.renderPhysicalDefense(e,t);r+=this.renderElementalDefense(e,t);r+=this.renderResistances(e,t);r+=this.renderOthers(e,t);return this.contentTemplate({body:r,description1:a,description2:s})},renderPiece:function(e){var t="";var a=_.find(this.armor1.pieces,{piece:e});var s=_.find(this.armor2.pieces,{piece:e});if(a===undefined&&s===undefined){return""}else if(a===undefined&&s){a=new xe(null,e)}else if(s===undefined&&a){s=new xe(null,e)}var r=Se.renderImage(a,"type");var i=Se.renderImage(s,"type");var t="";t+=this.renderPhysicalDefense(a,s);t+=this.renderElementalDefense(a,s);t+=this.renderResistances(a,s);t+=this.renderOthers(a,s);return this.contentTemplate({body:t,description1:r,description2:i})},renderPhysicalDefense:function(e,t){var a="",s=e.stats||{},r=t.stats||{};a+=Se.renderAttribute("darksouls2/icon_physical_reduction","Physical",s.physical_defense,r.physical_defense);a+=Se.renderAttribute("darksouls2/icon_strike_reduction","Strike",s.strike_defense,r.strike_defense);a+=Se.renderAttribute("darksouls2/icon_slash_reduction","Slash",s.slash_defense,r.slash_defense);a+=Se.renderAttribute("darksouls2/icon_thrust_reduction","Thrust",s.thrust_defense,r.thrust_defense);return this.statsBoxTemplate({title:"Physical Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderElementalDefense:function(e,t){var a="",s=e.stats||{},r=t.stats||{};a+=Se.renderAttribute("darksouls2/icon_fire_reduction","Fire",s.fire_defense,r.fire_defense);a+=Se.renderAttribute("darksouls2/icon_magic_reduction","Magic",s.magic_defense,r.magic_defense);a+=Se.renderAttribute("darksouls2/icon_lightning_reduction","Lightning",s.lightning_defense,r.lightning_defense);a+=Se.renderAttribute("darksouls2/icon_dark_reduction","Dark",s.dark_defense,r.dark_defense);return this.statsBoxTemplate({title:"Elemental Defense",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderResistances:function(e,t){var a="",s=e.stats||{},r=t.stats||{};a+=Se.renderAttribute("darksouls2/icon_bleed_reduction","Bleed",s.bleed_resist,r.bleed_resist);a+=Se.renderAttribute("darksouls2/icon_poison_reduction","Poison",s.poison_resist,r.poison_resist);a+=Se.renderAttribute("darksouls2/icon_curse_reduction","Curse",s.curse_resist,r.curse_resist);a+=Se.renderAttribute("darksouls2/icon_petrify_reduction","Petrify",s.petrify_resist,r.petrify_resist);return this.statsBoxTemplate({title:"Resistances",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",s=e.req_param||{},r=t.req_param||{};a+=Se.renderAttribute("darksouls2/icon_strength","Strength",s.strength,r.strength);a+=Se.renderAttribute("darksouls2/icon_dexterity","Dexterity",s.dexterity,r.dexterity);a+=Se.renderAttribute("darksouls2/icon_intelligence","Intelligence",s.intelligence,r.intelligence);a+=Se.renderAttribute("darksouls2/icon_faith","Faith",s.faith,r.faith);return this.statsBoxTemplate({title:"Req Param",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},renderOthers:function(e,t){var a="",s=e.stats||{},r=t.stats||{};a+=Se.renderAttribute("darksouls2/icon_poise","Poise",s.poise,r.poise);a+=Se.renderAttribute("darksouls2/icon_weight","Weight",s.weight,r.weight,{isNegative:true});a+=Se.renderAttribute("darksouls2/icon_durability","Durability",s.durability,r.durability,{isInteger:true});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:a,isArmor:this.isArmor})},render:function(e,t){this.armor1=e;this.armor2=t;this.set1=this.calculateSetStats(this.armor1);this.set2=this.calculateSetStats(this.armor2);var a=this.renderSets(this.set1,this.set2);a+=this.renderPiece("Head");a+=this.renderPiece("Chest");a+=this.renderPiece("Hands");a+=this.renderPiece("Legs");this.$el.html(a)}});Re.prototype.renderSetsEvolution=function(e,t){var a=[{name:null,defenses:new Array(e[0].data.length),resistances:new Array(e[0].data.length)},{name:null,defenses:new Array(t[0].data.length),resistances:new Array(t[0].data.length)}];e.forEach(function(e){e.data.forEach(function(e){var t=0,s=0;var r=e.set.split("+")[0].trim();if(a[0].name&&a[0].name!==r&&a[0].name!=="Custom Set"){a[0].name="Custom Set"}else if(!a[0].name){a[0].name=r}t+=Se.parseValue(e.stats.physical_defense);t+=Se.parseValue(e.stats.slash_defense);t+=Se.parseValue(e.stats.strike_defense);t+=Se.parseValue(e.stats.thrust_defense);t+=Se.parseValue(e.stats.fire_defense);t+=Se.parseValue(e.stats.magic_defense);t+=Se.parseValue(e.stats.lightning_defense);t+=Se.parseValue(e.stats.dark_defense);s+=Se.parseValue(e.stats.bleed_resist);s+=Se.parseValue(e.stats.curse_resist);s+=Se.parseValue(e.stats.poison_resist);s+=Se.parseValue(e.stats.petrify_resist);if(!a[0].defenses[e.level])a[0].defenses[e.level]=0;if(!a[0].resistances[e.level])a[0].resistances[e.level]=0;a[0].defenses[e.level]+=t;a[0].resistances[e.level]+=s})});t.forEach(function(e){e.data.forEach(function(e){var t=0,s=0;var r=e.set.split("+")[0].trim();if(a[1].name&&a[1].name!==r&&a[1].name!=="Custom Set"){a[1].name="Custom Set"}else if(!a[1].name){a[1].name=r}t+=Se.parseValue(e.stats.physical_defense);t+=Se.parseValue(e.stats.slash_defense);t+=Se.parseValue(e.stats.strike_defense);t+=Se.parseValue(e.stats.thrust_defense);t+=Se.parseValue(e.stats.fire_defense);t+=Se.parseValue(e.stats.magic_defense);t+=Se.parseValue(e.stats.lightning_defense);t+=Se.parseValue(e.stats.dark_defense);s+=Se.parseValue(e.stats.bleed_resist);s+=Se.parseValue(e.stats.curse_resist);s+=Se.parseValue(e.stats.poison_resist);s+=Se.parseValue(e.stats.petrify_resist);if(!a[1].defenses[e.level])a[1].defenses[e.level]=0;if(!a[1].resistances[e.level])a[1].resistances[e.level]=0;a[1].defenses[e.level]+=t;a[1].resistances[e.level]+=s})});Se.drawArmorEvolutions(a)};Re.prototype.renderDefensesChart=function(e,t){var a=["Regular Def","Slash Def","Strike Def","Thrust Def","Fire Def","Magic Red","Lightning Red","Dark Res","Bleed Res","Poison Res","Curse Res","Petrify Res","Poise","Weight"];var s=[Se.parseValue(e.stats.physical_defense),Se.parseValue(e.stats.slash_defense),Se.parseValue(e.stats.strike_defense),Se.parseValue(e.stats.thrust_defense),Se.parseValue(e.stats.fire_defense),Se.parseValue(e.stats.magic_defense),Se.parseValue(e.stats.lightning_defense),Se.parseValue(e.stats.dark_defense),Se.parseValue(e.stats.bleed_resist),Se.parseValue(e.stats.poison_resist),Se.parseValue(e.stats.curse_resist),Se.parseValue(e.stats.petrify_resist),Se.parseValue(e.stats.poise),Se.parseValue(e.stats.weight)];var r=[Se.parseValue(t.stats.physical_defense),Se.parseValue(t.stats.slash_defense),Se.parseValue(t.stats.strike_defense),Se.parseValue(t.stats.thrust_defense),Se.parseValue(t.stats.fire_defense),Se.parseValue(t.stats.magic_defense),Se.parseValue(t.stats.lightning_defense),Se.parseValue(t.stats.dark_defense),Se.parseValue(t.stats.bleed_resist),Se.parseValue(t.stats.poison_resist),Se.parseValue(t.stats.curse_resist),Se.parseValue(t.stats.petrify_resist),Se.parseValue(t.stats.poise),Se.parseValue(t.stats.weight)];Se.drawArmorDefenses(a,e.name,s,t.name,r)};var Pe=Backbone.View.extend({initialize:function(){this.isArmor=false;this.game="darksouls2";this.contentTemplate=Handlebars.compile($("#content-template").html());this.statsBoxTemplate=Handlebars.compile($("#stats-box-template").html())},calculateDamageWeightRatio:function(e){var t;t=Se.parseValue(e.stats.physical_damage);t+=Se.parseValue(e.stats.fire_damage);t+=Se.parseValue(e.stats.magic_damage);t+=Se.parseValue(e.stats.lightning_damage);t+=Se.parseValue(e.stats.dark_damage);return t/4/Se.parseValue(e.stats.weight)},calculateStabilityWeightRation:function(e){return Se.parseValue(e.stats.stability)/Se.parseValue(e.stats.weight)},renderDamageStats:function(e,t){var a="",s=e.stats,r=t.stats,i=this.calculateDamageWeightRatio(e),n=this.calculateDamageWeightRatio(t);a+=Se.renderAttribute("darksouls2/icon_physical_damage","Physical",s.physical_damage,r.physical_damage);a+=Se.renderAttribute("darksouls2/icon_magic_damage","Magic",s.magic_damage,r.magic_damage);a+=Se.renderAttribute("darksouls2/icon_fire_damage","Fire",s.fire_damage,r.fire_damage);a+=Se.renderAttribute("darksouls2/icon_lightning_damage","Lightning",s.lightning_damage,r.lightning_damage);a+=Se.renderAttribute("darksouls2/icon_dark_damage","Dark",s.dark_damage,r.dark_damage);a+=Se.renderAttribute("darksouls2/icon_physical_damage","Dmg/Wei",i.toFixed(2),n.toFixed(2),{tooltip:"Damage/Weight"});return this.statsBoxTemplate({title:"Damage",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderAuxDamageStats:function(e,t){var a="",s=e.stats,r=t.stats;a+=Se.renderAttribute("darksouls2/icon_poison_damage","Poison",s.poison_damage,r.poison_damage);a+=Se.renderAttribute("darksouls2/icon_bleed_damage","Bleed",s.bleed_damage,r.bleed_damage);a+=Se.renderAttribute("darksouls2/icon_counter_damage","Counter",s.counter_damage,r.counter_damage);a+=Se.renderAttribute("darksouls2/icon_poise_damage","Poise",s.poise_damage,r.poise_damage);return this.statsBoxTemplate({title:"Aux. Damage",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderReductionStats:function(e,t){var a="",s=e.stats,r=t.stats;a+=Se.renderAttribute("darksouls2/icon_physical_reduction","Physical",s.physical_reduction,r.physical_reduction);a+=Se.renderAttribute("darksouls2/icon_magic_reduction","Magic",s.magic_reduction,r.magic_reduction);a+=Se.renderAttribute("darksouls2/icon_fire_reduction","Fire",s.fire_reduction,r.fire_reduction);a+=Se.renderAttribute("darksouls2/icon_lightning_reduction","Lightning",s.lightning_reduction,r.lightning_reduction);a+=Se.renderAttribute("darksouls2/icon_dark_reduction","Dark",s.dark_reduction,r.dark_reduction);return this.statsBoxTemplate({title:"Reduction",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderAuxReductionStats:function(e,t){var a="",s=e.stats,r=t.stats;a+=Se.renderAttribute("darksouls2/icon_poison_reduction","Poison",s.poison_reduction,r.poison_reduction);a+=Se.renderAttribute("darksouls2/icon_bleed_reduction","Bleed",s.bleed_reduction,r.bleed_reduction);a+=Se.renderAttribute("darksouls2/icon_petrify_reduction","Petrify",s.petrify_reduction,r.petrify_reduction);a+=Se.renderAttribute("darksouls2/icon_curse_reduction","Curse",s.curse_reduction,r.curse_reduction);return this.statsBoxTemplate({title:"Aux. Reduction",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderParamBonus:function(e,t){var a="",s=e.param_bonus,r=t.param_bonus;a+=Se.renderAttribute("darksouls2/icon_strength_bonus","Strength",s.strength,r.strength,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls2/icon_dexterity_bonus","Dexterity",s.dexterity,r.dexterity,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls2/icon_magic_bonus","Magic",s.magic,r.magic,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls2/icon_fire_bonus","Fire",s.fire,r.fire,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls2/icon_lightning_bonus","Lightning",s.lightning,r.lightning,{isNegative:true,isString:true,invertSymbols:true});a+=Se.renderAttribute("darksouls2/icon_dark_bonus","Dark",s.dark,r.dark,{isNegative:true,isString:true,invertSymbols:true});return this.statsBoxTemplate({title:"Param Bonus",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderReqParams:function(e,t){var a="",s=e.req_param,r=t.req_param;a+=Se.renderAttribute("darksouls2/icon_strength","Strength",s.strength,r.strength,{isNegative:true,isInteger:true});a+=Se.renderAttribute("darksouls2/icon_dexterity","Dexterity",s.dexterity,r.dexterity,{isNegative:true,isInteger:true});a+=Se.renderAttribute("darksouls2/icon_intelligence","Intelligence",s.intelligence,r.intelligence,{isNegative:true,isInteger:true});a+=Se.renderAttribute("darksouls2/icon_faith","Faith",s.faith,r.faith,{isNegative:true,isInteger:true});return this.statsBoxTemplate({title:"Req Params",name1:e.name,name2:t.name,stats:a,game:this.game,isArmor:this.isArmor})},renderOthers:function(e,t,a){var s="",r=this.calculateStabilityWeightRation(e),i=this.calculateStabilityWeightRation(t);s+=Se.renderAttribute("darksouls2/icon_shot_range","Shot Range",e.stats.shot_range,t.stats.shot_range,{isNegative:true});s+=Se.renderAttribute("darksouls2/icon_stability","Stability",e.stats.stability,t.stats.stability);s+=Se.renderAttribute("darksouls2/icon_casting_speed","Casting Speed",e.stats.casting_speed,t.stats.casting_speed,{isNegative:true});s+=Se.renderAttribute("darksouls2/icon_weight","Weight",e.stats.weight,t.stats.weight,{isNegative:true});s+=Se.renderAttribute("darksouls2/icon_durability","Durability",e.stats.durability,t.stats.durability,{isInteger:true});s+=Se.renderAttribute("darksouls2/icon_stability","Sta/Wei",r.toFixed(2),i.toFixed(2),{tooltip:"Stability/Weight"});return this.statsBoxTemplate({title:"Others",name1:e.name,name2:t.name,stats:s,game:this.game,isArmor:this.isArmor})},render:function(e,t,a){var s=Se.renderImage(e,"attack_type","weapon_type");var r=Se.renderImage(t,"attack_type","weapon_type");var i="";i+=this.renderDamageStats(e,t);i+=this.renderAuxDamageStats(e,t);i+=this.renderReductionStats(e,t);i+=this.renderParamBonus(e,t);i+=this.renderReqParams(e,t);i+=this.renderOthers(e,t,a);i+=Se.renderChartBox("weapons-evolution","col-sm-12 col-md-12");i+=Se.renderChartBox("shields-evolution","col-sm-6 col-md-6");i+=Se.renderChartBox("shields-reduction","col-sm-6 col-md-6");content=this.contentTemplate({body:i,description1:s,description2:r});this.$el.html(content)}});Pe.prototype.renderWeaponsEvolution=function(e,t){var a=e.data.map(function(e){var t=0;t+=Se.parseValue(e.stats.physical_damage);t+=Se.parseValue(e.stats.magic_damage);t+=Se.parseValue(e.stats.fire_damage);t+=Se.parseValue(e.stats.lightning_damage);t+=Se.parseValue(e.stats.dark_damage);return t});var s=t.data.map(function(e){var t=0;t+=Se.parseValue(e.stats.physical_damage);t+=Se.parseValue(e.stats.magic_damage);t+=Se.parseValue(e.stats.fire_damage);t+=Se.parseValue(e.stats.lightning_damage);t+=Se.parseValue(e.stats.dark_damage);return t});Se.drawWeaponEvolution(e.name,a,t.name,s)};Pe.prototype.renderShieldsEvolution=function(e,t){var a=e.data.map(function(e){return Se.parseValue(e.stats.stability)});var s=t.data.map(function(e){return Se.parseValue(e.stats.stability)});Se.drawShieldEvolution(e.name,a,t.name,s)};Pe.prototype.renderReductionsChart=function(e,t){var a=["Physical Red","Fire Red","Magic Red","Lightning Red","Dark Red","Bleed Res","Poison Res","Curse Res","Petrify Res","Stability","Weight"];var s=[Se.parseValue(e.stats.physical_reduction),Se.parseValue(e.stats.magic_reduction),Se.parseValue(e.stats.fire_reduction),Se.parseValue(e.stats.lightning_reduction),Se.parseValue(e.stats.dark_reduction),Se.parseValue(e.stats.bleed_reduction),Se.parseValue(e.stats.poison_reduction),Se.parseValue(e.stats.curse_reduction),Se.parseValue(e.stats.petrify_reduction),Se.parseValue(e.stats.stability),Se.parseValue(e.weight)];var r=[Se.parseValue(t.stats.physical_reduction),Se.parseValue(t.stats.magic_reduction),Se.parseValue(t.stats.fire_reduction),Se.parseValue(t.stats.lightning_reduction),Se.parseValue(t.stats.dark_reduction),Se.parseValue(t.stats.bleed_reduction),Se.parseValue(t.stats.poison_reduction),Se.parseValue(t.stats.curse_reduction),Se.parseValue(t.stats.petrify_reduction),Se.parseValue(t.stats.stability),Se.parseValue(t.weight)];Se.drawShieldsReductions(a,e.name,s,t.name,r)};